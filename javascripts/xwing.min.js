var DFL_LANGUAGE,GenericAddon,SERIALIZATION_CODE_TO_CLASS,SHOW_DEBUG_OUT_MISSING_TRANSLATIONS,SPEC_URL,SQUAD_DISPLAY_NAME_MAX_LENGTH,SQUAD_TO_XWS_URL,Ship,TYPES,URL_BASE,all,builders,byName,byPoints,conditionToHTML,exportObj,getPrimaryFaction,statAndEffectiveStat,__slice=[].slice,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__indexOf=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},__hasProp={}.hasOwnProperty,__extends=function(t,e){for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};window.iced={Deferrals:function(){function t(t){this.continuation=t,this.count=1,this.ret=null}return t.prototype._fulfill=function(){if(!--this.count)return this.continuation(this.ret)},t.prototype.defer=function(i){return++this.count,n=this,function(){var t,e=1<=arguments.length?__slice.call(arguments,0):[];return null!=i&&null!=(t=i.assign_fn)&&t.apply(null,e),n._fulfill()};var n},t}(),findDeferral:function(){return null},trampoline:function(t){return t()}},window.__iced_k=window.__iced_k_noop=function(){},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).SquadBuilderBackend=function(){function t(t){var e,i,n,a;for(this.getCollectionCheck=__bind(this.getCollectionCheck,this),this.getLanguagePreference=__bind(this.getLanguagePreference,this),this.nameCheck=__bind(this.nameCheck,this),this.maybeAuthenticationChanged=__bind(this.maybeAuthenticationChanged,this),$.ajaxSetup({dataType:"json",xhrFields:{withCredentials:!0}}),this.server=t.server,this.builders=t.builders,this.login_logout_button=$(t.login_logout_button),this.auth_status=$(t.auth_status),this.authenticated=!1,this.ui_ready=!1,this.oauth_window=null,this.method_metadata={google_oauth2:{icon:"fab fa-google",text:"Google"},twitter:{icon:"fab fa-twitter",text:"Twitter"},discord:{icon:"fab fa-discord",text:"Discord"}},this.squad_display_mode="all",this.show_archived=!1,this.collection_save_timer=null,this.collection_reset_timer=null,this.setupHandlers(),this.setupUI(),this.authenticate((a=this,function(){return a.auth_status.hide(),a.login_logout_button.removeClass("d-none")})),e=0,i=(n=this.builders).length;e<i;e++)n[e].setBackend(this);this.updateAuthenticationVisibility()}return t.prototype.updateAuthenticationVisibility=function(){return this.authenticated?($(".show-authenticated").show(),$(".hide-authenticated").hide()):($(".show-authenticated").hide(),$(".hide-authenticated").show())},t.prototype.save=function(t,e,i,n,a,s){var l;if(null==e&&(e=null),null==a&&(a={}),""===t)return s({id:null,success:!1,error:"You cannot save an empty squad"});if(""===$.trim(i))return s({id:null,success:!1,error:"Squad name cannot be empty"});if(null==n||""===n)throw"Faction unspecified to save()";return i={name:$.trim(i),faction:$.trim(n),serialized:t,additional_data:a},null!=e?l=this.server+"/squads/"+e:(l=this.server+"/squads/new",i._method="put"),$.post(l,i,function(t,e,i){return s({id:t.id,success:t.success,error:t.error})})},t.prototype.delete=function(t,n){return $.post(this.server+"/squads/"+t,{_method:"delete"},function(t,e,i){return n({success:t.success,error:t.error})})},t.prototype.archive=function(t,e,i){return t.additional_data.archived=!0,this.save(t.serialized,t.id,t.name,e,t.additional_data,i)},t.prototype.list=function(g){var v,x,k,t,y;return this.squad_list_modal.find(".modal-header .squad-list-header-placeholder").text(exportObj.translate("ui","yourXYsquads",g.faction)),(v=$(this.squad_list_modal.find("ul.squad-list"))).text(""),v.hide(),(x=$(this.squad_list_modal.find("p.squad-list-loading"))).show(),this.show_all_squads_button.click(),this.squad_list_modal.modal("show"),this.number_of_selected_squads_to_be_deleted=0,k=[],t=this.server+"/squads/list",$.get(t,(y=this,function(c,u,h){for(var i,t,l,o,e,n,a,s,p,f,r,m=!1,_=c[g.faction],d=0,b=_.length;d<b;d++){if(t=_[d],(i=$(document.createElement("LI"))).addClass("squad-summary"),i.data("squad",t),i.data("builder",g),i.data("selectedForDeletion",!1),v.append(i),null!=(null!=(r=t.additional_data)?r.tag:void 0)&&""!==(null!=(r=t.additional_data)?r.tag:void 0)&&-1===k.indexOf(t.additional_data.tag))for(a=0,p=(o=null!=(r=t.additional_data)?r.tag.split(","):void 0).length;a<p;a++)e=o[a],k.push(e);null!=(null!=(r=t.additional_data)?r.archived:void 0)?i.hide():m=!0,i.append($.trim('<div class="row">\n    <div class="col-md-9">\n        <h4>'+t.name+'</h4>\n    </div>\n    <div class="col-md-3">\n        <h5>'+(null!=(r=t.additional_data)?r.points:void 0)+" "+exportObj.translate("ui","Points")+'</h5>\n    </div>\n</div>\n<div class="row squad-description">\n    <div class="col-md-9">\n        '+(null!=(r=t.additional_data)?r.description:void 0)+'\n    </div>\n    <div class="squad-buttons col-md-3">\n        <button class="btn btn-modal convert-squad"><i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i></button>\n        &nbsp;\n        <button class="btn btn-modal load-squad"><i class="fa fa-download"></i></button>\n        &nbsp;\n        <button class="btn btn-danger delete-squad"><i class="fa fa-times"></i></button>\n    </div>\n</div>\n<div class="row squad-convert-confirm">\n    <div class="col-md-9 translated" defaultText="Convert to Extended?">\n    </div>\n    <div class="squad-buttons col-md-3">\n        <button class="btn btn-danger confirm-convert-squad translated" defaultText="Convert"></button>\n        &nbsp;\n        <button class="btn btn-modal cancel-convert-squad translated" defaultText="Cancel"></button>\n    </div>\n</div>\n<div class="row squad-delete-confirm">\n    <div class="col-md-6">\n        '+exportObj.translate("ui","reallyDeleteSquadXY","<em>"+t.name+"</em>")+'\n    </div>\n    <div class="col-md-6 btn-group">\n        <button class="btn btn-danger confirm-delete-squad translated" defaultText="Delete"></button>\n        <button class="btn confirm-archive-squad translated" defaultText="Archive"></button>\n        <button class="btn btn-modal cancel-delete-squad translated" defaultText="Unselect"></button>\n    </div>\n</div>')),i.find(".squad-convert-confirm").hide(),i.find(".squad-delete-confirm").hide(),-1===t.serialized.search(/v\d+Zh/)&&i.find("button.convert-squad").hide(),i.find("button.convert-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.data("selectedToConvert",!0),(e=i).find(".squad-description").fadeOut("fast",function(){return e.find(".squad-convert-confirm").fadeIn("fast")})}),i.find("button.cancel-convert-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.data("selectedToConvert",!1),(e=i).find(".squad-convert-confirm").fadeOut("fast",function(){return e.find(".squad-description").fadeIn("fast")})}),i.find("button.confirm-convert-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.find(".cancel-convert-squad").fadeOut("fast"),i.find(".confirm-convert-squad").addClass("disabled"),i.find(".confirm-convert-squad").text("Converting..."),e=i.data("squad").serialized.replace("Zh","Zs"),y.save(e,i.data("squad").id,i.data("squad").name,i.data("builder").faction,i.data("squad").additional_data,function(t){return t.success?(i.data("squad").serialized=e,i.find(".squad-convert-confirm").fadeOut("fast",function(){return i.find(".squad-description").fadeIn("fast"),i.find("button.convert-squad").fadeOut("fast")})):i.html($.trim("Error converting "+i.data("squad").name+": <em>"+t.error+"</em>"))})}),i.find("button.load-squad").click(function(t){return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),y.squad_list_modal.modal("hide"),g.current_squad.dirty?y.warnUnsaved(g,function(){return g.container.trigger("xwing-backend:squadLoadRequested",i.data("squad"))}):g.container.trigger("xwing-backend:squadLoadRequested",i.data("squad"))}),i.find("button.delete-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.data("selectedForDeletion",!0),(e=i).find(".squad-description").fadeOut("fast",function(){return e.find(".squad-delete-confirm").fadeIn("fast")}),y.number_of_selected_squads_to_be_deleted||y.squad_list_modal.find("div.delete-multiple-squads").show(),y.number_of_selected_squads_to_be_deleted+=1}),i.find("button.cancel-delete-squad").click(function(t){t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.data("selectedForDeletion",!1),--y.number_of_selected_squads_to_be_deleted;var e=i;if(e.find(".squad-delete-confirm").fadeOut("fast",function(){return e.find(".squad-description").fadeIn("fast")}),!y.number_of_selected_squads_to_be_deleted)return y.squad_list_modal.find("div.delete-multiple-squads").hide()}),i.find("button.confirm-delete-squad").click(function(t){return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.find(".cancel-delete-squad").fadeOut("fast"),i.find(".confirm-delete-squad").addClass("disabled"),i.find(".confirm-delete-squad").text("Deleting..."),y.delete(i.data("squad").id,function(t){return t.success?(i.slideUp("fast",function(){return $(i).remove()}),--y.number_of_selected_squads_to_be_deleted,y.number_of_selected_squads_to_be_deleted?void 0:y.squad_list_modal.find("div.delete-multiple-squads").hide()):i.html($.trim("Error deleting "+i.data("squad").name+": <em>"+t.error+"</em>"))})}),i.find("button.confirm-archive-squad").click(function(t){return t.preventDefault(),t=$(t.target),i=t.closest("li"),g=i.data("builder"),i.find(".confirm-delete-squad").addClass("disabled"),i.find(".confirm-delete-squad").text(exportObj.translate("ui","Archiving...")),y.archive(i.data("squad"),i.data("builder").faction,function(t){return t.success?(i.slideUp("fast",function(){return $(i).hide(),$(i).find(".confirm-delete-squad").removeClass("disabled"),$(i).find(".confirm-delete-squad").text(exportObj.translate("ui","Delete")),$(i).data("selectedForDeletion",!1),$(i).find(".squad-delete-confirm").fadeOut("fast",function(){return $(i).find(".squad-description").fadeIn("fast")})}),--y.number_of_selected_squads_to_be_deleted,y.number_of_selected_squads_to_be_deleted?void 0:y.squad_list_modal.find("div.delete-multiple-squads").hide()):i.html($.trim("Error archiving "+i.data("squad").name+": <em>"+t.error+"</em>"))})})}for(m||v.append($.trim('<li class="translated" defaultText="No saved squads"></li>')),y.squad_list_tags.empty(),s=0,f=k.length;s<f;s++)n=(l=k[s]).toLowerCase().replace(/[^a-z0-9]/g,"").replace(/\s+/g,"-"),y.squad_list_tags.append($.trim(' \n<button class="btn '+n+'">'+l+"</button>")),$(y.squad_list_tags.find("."+n)).click(function(t){var t=$(t.target),s=t.attr("class").replace("btn ","").replace("btn-inverse ","");return y.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),y.squad_list_tags.find(".btn").removeClass("btn-inverse"),t.addClass("btn-inverse"),y.squad_list_modal.find(".squad-list li").each(function(t,e){var i,n,a;if(null==$(e).data().squad.additional_data.tag)return $(e).hide();for(i=!1,n=0,a=(o=$(e).data().squad.additional_data.tag.split(",")).length;n<a;n++)l=o[n],s===l.toLowerCase().replace(/[^a-z0-9]/g,"").replace(/\s+/g,"-")&&(i=!0);return i?$(e).show():$(e).hide()})});return exportObj.translateUIElements(v),x.fadeOut("fast"),v.fadeIn("fast")}))},t.prototype.authenticate=function(n){var a,s,e;return null==n&&(n=$.noop),$(this.auth_status.find(".payload")).text(exportObj.translate("ui","Checking auth status...")),this.auth_status.show(),a=this.authenticated,$.ajax({url:this.server+"/ping",success:function(t){return null!=t&&t.success?e.authenticated=!0:e.authenticated=!1,e.maybeAuthenticationChanged(a,n)},error:(s=e=this,function(t,e,i){return s.authenticated=!1,s.maybeAuthenticationChanged(a,n)})})},t.prototype.maybeAuthenticationChanged=function(t,e){return t!==this.authenticated&&$(window).trigger("xwing-backend:authenticationChanged",[this.authenticated,this]),this.oauth_window=null,this.auth_status.hide(),e(this.authenticated),this.authenticated},t.prototype.login=function(){if(this.ui_ready)return this.login_modal.modal("show")},t.prototype.logout=function(n){return null==n&&(n=$.noop),$(this.auth_status.find(".payload")).text(exportObj.translate("ui","Logging out...")),this.auth_status.show(),$.get(this.server+"/auth/logout",(a=this,function(t,e,i){return a.authenticated=!1,$(window).trigger("xwing-backend:authenticationChanged",[a.authenticated,a]),a.auth_status.hide(),n()}));var a},t.prototype.showSaveAsModal=function(t){return this.save_as_modal.data("builder",t),this.save_as_input.val(t.current_squad.name),this.save_as_save_button.addClass("disabled"),this.nameCheck(),this.save_as_modal.modal("show")},t.prototype.showDeleteModal=function(t){return this.delete_modal.data("builder",t),this.delete_name_container.text(t.current_squad.name),this.delete_modal.modal("show")},t.prototype.nameCheck=function(){var t,e;return window.clearInterval(this.save_as_modal.data("timer")),0===(t=$.trim(this.save_as_input.val())).length?(this.name_availability_container.text(""),this.name_availability_container.append($.trim('<i class="fa fa-thumbs-down"></i> '+exportObj.translate("ui","name required")))):$.post(this.server+"/squads/namecheck",{name:t},(e=this,function(t){return e.name_availability_container.text(""),t.available?(e.name_availability_container.append($.trim('<i class="fa fa-thumbs-up"></i> '+exportObj.translate("ui","Name is available"))),e.save_as_save_button.removeClass("disabled")):(e.name_availability_container.append($.trim('<i class="fa fa-thumbs-down"></i> '+exportObj.translate("ui","Name in use"))),e.save_as_save_button.addClass("disabled"))}))},t.prototype.warnUnsaved=function(t,e){return this.unsaved_modal.data("builder",t),this.unsaved_modal.data("callback",e),this.unsaved_modal.modal("show")},t.prototype.setupUI=function(){var u,d,l,h,p,f,e,i,n,a,s,o,t,r,c,m,_;return this.auth_status.addClass("disabled"),this.auth_status.click(function(t){return!1}),this.login_modal=$(document.createElement("DIV")),this.login_modal.addClass("modal fade d-print-none"),this.login_modal.tabindex="-1",this.login_modal.role="dialog",$(document.body).append(this.login_modal),this.login_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Log in with OAuth"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p>\n                <span class="translated" defaultText="select OAuth provider"></span>\n                <a class="login-help translated" href="#" defaultText="What\'s this?"></a>\n            </p>\n            <div class="well well-small oauth-explanation">\n                <span class="translated" defaultText="OAuth explanation"></span>\n                <button class="btn btn-modal translated" defaultText="Got it!"></button>\n            </div>\n            <ul class="login-providers inline"></ul>\n            <p class="translated" defaultText="Continue to OAuth provider"></p>\n            <p class="translated" defaultText="iOS requires cross-site control"></p>\n            <p class="login-in-progress">\n                <em class="translated" defaultText="login in progress"></em>\n            </p>\n        </div>\n    </div>\n</div>')),(u=$(this.login_modal.find(".oauth-explanation"))).hide(),this.login_modal.find(".login-in-progress").hide(),this.login_modal.find("a.login-help").click(function(t){if(t.preventDefault(),!u.is(":visible"))return u.slideDown("fast")}),u.find("button").click(function(t){return t.preventDefault(),u.slideUp("fast")}),$.get(this.server+"/methods",(d=this,function(t,e,i){for(var n,a,s=$(d.login_modal.find("ul.login-providers")),l=t.methods,o=0,r=l.length;o<r;o++)a=l[o],(n=$(document.createElement("A"))).addClass("btn btn-modal"),n.data("url",d.server+"/auth/"+a),n.append('<i class="'+d.method_metadata[a].icon+'"></i>&nbsp;'+d.method_metadata[a].text),n.click(function(t){return t.preventDefault(),s.slideUp("fast"),d.login_modal.find(".login-in-progress").slideDown("fast"),d.oauth_window=window.open($(t.target).data("url"),"xwing_login")}),(a=$(document.createElement("LI"))).append(n),s.append(a);return d.ui_ready=!0})),exportObj.translateUIElements(this.login_modal),this.reload_done_modal=$(document.createElement("DIV")),this.reload_done_modal.addClass("modal fade d-print-none"),this.reload_done_modal.tabindex="-1",this.reload_done_modal.role="dialog",$(document.body).append(this.reload_done_modal),this.reload_done_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3>Reload Done</h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Squads reloaded"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-modal btn-primary translated" aria-hidden="true" data-dismiss="modal" defaultText="Well done!"></button>\n        </div>\n    </div>\n</div>')),exportObj.translateUIElements(this.reload_done_modal),this.squad_list_modal=$(document.createElement("DIV")),this.squad_list_modal.addClass("modal fade d-print-none squad-list"),this.squad_list_modal.tabindex="-1",this.squad_list_modal.role="dialog",$(document.body).append(this.squad_list_modal),this.squad_list_modal.append($.trim('<div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="squad-list-header-placeholder d-none d-lg-block"></h3>\n            <h4 class="squad-list-header-placeholder d-lg-none"></h4>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <ul class="squad-list"></ul>\n            <p class="pagination-centered squad-list-loading">\n                <i class="fa fa-spinner fa-spin fa-3x"></i>\n                <br />\n                <span class="translated" defaultText="Fetching squads..."></span>\n            </p>\n        </div>\n        <div class="modal-footer">\n            <div class="btn-group delete-multiple-squads full-row">\n                <button class="btn btn-modal select-all translated" defaultText="Select All"></button>\n                <button class="btn btn-modal archive-selected translated" defaultText="Archive Selected"></button>\n                <button class="btn btn-modal btn-danger delete-selected translated" defaultText="Delete Selected"></button>\n            </div>\n            <div class="btn-group squad-display-mode full-row">\n                <button class="btn btn-modal btn-inverse show-all-squads translated" defaultText="All"></button>\n                <button class="btn btn-modal show-standard-squads"><span class="d-none d-lg-block translated" defaultText="Standard"></span><span class="d-lg-none translated" defaultText="Hyper"></span></button>\n                <button class="btn btn-modal show-extended-squads"><span class="d-none d-lg-block translated" defaultText="Extended"></span><span class="d-lg-none translated" defaultText="Ext"></span></button>\n                <button class="btn btn-modal show-quickbuild-squads"><span class="d-none d-lg-block translated" defaultText="Quickbuild"></span><span class="d-lg-none translated" defaultText="QB"></span></button>\n                <button class="btn btn-modal show-epic-squads translated" defaultText="Epic"></button>\n                <button class="btn btn-modal show-archived-squads translated" defaultText="Archived"></button>\n                <button class="btn btn-modal reload-all translated" defaultText="Recalculate Points"></button>\n            </div>\n            <div class="btn-group tags-display full-row">\n            </div>\n        </div>\n    </div>\n</div>')),this.squad_list_modal.find("ul.squad-list").hide(),this.squad_list_tags=$(this.squad_list_modal.find("div.tags-display")),this.squad_list_modal.find("div.delete-multiple-squads").hide(),exportObj.translateUIElements(this.squad_list_modal),this.delete_selected_button=$(this.squad_list_modal.find("button.delete-selected")),this.delete_selected_button.click((l=this,function(t){for(var e,i=l.squad_list_modal.find("ul.squad-list").find("li"),n=[],a=0,s=i.length;a<s;a++)e=i[a],(e=$(e)).data("selectedForDeletion")?n.push(function(e){return e.find(".cancel-delete-squad").fadeOut("fast"),e.find(".confirm-delete-squad").addClass("disabled"),e.find(".confirm-delete-squad").text(exportObj.translate("ui","Deleting...")),l.delete(e.data("squad").id,function(t){return t.success?(e.slideUp("fast",function(){return $(e).remove()}),--l.number_of_selected_squads_to_be_deleted,l.number_of_selected_squads_to_be_deleted?void 0:l.squad_list_modal.find("div.delete-multiple-squads").hide()):e.html($.trim("Error deleting "+e.data("squad").name+": <em>"+t.error+"</em>"))})}(e)):n.push(void 0);return n})),this.archive_selected_button=$(this.squad_list_modal.find("button.archive-selected")),this.archive_selected_button.click((h=this,function(t){for(var e,i=h.squad_list_modal.find("ul.squad-list").find("li"),n=[],a=0,s=i.length;a<s;a++)e=i[a],(e=$(e)).data("selectedForDeletion")?n.push(function(e){return e.find(".confirm-delete-squad").addClass("disabled"),e.find(".confirm-delete-squad").text(exportObj.translate("ui","Archiving...")),h.archive(e.data("squad"),e.data("builder").faction,function(t){return t.success?(e.slideUp("fast",function(){return $(e).hide(),$(e).find(".confirm-delete-squad").removeClass("disabled"),$(e).find(".confirm-delete-squad").text(exportObj.translate("ui","Delete")),$(e).data("selectedForDeletion",!1),$(e).find(".squad-delete-confirm").fadeOut("fast",function(){return $(e).find(".squad-description").fadeIn("fast")})}),--h.number_of_selected_squads_to_be_deleted,h.number_of_selected_squads_to_be_deleted?void 0:h.squad_list_modal.find("div.delete-multiple-squads").hide()):e.html($.trim("Error archiving "+e.data("squad").name+": <em>"+t.error+"</em>"))})}(e)):n.push(void 0);return n})),this.squad_list_modal.find("button.reload-all").click((p=this,function(t){for(var e,i,n=p.squad_list_modal.find("ul.squad-list"),a=[function(){return p.reload_done_modal.modal("show")}],s=[],l=n.find("li"),o=0,r=l.length;o<r;o++)i=l[o],i=$(i),s.push(i.data("squad")),e=i.data("builder"),a.push(function(){var t=s.pop();return e.container.trigger("xwing-backend:squadLoadRequested",[t,function(){var t={points:e.total_points,description:e.describeSquad(),cards:e.listCards(),notes:e.notes.val().substr(0,1024),obstacles:e.getObstacles(),tag:e.tag.val().substr(0,1024)};return p.save(e.serialize(),e.current_squad.id,e.current_squad.name,e.faction,t,a.pop())}])});return p.squad_list_modal.modal("hide"),e.current_squad.dirty?p.warnUnsaved(e,a.pop()):a.pop()()})),this.select_all_button=$(this.squad_list_modal.find("button.select-all")),this.select_all_button.click((f=this,function(t){for(var e,i=f.squad_list_modal.find("ul.squad-list").find("li"),n=[],a=0,s=i.length;a<s;a++)e=i[a],(e=$(e)).data("selectedForDeletion")?n.push(void 0):(e.data("selectedForDeletion",!0),function(t){t.find(".squad-description").fadeOut("fast",function(){return t.find(".squad-delete-confirm").fadeIn("fast")})}(e),n.push(f.number_of_selected_squads_to_be_deleted+=1));return n})),this.show_all_squads_button=$(this.squad_list_modal.find(".show-all-squads")),this.show_all_squads_button.click((e=this,function(t){if("all"!==e.squad_display_mode)return e.squad_display_mode="all",e.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),e.squad_list_tags.find(".btn").removeClass("btn-inverse"),e.show_all_squads_button.addClass("btn-inverse"),e.squad_list_modal.find(".squad-list li").show()})),this.show_extended_squads_button=$(this.squad_list_modal.find(".show-extended-squads")),this.show_extended_squads_button.click((i=this,function(t){if("extended"!==i.squad_display_mode)return i.squad_display_mode="extended",i.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),i.squad_list_tags.find(".btn").removeClass("btn-inverse"),i.show_extended_squads_button.addClass("btn-inverse"),i.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Zs/))})})),this.show_epic_squads_button=$(this.squad_list_modal.find(".show-epic-squads")),this.show_epic_squads_button.click((n=this,function(t){if("epic"!==n.squad_display_mode)return n.squad_display_mode="epic",n.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),n.squad_list_tags.find(".btn").removeClass("btn-inverse"),n.show_epic_squads_button.addClass("btn-inverse"),n.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Ze/))})})),this.show_standard_squads_button=$(this.squad_list_modal.find(".show-standard-squads")),this.show_standard_squads_button.click((a=this,function(t){if("standard"!==a.squad_display_mode)return a.squad_display_mode="standard",a.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),a.squad_list_tags.find(".btn").removeClass("btn-inverse"),a.show_standard_squads_button.addClass("btn-inverse"),a.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Zh/))})})),this.show_quickbuild_squads_button=$(this.squad_list_modal.find(".show-quickbuild-squads")),this.show_quickbuild_squads_button.click((s=this,function(t){if("quickbuild"!==s.squad_display_mode)return s.squad_display_mode="quickbuild",s.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),s.squad_list_tags.find(".btn").removeClass("btn-inverse"),s.show_quickbuild_squads_button.addClass("btn-inverse"),s.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Zq/))})})),this.show_archived_squads_button=$(this.squad_list_modal.find(".show-archived-squads")),this.show_archived_squads_button.click((o=this,function(t){return o.show_archived=!o.show_archived,o.show_archived?o.show_archived_squads_button.addClass("btn-inverse"):o.show_archived_squads_button.removeClass("btn-inverse"),o.squad_list_tags.find(".btn").removeClass("btn-inverse"),o.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(null!=$(e).data().squad.additional_data.archived===o.show_archived)})})),this.save_as_modal=$(document.createElement("DIV")),this.save_as_modal.addClass("modal fade d-print-none"),this.save_as_modal.tabindex="-1",this.save_as_modal.role="dialog",$(document.body).append(this.save_as_modal),this.save_as_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Save Squad As..."></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <label for="xw-be-squad-save-as">\n                <span class="translated" defaultText="New Squad Name"></span>\n                <input id="xw-be-squad-save-as"></input>\n            </label>\n            <span class="name-availability"></span>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-primary save translated" aria-hidden="true" defaultText="Save"></button>\n        </div>\n    </div>\n</div>')),this.save_as_modal.on("shown",(t=this,function(){return window.setTimeout(function(){return t.save_as_input.focus(),t.save_as_input.select()},100)})),this.save_as_save_button=this.save_as_modal.find("button.save"),this.save_as_save_button.click((r=this,function(t){var e,i;if(t.preventDefault(),!r.save_as_save_button.hasClass("disabled"))return null!=(t=r.save_as_modal.data("timer"))&&window.clearInterval(t),r.save_as_modal.modal("hide"),t={points:(e=r.save_as_modal.data("builder")).total_points,description:e.describeSquad(),cards:e.listCards(),notes:e.getNotes(),obstacles:e.getObstacles(),tag:e.getTag()},e.backend_save_list_as_button.addClass("disabled"),e.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;'+exportObj.translate("ui","Saving squad..."))),e.backend_status.show(),i=$.trim(r.save_as_input.val()),r.save(e.serialize(),null,i,e.faction,t,function(t){return t.success?(e.current_squad.id=t.id,e.current_squad.name=i,e.current_squad.dirty=!1,e.container.trigger("xwing-backend:squadNameChanged"),e.container.trigger("xwing-backend:squadDirtinessChanged"),e.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;'+exportObj.translate("ui","New squad saved successfully.")))):e.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+t.error)),e.backend_save_list_as_button.removeClass("disabled")})})),this.save_as_input=$(this.save_as_modal.find("input")),this.save_as_input.keypress((c=this,function(t){return 13===t.which?(c.save_as_save_button.click(),!1):(c.name_availability_container.text(""),c.name_availability_container.append($.trim('<i class="fa fa-spin fa-spinner"></i> '+exportObj.translate("ui","Checking name availability..."))),null!=(t=c.save_as_modal.data("timer"))&&window.clearInterval(t),c.save_as_modal.data("timer",window.setInterval(c.nameCheck,500)))})),this.name_availability_container=$(this.save_as_modal.find(".name-availability")),exportObj.translateUIElements(this.squad_list_modal),this.delete_modal=$(document.createElement("DIV")),this.delete_modal.addClass("modal fade d-print-none"),this.delete_modal.tabindex="-1",this.delete_modal.role="dialog",$(document.body).append(this.delete_modal),this.delete_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3><span class="translated" defaultText="Really Delete"></span> <span class="squad-name-placeholder"></span>?</h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Sure to delete?"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-danger delete" aria-hidden="true"><span class="translated" defaultText="Yes, Delete"></span> <i class="squad-name-placeholder"></i></button>\n            <button class="btn btn-modal translated" data-dismiss="modal" aria-hidden="true" defaultText="Never Mind"></button>\n        </div>\n    </div>\n</div>')),this.delete_name_container=$(this.delete_modal.find(".squad-name-placeholder")),this.delete_button=$(this.delete_modal.find("button.delete")),this.delete_button.click((m=this,function(t){var e;return t.preventDefault(),(e=m.delete_modal.data("builder")).backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;'+exportObj.translate("ui","Deleting squad..."))),e.backend_status.show(),e.backend_delete_list_button.addClass("disabled"),m.delete_modal.modal("hide"),m.delete(e.current_squad.id,function(t){return t.success?(e.resetCurrentSquad(),e.current_squad.dirty=!0,e.container.trigger("xwing-backend:squadDirtinessChanged"),e.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;'+exportObj.translate("ui","Squad deleted.")))):(e.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+t.error)),e.backend_delete_list_button.removeClass("disabled"))})})),exportObj.translateUIElements(this.delete_modal),this.unsaved_modal=$(document.createElement("DIV")),this.unsaved_modal.addClass("modal fade d-print-none"),this.unsaved_modal.tabindex="-1",this.unsaved_modal.role="dialog",$(document.body).append(this.unsaved_modal),this.unsaved_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Unsaved Changes"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Unsaved Changes Warning"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-modal btn-primary translated" aria-hidden="true" data-dismiss="modal" defaultText="Go Back"></button>\n            <button class="btn btn-danger discard translated" aria-hidden="true" defaultText="Discard Changes"></button>\n        </div>\n    </div>\n</div>')),this.unsaved_discard_button=$(this.unsaved_modal.find("button.discard")),this.unsaved_discard_button.click((_=this,function(t){return t.preventDefault(),_.unsaved_modal.data("builder").current_squad.dirty=!1,_.unsaved_modal.data("callback")(),_.unsaved_modal.modal("hide")})),exportObj.translateUIElements(this.unsaved_modal)},t.prototype.setupHandlers=function(){var n,e,i,a,s;return $(window).on("xwing-backend:authenticationChanged",(n=this,function(t,e,i){if(n.updateAuthenticationVisibility(),e)return n.loadCollection()})),this.login_logout_button.click((e=this,function(t){return t.preventDefault(),e.authenticated?e.logout():e.login()})),$(window).on("message",(s=this,function(t){var e,i=t.originalEvent;return i.origin===s.server?"auth_successful"!==(null!=(e=i.data)?e.command:void 0)?console.log("Unexpected command "+(null!=(e=i.data)?e.command:void 0)):(s.authenticate(),s.login_modal.modal("hide"),s.login_modal.find(".login-in-progress").hide(),s.login_modal.find("ul.login-providers").show(),i.source.close()):(console.log("Message received from unapproved origin "+i.origin),window.last_ev=t)})).on("xwing-collection:changed",(a=this,function(t,e){return null!=a.collection_save_timer&&clearTimeout(a.collection_save_timer),a.collection_save_timer=setTimeout(function(){return a.saveCollection(e,function(t){if(t)return $(window).trigger("xwing-collection:saved",e)})},1e3)})).on("xwing-collection:reset",(i=this,function(t,e){return null!=i.collection_save_timer&&clearTimeout(i.collection_save_timer),i.collection_save_timer=setTimeout(function(){return i.resetCollection(e,function(t){if(t)return $(window).trigger("xwing-collection:reset",e)})},1e3)}))},t.prototype.getSettings=function(n){return null==n&&(n=$.noop),$.get(this.server+"/settings").done(function(t,e,i){return n(t.settings)})},t.prototype.set=function(t,e,n){var i;return null==n&&(n=$.noop),(i={_method:"PUT"})[t]=e,$.post(this.server+"/settings",i).done(function(t,e,i){return n(t.set)})},t.prototype.deleteSetting=function(t,n){return null==n&&(n=$.noop),$.post(this.server+"/settings/"+t,{_method:"DELETE"}).done(function(t,e,i){return n(t.deleted)})},t.prototype.getHeaders=function(n){return null==n&&(n=$.noop),$.get(this.server+"/headers").done(function(t,e,i){return n(t.headers)})},t.prototype.getLanguagePreference=function(t,a){var s,l,o=__iced_k_noop,e=iced.findDeferral(arguments);if(null==a&&(a=$.noop),null!=(null!=t?t.language:void 0))return o(a(t.language,10));i=this;var i,n=function(){var t,e,i,n;if(null!=(null!=s?s.HTTP_ACCEPT_LANGUAGE:void 0))for(t=0,e=(i=s.HTTP_ACCEPT_LANGUAGE.split(",")).length;t<e;t++){n=i[t].split(";"),l=n[0],n[1],"*"===l?a("English",-.5):(l=l.split("-")[0])in exportObj.codeToLanguage?a(exportObj.codeToLanguage[l],8):a("English",-1);break}else a("English",-1);return o()};n=new iced.Deferrals(n,{parent:e,funcname:"SquadBuilderBackend.getLanguagePreference"}),i.getHeaders(n.defer({assign_fn:function(){return s=arguments[0]},lineno:992})),n._fulfill()},t.prototype.getCollectionCheck=function(t,e){return null==e&&(e=$.noop),null!=(null!=t?t.collectioncheck:void 0)?e(t.collectioncheck):e(this.collectioncheck=!0)},t.prototype.resetCollection=function(t,n){return null==n&&(n=$.noop),$.post(this.server+"/collection",{expansions:{},singletons:{},checks:{}}).done(function(t,e,i){return n(t.success)})},t.prototype.saveCollection=function(t,n){return null==n&&(n=$.noop),t={expansions:t.expansions,singletons:t.singletons,checks:t.checks},$.post(this.server+"/collection",t).done(function(t,e,i){return n(t.success)})},t.prototype.loadCollection=function(){return $.get(this.server+"/collection").done(function(t,e,i){t=t.collection;return new exportObj.Collection({expansions:t.expansions,singletons:t.singletons,checks:t.checks})})},t}(),exportObj="undefined"!=typeof exports&&null!==exports?exports:this,TYPES=["pilots","upgrades","ships","damage"],byName=function(t,e){t=(t.display_name||t.name).toLowerCase().replace(/[^a-zA-Z0-9]/g,""),e=(e.display_name||e.name).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");return t<e?-1:e<t?1:0},byPoints=function(t,e){return t.data.points<e.data.points?-1:e.data.points<t.data.points?1:byName(t,e)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},exportObj.CardBrowser=function(){function t(t){this.container=$(t.container),this.currently_selected=null,this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.prepareData(),this.setupUI(),this.setupHandlers()}return t.prototype.setupUI=function(){var t,e,c,i,u,h,n,p,f,a,s,l,o,r,d,m,_,b,g,v,x,k;for(e in this.container.append($.trim('<div class="container-fluid xwing-card-browser">\n    <div class="row">\n        <div class="col-md-4">\n            <div class="card card-search-container">\n            <h5 class="card-title translated" defaultText="Card Search"></h5>\n                <div class="advanced-search-container">\n                    <div class = "card search-container general-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="General"></h6>\n                        <label class = "text-search advanced-search-label">\n                        <strong class="translated" defaultText="Textsearch:"></strong>\n                            <input type="search" placeholder="'+exportObj.translate("ui","Placeholder Textsearch Browser")+'" class = "card-search-text">\n                        </label>\n                        <div class= "advanced-search-faction-selection-container">\n                            <label class = "advanced-search-label select-available-slots">\n                                <strong class="translated" defaultText="Factions:"></strong>\n                                <select class="advanced-search-selection faction-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","All factions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-point-selection-container">\n                            <strong class="translated" defaultText="Point cost:"></strong>\n                            <label class = "advanced-search-label set-minimum-points">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-point-cost advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-points">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-point-cost advanced-search-number-input" value="20" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-loadout-selection-container">\n                            <strong class="translated" defaultText="Loadout cost:"></strong>\n                            <label class = "advanced-search-label set-minimum-loadout">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-loadout-cost advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-loadout">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-loadout-cost advanced-search-number-input" value="99" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-collection-container">\n                            <strong class="translated" defaultText="Owned copies:"></strong>\n                            <label class = "advanced-search-label set-minimum-owned-copies">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-owned-copies advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-owened-copies">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-owned-copies advanced-search-number-input" value="99" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-misc-container">\n                            <strong class="translated" defaultText="Misc:"></strong>\n                            <label class = "advanced-search-label toggle-unique">\n                                <input type="checkbox" class="unique-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is unique"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-non-unique">\n                                <input type="checkbox" class="non-unique-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is not unique"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-limited">\n                                <input type="checkbox" class="limited-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is limited"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-standard">\n                                <input type="checkbox" class="standard-checkbox advanced-search-checkbox" />  <span class="translated" defaultText="Standard legal"></span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class = "card search-container ship-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="Ships and Pilots"></h6>\n                        <div class = "advanced-search-slot-available-container">\n                            <label class = "advanced-search-label select-available-slots">\n                                <strong class="translated" defaultText="Slots:"></strong>\n                                <select class="advanced-search-selection slot-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                            <br />\n                            <label class = "advanced-search-label toggle-unique">\n                                <input type="checkbox" class="duplicate-slots-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Has multiple of the chosen slots"></span> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-keyword-available-container">\n                            <label class = "advanced-search-label select-available-keywords">\n                                <strong class="translated" defaultText="Keywords:"></strong>\n                                <select class="advanced-search-selection keyword-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","keywords")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-actions-available-container">\n                            <label class = "advanced-search-label select-available-actions">\n                                <strong class="translated" defaultText="Actions:"></strong>\n                                <select class="advanced-search-selection action-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","actions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-linkedactions-available-container">\n                            <label class = "advanced-search-label select-available-linkedactions">\n                                <strong class="translated" defaultText="Linked actions:"></strong>\n                                <select class="advanced-search-selection linkedaction-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","actions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-ini-container">\n                            <strong class="translated" defaultText="Initiative:"></strong>\n                            <label class = "advanced-search-label set-minimum-ini">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-ini advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-ini">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-ini advanced-search-number-input" value="6" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-hull-container">\n                            <strong class="translated" defaultText="Hull:"></strong>\n                            <label class = "advanced-search-label set-minimum-hull">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-hull advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-hull">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-hull advanced-search-number-input" value="12" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-shields-container">\n                            <strong class="translated" defaultText="Shields:"></strong>\n                            <label class = "advanced-search-label set-minimum-shields">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-shields advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-shields">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-shields advanced-search-number-input" value="6" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-agility-container">\n                            <strong class="translated" defaultText="Agility:"></strong>\n                            <label class = "advanced-search-label set-minimum-agility">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-agility advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-agility">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-agility advanced-search-number-input" value="3" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-base-size-container">\n                            <strong class="translated" defaultText="Base size:"></strong>\n                            <label class = "advanced-search-label toggle-small-base">\n                                <input type="checkbox" class="small-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Small"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-medium-base">\n                                <input type="checkbox" class="medium-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Medium"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-large-base">\n                                <input type="checkbox" class="large-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Large"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-huge-base">\n                                <input type="checkbox" class="huge-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Huge"></span>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-attack-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-frontarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attack">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attack advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attack">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attack advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackt-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackt">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackt advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackt">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackt advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackdt-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-doubleturretarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackdt">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackdt advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackdt">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackdt advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackf-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-fullfrontarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackf">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackf advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackf">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackf advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackb-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-reararc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackb">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackb advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackb">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackb advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackbull-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackbull">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackbull advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackbull">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackbull advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                    </div>\n                    <div class = "card search-container other-stuff-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="Other Stuff"></h6>\n                        <div class = "advanced-search-slot-used-container">\n                            <label class = "advanced-search-label select-used-slots">\n                                <strong class="translated" defaultText="Used slot:"></strong>\n                                <select class="advanced-search-selection slot-used-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-slot-used-second-slot-container">\n                            <label class = "advanced-search-label select-used-second-slots">\n                                <strong class="translated" defaultText="Used double-slot:"></strong>\n                                <select class="advanced-search-selection slot-used-second-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                            <br />\n                            <label class = "advanced-search-label has-a-second-slot">\n                                <input type="checkbox" class="advanced-search-checkbox has-a-second-slot-checkbox" /> <span class="translated" defaultText="Only upgrades requiring multiple slots"></span>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-charge-container">\n                            <strong class="translated" defaultText="Charges:"></strong>\n                            <label class = "advanced-search-label set-minimum-charge">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-charge advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-charge">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-charge advanced-search-number-input" value="5" /> \n                            </label>\n                            <br />\n                            <label class = "advanced-search-label has-recurring-charge">\n                                <input type="checkbox" class="advanced-search-checkbox has-recurring-charge-checkbox" checked="checked"/> <span class="translated" defaultText="Recurring"></span>\n                            </label>\n                            <label class = "advanced-search-label has-not-recurring-charge">\n                                <input type="checkbox" class="advanced-search-checkbox has-not-recurring-charge-checkbox" checked="checked"/> <span class="translated" defaultText="Not recurring"></span>\n                            </label>\n                        <div class = "advanced-search-force-container">\n                            <strong class="translated" defaultText="Force:"></strong>\n                            <label class = "advanced-search-label set-minimum-force">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-force advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-force">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-force advanced-search-number-input" value="3" /> \n                            </label>\n                        </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="col-md-4 card-selecting-area">\n            <span class="translate sort-cards-by" defaultText="Sort cards by"></span><span class="translated" defaultText="Sort by">:</span> <select class="sort-by">\n                <option value="name" class="translated" defaultText="Name"></option>\n                <option value="source" class="translated" defaultText="Source"></option>\n                <option value="type-by-points" class="translated" defaultText="Type (by Points)"></option>\n                <option value="type-by-name" selected="1" class="translated" defaultText="Type (by Name)" selected="selected">'+exportObj.translate("ui","Type (by Name)")+'</option>\n            </select>\n            <div class="card-selector-container">\n\n            </div>\n            <br>\n            <div class="card-viewer-conditions-container">\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="card-viewer-container">\n            </div>\n        </div>\n    </div>\n</div>')),this.card_selector_container=$(this.container.find(".xwing-card-browser .card-selector-container")),this.card_viewer_container=$(this.container.find(".xwing-card-browser .card-viewer-container")),this.card_viewer_container.append($.trim(exportObj.builders[7].createInfoContainerUI(!1))),this.card_viewer_container.hide(),this.card_viewer_conditions_container=$(this.container.find(".xwing-card-browser .card-viewer-conditions-container")),this.card_viewer_conditions_container.hide(),this.advanced_search_container=$(this.container.find(".xwing-card-browser .advanced-search-container")),this.sort_selector=$(this.container.find("select.sort-by")),this.sort_selector.select2({minimumResultsForSearch:-1}),this.card_search_text=$(this.container.find(".xwing-card-browser .card-search-text"))[0],this.faction_selection=$(this.container.find(".xwing-card-browser select.faction-selection")),v=exportObj.pilotsByFactionXWS)v[e],(a=$(document.createElement("OPTION"))).val(e),a.text(exportObj.translate("faction",e)),this.faction_selection.append(a);for(s in(c=$(document.createElement("OPTION"))).val("Factionless"),c.text(exportObj.translate("faction","Factionless")),this.faction_selection.append(c),this.faction_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.minimum_point_costs=$(this.container.find(".xwing-card-browser .minimum-point-cost"))[0],this.maximum_point_costs=$(this.container.find(".xwing-card-browser .maximum-point-cost"))[0],this.minimum_loadout_costs=$(this.container.find(".xwing-card-browser .minimum-loadout-cost"))[0],this.maximum_loadout_costs=$(this.container.find(".xwing-card-browser .maximum-loadout-cost"))[0],this.standard_checkbox=$(this.container.find(".xwing-card-browser .standard-checkbox"))[0],this.unique_checkbox=$(this.container.find(".xwing-card-browser .unique-checkbox"))[0],this.non_unique_checkbox=$(this.container.find(".xwing-card-browser .non-unique-checkbox"))[0],this.limited_checkbox=$(this.container.find(".xwing-card-browser .limited-checkbox"))[0],this.base_size_checkboxes={Small:$(this.container.find(".xwing-card-browser .small-base-checkbox"))[0],Medium:$(this.container.find(".xwing-card-browser .medium-base-checkbox"))[0],Large:$(this.container.find(".xwing-card-browser .large-base-checkbox"))[0],Huge:$(this.container.find(".xwing-card-browser .huge-base-checkbox"))[0]},this.slot_available_selection=$(this.container.find(".xwing-card-browser select.slot-available-selection")),exportObj.upgradesBySlotCanonicalName)(a=$(document.createElement("OPTION"))).val(s),a.text(exportObj.translate("slot",s)),this.slot_available_selection.append(a);for(p in this.slot_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.keyword_available_selection=$(this.container.find(".xwing-card-browser select.keyword-available-selection")),n=[],exportObj.pilotsByKeyword)for(l=0,m=(h=p.split(",")).length;l<m;l++)i=h[l],n.indexOf(i)<0&&"undefined"!==i&&n.push(i);for(n.sort(),o=0,_=n.length;o<_;o++)u=n[o],(a=$(document.createElement("OPTION"))).val(u),a.text(exportObj.translate("keyword",u)),this.keyword_available_selection.append(a);for(this.keyword_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.duplicateslots=$(this.container.find(".xwing-card-browser .duplicate-slots-checkbox"))[0],this.action_available_selection=$(this.container.find(".xwing-card-browser select.action-available-selection")),r=0,b=(x=["Evade","Focus","Lock","Boost","Barrel Roll","Calculate","Reinforce","Rotate Arc","Coordinate","Slam","Reload","Jam","Cloak"].sort()).length;r<b;r++)t=x[r],(a=$(document.createElement("OPTION"))).text(exportObj.translate("action",t)),a.val(t),this.action_available_selection.append(a);for(this.action_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.linkedaction_available_selection=$(this.container.find(".xwing-card-browser select.linkedaction-available-selection")),d=0,g=(k=["Evade","Focus","Lock","Boost","Barrel Roll","Calculate","Reinforce","Rotate Arc","Coordinate","Slam","Reload","Jam","Cloak"].sort()).length;d<g;d++)f=k[d],(a=$(document.createElement("OPTION"))).text(exportObj.translate("action",f)),a.val(f),this.linkedaction_available_selection.append(a);for(s in this.linkedaction_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.slot_used_selection=$(this.container.find(".xwing-card-browser select.slot-used-selection")),exportObj.upgradesBySlotCanonicalName)(a=$(document.createElement("OPTION"))).text(exportObj.translate("slot",s)),a.val(s),this.slot_used_selection.append(a);for(s in this.slot_used_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.slot_used_second_selection=$(this.container.find(".xwing-card-browser select.slot-used-second-selection")),exportObj.upgradesBySlotCanonicalName)(a=$(document.createElement("OPTION"))).text(exportObj.translate("slot",s)),a.val(s),this.slot_used_second_selection.append(a);return this.slot_used_second_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.minimum_charge=$(this.container.find(".xwing-card-browser .minimum-charge"))[0],this.maximum_charge=$(this.container.find(".xwing-card-browser .maximum-charge"))[0],this.minimum_ini=$(this.container.find(".xwing-card-browser .minimum-ini"))[0],this.maximum_ini=$(this.container.find(".xwing-card-browser .maximum-ini"))[0],this.minimum_force=$(this.container.find(".xwing-card-browser .minimum-force"))[0],this.maximum_force=$(this.container.find(".xwing-card-browser .maximum-force"))[0],this.minimum_hull=$(this.container.find(".xwing-card-browser .minimum-hull"))[0],this.maximum_hull=$(this.container.find(".xwing-card-browser .maximum-hull"))[0],this.minimum_shields=$(this.container.find(".xwing-card-browser .minimum-shields"))[0],this.maximum_shields=$(this.container.find(".xwing-card-browser .maximum-shields"))[0],this.minimum_agility=$(this.container.find(".xwing-card-browser .minimum-agility"))[0],this.maximum_agility=$(this.container.find(".xwing-card-browser .maximum-agility"))[0],this.minimum_attack=$(this.container.find(".xwing-card-browser .minimum-attack"))[0],this.maximum_attack=$(this.container.find(".xwing-card-browser .maximum-attack"))[0],this.minimum_attackt=$(this.container.find(".xwing-card-browser .minimum-attackt"))[0],this.maximum_attackt=$(this.container.find(".xwing-card-browser .maximum-attackt"))[0],this.minimum_attackdt=$(this.container.find(".xwing-card-browser .minimum-attackdt"))[0],this.maximum_attackdt=$(this.container.find(".xwing-card-browser .maximum-attackdt"))[0],this.minimum_attackf=$(this.container.find(".xwing-card-browser .minimum-attackf"))[0],this.maximum_attackf=$(this.container.find(".xwing-card-browser .maximum-attackf"))[0],this.minimum_attackb=$(this.container.find(".xwing-card-browser .minimum-attackb"))[0],this.maximum_attackb=$(this.container.find(".xwing-card-browser .maximum-attackb"))[0],this.minimum_attackbull=$(this.container.find(".xwing-card-browser .minimum-attackbull"))[0],this.maximum_attackbull=$(this.container.find(".xwing-card-browser .maximum-attackbull"))[0],this.hassecondslot=$(this.container.find(".xwing-card-browser .has-a-second-slot-checkbox"))[0],this.recurring_charge=$(this.container.find(".xwing-card-browser .has-recurring-charge-checkbox"))[0],this.not_recurring_charge=$(this.container.find(".xwing-card-browser .has-not-recurring-charge-checkbox"))[0],this.minimum_owned_copies=$(this.container.find(".xwing-card-browser .minimum-owned-copies"))[0],this.maximum_owned_copies=$(this.container.find(".xwing-card-browser .maximum-owned-copies"))[0],exportObj.translateUIElements(this.container)},t.prototype.setupHandlers=function(){var c,u,e,i,h,p,n,t,a,s,l,o,r,d,f,m,_,b,g,v,x,k,y,w,q,O,S,j,T,C,I,L,A,U,P,E,D,M,B,z,N,R,F,W,G,H,X,Q,V,Y,Z,J,K;for(c in this.sort_selector.change((e=this,function(t){return e.renderList(e.sort_selector.val())})),$("#browserTab").on("click",(i=this,function(t){return i.renderList(i.sort_selector.val())})),$(window).on("xwing:afterLanguageLoad",(n=this,function(t,e,i){return null==i&&(i=$.noop),n.language=e,n.prepareData()})).on("xwing-collection:created",(p=this,function(t,e){return p.collection=e})).on("xwing-collection:destroyed",(h=this,function(t,e){return h.collection=null})),this.card_search_text.oninput=(t=this,function(){return t.renderList(t.sort_selector.val())}),this.skip_nontext_search=!0,this.faction_selection[0].onchange=(a=this,function(){return a.renderList_advanced(a.sort_selector.val())}),u=this.base_size_checkboxes)u[c].onclick=function(t){return function(){return t.renderList_advanced(t.sort_selector.val())}}(this);return this.minimum_point_costs.oninput=(s=this,function(){return s.renderList_advanced(s.sort_selector.val())}),this.maximum_point_costs.oninput=(l=this,function(){return l.renderList_advanced(l.sort_selector.val())}),this.minimum_loadout_costs.oninput=(o=this,function(){return o.renderList_advanced(o.sort_selector.val())}),this.maximum_loadout_costs.oninput=(r=this,function(){return r.renderList_advanced(r.sort_selector.val())}),this.standard_checkbox.onclick=(d=this,function(){return d.renderList_advanced(d.sort_selector.val())}),this.unique_checkbox.onclick=(f=this,function(){return f.renderList_advanced(f.sort_selector.val())}),this.non_unique_checkbox.onclick=(m=this,function(){return m.renderList_advanced(m.sort_selector.val())}),this.limited_checkbox.onclick=(_=this,function(){return _.renderList_advanced(_.sort_selector.val())}),this.slot_available_selection[0].onchange=(b=this,function(){return b.renderList_advanced(b.sort_selector.val())}),this.keyword_available_selection[0].onchange=(g=this,function(){return g.renderList_advanced(g.sort_selector.val())}),this.duplicateslots.onclick=(v=this,function(){return v.renderList_advanced(v.sort_selector.val())}),this.action_available_selection[0].onchange=(x=this,function(){return x.renderList_advanced(x.sort_selector.val())}),this.linkedaction_available_selection[0].onchange=(k=this,function(){return k.renderList_advanced(k.sort_selector.val())}),this.slot_used_selection[0].onchange=(y=this,function(){return y.renderList_advanced(y.sort_selector.val())}),this.slot_used_second_selection[0].onchange=(w=this,function(){return w.renderList_advanced(w.sort_selector.val())}),this.not_recurring_charge.onclick=(q=this,function(){return q.renderList_advanced(q.sort_selector.val())}),this.recurring_charge.onclick=(O=this,function(){return O.renderList_advanced(O.sort_selector.val())}),this.hassecondslot.onclick=(S=this,function(){return S.renderList_advanced(S.sort_selector.val())}),this.minimum_charge.oninput=(j=this,function(){return j.renderList_advanced(j.sort_selector.val())}),this.maximum_charge.oninput=(T=this,function(){return T.renderList_advanced(T.sort_selector.val())}),this.minimum_ini.oninput=(C=this,function(){return C.renderList_advanced(C.sort_selector.val())}),this.maximum_ini.oninput=(I=this,function(){return I.renderList_advanced(I.sort_selector.val())}),this.minimum_hull.oninput=(L=this,function(){return L.renderList_advanced(L.sort_selector.val())}),this.maximum_hull.oninput=(A=this,function(){return A.renderList_advanced(A.sort_selector.val())}),this.minimum_force.oninput=(U=this,function(){return U.renderList_advanced(U.sort_selector.val())}),this.maximum_force.oninput=(P=this,function(){return P.renderList_advanced(P.sort_selector.val())}),this.minimum_shields.oninput=(E=this,function(){return E.renderList_advanced(E.sort_selector.val())}),this.maximum_shields.oninput=(D=this,function(){return D.renderList_advanced(D.sort_selector.val())}),this.minimum_agility.oninput=(M=this,function(){return M.renderList_advanced(M.sort_selector.val())}),this.maximum_agility.oninput=(B=this,function(){return B.renderList_advanced(B.sort_selector.val())}),this.minimum_attack.oninput=(z=this,function(){return z.renderList_advanced(z.sort_selector.val())}),this.maximum_attack.oninput=(N=this,function(){return N.renderList_advanced(N.sort_selector.val())}),this.minimum_attackt.oninput=(R=this,function(){return R.renderList_advanced(R.sort_selector.val())}),this.maximum_attackt.oninput=(F=this,function(){return F.renderList_advanced(F.sort_selector.val())}),this.minimum_attackdt.oninput=(W=this,function(){return W.renderList_advanced(W.sort_selector.val())}),this.maximum_attackdt.oninput=(G=this,function(){return G.renderList_advanced(G.sort_selector.val())}),this.minimum_attackf.oninput=(H=this,function(){return H.renderList_advanced(H.sort_selector.val())}),this.maximum_attackf.oninput=(X=this,function(){return X.renderList_advanced(X.sort_selector.val())}),this.minimum_attackb.oninput=(Q=this,function(){return Q.renderList_advanced(Q.sort_selector.val())}),this.maximum_attackb.oninput=(V=this,function(){return V.renderList_advanced(V.sort_selector.val())}),this.minimum_attackbull.oninput=(Y=this,function(){return Y.renderList_advanced(Y.sort_selector.val())}),this.maximum_attackbull.oninput=(Z=this,function(){return Z.renderList_advanced(Z.sort_selector.val())}),this.minimum_owned_copies.oninput=(J=this,function(){return J.renderList_advanced(J.sort_selector.val())}),this.maximum_owned_copies.oninput=(K=this,function(){return K.renderList_advanced(K.sort_selector.val())})},t.prototype.prepareData=function(){var a,i,n,c,t,s,l,e,o,r,d,u,h,p,f,m,_,b,g,v,x,k,y,w,q;for(this.all_cards=[],o=0,h=TYPES.length;o<h;o++)l=TYPES[o],this.all_cards="upgrades"===l?this.all_cards.concat(function(){var t=exportObj[l],e=[];for(n in t)i=t[n],e.push({name:i.name,display_name:i.display_name,type:exportObj.translate("ui","upgradeHeader",i.slot),data:i,orig_type:i.slot});return e}()):"damage"===l?this.all_cards.concat(function(){var t=exportObj[l],e=[];for(n in t)i=t[n],e.push({name:i.name,display_name:i.display_name,type:exportObj.translate("ui","damageHeader",i.type),data:i,orig_type:"Damage"});return e}()):this.all_cards.concat(function(){var t=exportObj[l],e=[];for(n in t)i=t[n],e.push({name:i.name,display_name:i.display_name,type:exportObj.translate("singular",l),data:i,orig_type:exportObj.translateToLang("English","singular",l)});return e}());for(n in this.types=function(){for(var t=["Pilot","Ship"],e=[],i=0,n=t.length;i<n;i++)l=t[i],e.push(exportObj.translate("types",l));return e}(),x=exportObj.upgrades)i=x[n],e=exportObj.translate("ui","upgradeHeader",i.slot),__indexOf.call(this.types,e)<0&&this.types.push(e);for(n in k=exportObj.damage)i=k[n],e=exportObj.translate("ui","damageHeader",i.type),__indexOf.call(this.types,e)<0&&this.types.push(e);for(this.all_cards.sort(byName),this.sources=[],r=0,p=(y=this.all_cards).length;r<p;r++)for(d=0,f=(w=(a=y[r]).data.sources).length;d<f;d++)s=w[d],__indexOf.call(this.sources,s)<0&&this.sources.push(s);for(t=this.types.sort(),c=this.sources.sort(),this.cards_by_type_name={},u=0,m=t.length;u<m;u++)l=t[u],this.cards_by_type_name[l]=function(){for(var t=this.all_cards,e=[],i=0,n=t.length;i<n;i++)(a=t[i]).type===l&&e.push(a);return e}.call(this).sort(byName);for(this.cards_by_type_points={},g=0,_=t.length;g<_;g++)l=t[g],this.cards_by_type_points[l]=function(){for(var t=this.all_cards,e=[],i=0,n=t.length;i<n;i++)(a=t[i]).type===l&&e.push(a);return e}.call(this).sort(byPoints);for(this.cards_by_source={},q=[],v=0,b=c.length;v<b;v++)s=c[v],q.push(this.cards_by_source[s]=function(){for(var t=this.all_cards,e=[],i=0,n=t.length;i<n;i++)a=t[i],0<=__indexOf.call(a.data.sources,s)&&e.push(a);return e}.call(this).sort(byName));return q},t.prototype.renderList_advanced=function(t){return null==t&&(t="name"),this.skip_nontext_search=!1,this.renderList(t)},t.prototype.renderList=function(c){var t,e,i,u,n,a,s,l,o,h,p,f,m,_,b,g,r,d,v,x,k,y,w,q,O,S,j;switch(null==c&&(c="name"),null!=this.card_selector?this.card_selector.empty():(this.card_selector=$(document.createElement("SELECT")),this.card_selector.addClass("card-selector"),this.card_selector.attr("size",25),this.card_selector_container.append(this.card_selector)),this.setupSearch(),c){case"type-by-name":for(a=0,h=(x=this.types).length;a<h;a++){for(n=x[a],(i=$(document.createElement("OPTGROUP"))).attr("label",n),e=!1,s=0,p=(k=this.cards_by_type_name[n]).length;s<p;s++)t=k[s],this.checkSearchCriteria(t)&&(this.addCardTo(i,t),e=!0);e&&this.card_selector.append(i)}break;case"type-by-points":for(l=0,f=(y=this.types).length;l<f;l++){for(n=y[l],(i=$(document.createElement("OPTGROUP"))).attr("label",n),e=!1,o=0,m=(w=this.cards_by_type_points[n]).length;o<m;o++)t=w[o],this.checkSearchCriteria(t)&&(this.addCardTo(i,t),e=!0);e&&this.card_selector.append(i)}break;case"source":for(r=0,_=(q=this.sources).length;r<_;r++){for(u=q[r],(i=$(document.createElement("OPTGROUP"))).attr("label",exportObj.translate("sources",u)),e=!1,d=0,b=(O=this.cards_by_source[u]).length;d<b;d++)t=O[d],this.checkSearchCriteria(t)&&(this.addCardTo(i,t),e=!0);e&&this.card_selector.append(i)}break;default:for(v=0,g=(S=this.all_cards).length;v<g;v++)t=S[v],this.checkSearchCriteria(t)&&this.addCardTo(this.card_selector,t)}return this.card_selector.change((j=this,function(t){return j.renderCard($(j.card_selector.find(":selected")))}))},t.prototype.renderCard=function(t){t.data("display_name"),t.data("name");var e,i,n,a,s,l,o,r=t.data("card"),t=t.data("orig_type");if("Pilot"!==t&&"Ship"!==t&&"Quickbuild"!==t&&"Damage"!==t&&(e={addon_type:t},t="Addon"),"Pilot"===t&&this.card_viewer_container.find("tr.info-faction").show(),this.card_viewer_container.show(),exportObj.builders[7].showTooltip(t,r,null!=e?e:{},this.card_viewer_container),null==(null!=r?r.applies_condition:void 0))return this.card_viewer_conditions_container.hide();if(n=new Set,r.applies_condition instanceof Array)for(a=0,s=(l=r.applies_condition).length;a<s;a++)i=l[a],n.add(exportObj.conditionsByCanonicalName[i]);else n.add(exportObj.conditionsByCanonicalName[r.applies_condition]);return this.card_viewer_conditions_container.text(""),n.forEach((o=this,function(t){var e=$(document.createElement("div"));return e.addClass("conditions-container d-flex flex-wrap"),e.append(conditionToHTML(t)),o.card_viewer_conditions_container.append(e)})),this.card_viewer_conditions_container.show()},t.prototype.addCardTo=function(t,e){var i=$(document.createElement("OPTION"));return i.text((e.display_name||e.name)+" ("+(null!=e.data.points?e.data.points:null!=e.data.quantity?e.data.quantity+"x":"*")+(null!=e.data.loadout?"/"+e.data.loadout:"")+")"),i.data("name",e.name),i.data("display_name",e.display_name),i.data("type",e.type),i.data("card",e.data),i.data("orig_type",e.orig_type),0===this.getCollectionNumber(e)&&i[0].classList.add("result-not-in-collection"),$(t).append(i)},t.prototype.getCollectionNumber=function(t){var e,i;if(null==exportObj.builders[7].collection||null==exportObj.builders[7].collection.counts)return-1;switch(e=0,t.orig_type){case"Pilot":e=null!=(i=null!=(i=exportObj.builders[7].collection.counts.pilot)?i[t.name]:void 0)?i:0;break;case"Ship":e=null!=(i=null!=(i=exportObj.builders[7].collection.counts.ship)?i[t.name]:void 0)?i:0;break;default:e=null!=(i=null!=(i=exportObj.builders[7].collection.counts.upgrade)?i[t.name]:void 0)?i:0}return e},t.prototype.setupSearch=function(){if(this.searchInputs={text:this.card_search_text.value.toLowerCase(),factions:this.faction_selection.val(),required_slots:this.slot_available_selection.val(),required_actions:this.action_available_selection.val(),required_linked_actions:this.linkedaction_available_selection.val(),required_keywords:this.keyword_available_selection.val(),used_slots:this.slot_used_selection.val(),used_second_slots:this.slot_used_second_selection.val()},0<=__indexOf.call(this.searchInputs.factions,"Factionless"))return this.searchInputs.factions.push(void 0)},t.prototype.checkSearchCriteria=function(t){var e,i,n,c,u,h,p,f,a,m,_,b,g,v,x,k,y,s,l,o,r,w,q,O,S,$,j,T,C,I,L,A,U,P,E,D,M,B,z,N,R,F,W,G,H,X,Q,V,Y,Z,J,K,tt,et,it,nt,at,st,lt,ot,rt,dt,d,ct,ut,ht,pt,ft,mt,_t,bt;if(null!=this.searchInputs.text&&!(-1<t.name.toLowerCase().indexOf(this.searchInputs.text)||t.data.text&&-1<t.data.text.toLowerCase().indexOf(this.searchInputs.text)||t.display_name&&-1<t.display_name.toLowerCase().indexOf(this.searchInputs.text))){if(!t.data.ship)return!1;if((l=t.data.ship)instanceof Array){for(O=!1,j=0,L=l.length;j<L;j++)if(-1<(y=l[j]).toLowerCase().indexOf(this.searchInputs.text)||exportObj.ships[y].display_name&&-1<exportObj.ships[y].display_name.toLowerCase().indexOf(this.searchInputs.text)){O=!0;break}if(!O)return!1}else if(!(-1<l.toLowerCase().indexOf(this.searchInputs.text)||exportObj.ships[l].display_name&&-1<exportObj.ships[l].display_name.toLowerCase().indexOf(this.searchInputs.text)))return!1}if(this.skip_nontext_search)return!0;if(o=function(){var t=exportObj.pilotsByFactionXWS,e=[];for(n in t)b=t[n],e.push(n);return e}(),0<(s=this.searchInputs.factions).length){if(et=t.data.faction,!(0<=__indexOf.call(s,et)||"Ship"===t.orig_type||t.data.faction instanceof Array))return!1;if(t.data.faction instanceof Array){for(c=!1,T=0,A=(it=t.data.faction).length;T<A;T++)if(n=it[T],0<=__indexOf.call(s,n)){c=!0;break}if(!c)return!1}if("Ship"===t.orig_type){for(c=!1,C=0,N=(rt=t.data.factions).length;C<N;C++)if(n=rt[C],0<=__indexOf.call(s,n)){c=!0;break}if(!c)return!1}}else s=o;if(this.standard_checkbox.checked){for(q=!1,I=0,R=(dt=null!=t.data.faction?Array.isArray(t.data.faction)?t.data.faction:[t.data.faction]:s).length;I<R;I++)n=dt[I],__indexOf.call(s,n)<0||(q=q||exportObj.standardCheckBrowser(t.data,n,t.orig_type));if(!q)return!1}if(0<(k=this.searchInputs.required_slots).length)for(w=t.data.slots,V=0,F=k.length;V<F;V++){if(!(("Torpedo"===(r=k[V])||"Missile"===r||"Cannon"===r)&&null!=w&&0<=__indexOf.call(w,"HardpointShip")||null!=w&&0<=__indexOf.call(w,r)))return!1;if(this.duplicateslots.checked&&0===w.filter(function(t,e,i){return i.indexOf(t)===e&&e!==i.lastIndexOf(t)&&t===r}).length)return!1}if(0<(x=this.searchInputs.required_keywords).length)for(h=t.data.keyword,Y=0,W=x.length;Y<W;Y++)if(u=x[Y],!(null!=h&&0<=__indexOf.call(h,u)))return!1;if(et=this.searchInputs.required_actions,o=this.searchInputs.required_linked_actions,(0<et.length||0<o.length)&&(i=null!=(d=t.data.actions)?d:[],"Pilot"===t.orig_type&&(i=(i=null!=(d=null!=(d=t.data.ship_override)?d.actions:void 0)?d:exportObj.ships[t.data.ship].actions).concat(null!=(d=null!=(d=t.data.ship_override)?d.actionsred:void 0)?d:exportObj.ships[t.data.ship].actionsred),null!=t.data.keyword&&0<=__indexOf.call(t.data.keyword,"Droid")))){for(_=[],Z=0,G=i.length;Z<G;Z++)null!=(e=i[Z])&&_.push(e.replace("Focus","Calculate"));i=_}for(J=0,H=(ct=null!=et?et:[]).length;J<H;J++)if(e=ct[J],null==i||!(0<=__indexOf.call(i,e)||0<=__indexOf.call(i,"F-"+e)||0<=__indexOf.call(i,"R-"+e)))return!1;for(K=0,X=(nt=null!=o?o:[]).length;K<X;K++)if(e=nt[K],!(null!=i&&(0<=__indexOf.call(i,"R> "+e)||0<=__indexOf.call(i,"> "+e))))return!1;if(0<this.minimum_point_costs.value||this.maximum_point_costs.value<20){if(!(t.data.points>=this.minimum_point_costs.value&&t.data.points<=this.maximum_point_costs.value||null!=t.data.variablepoints))return!1;if(null!=t.data.variablepoints){for(a=!1,tt=0,Q=(at=t.data.pointsarray).length;tt<Q;tt++)if((v=at[tt])>=this.minimum_point_costs.value&&v<=this.maximum_point_costs.value){a=!0;break}if(!a)return!1}if("Ship"===t.orig_type){for(a=!1,ut=0,U=s.length;ut<U;ut++){for(m in n=s[ut],st=exportObj.pilotsByFactionCanonicalName[n]){for(ht=0,P=(g=st[m]).length;ht<P;ht++)if((b=g[ht]).ship===t.data.name&&b.points>=this.minimum_point_costs.value&&b.points<=this.maximum_point_costs.value){a=!0;break}if(a)break}if(a)break}if(!a)return!1}}if(0<this.minimum_loadout_costs.value||this.maximum_loadout_costs.value<99){if(!(t.data.loadout>=this.minimum_loadout_costs.value&&t.data.loadout<=this.maximum_loadout_costs.value))return!1;if("Ship"===t.orig_type){for(f=!1,pt=0,E=s.length;pt<E;pt++){for(m in n=s[pt],lt=exportObj.pilotsByFactionCanonicalName[n]){for(ft=0,D=(g=lt[m]).length;ft<D;ft++)if((b=g[ft]).ship===t.data.name&&b.loadout>=this.minimum_loadout_costs.value&&b.loadout<=this.maximum_loadout_costs.value){f=!0;break}if(f)break}if(f)break}if(!f)return!1}}if(0<($=this.searchInputs.used_slots).length){if(null==t.data.slot)return!1;for(p=!1,mt=0,M=$.length;mt<M;mt++)if(r=$[mt],t.data.slot===r){p=!0;break}if(!p)return!1}if(0<(S=this.searchInputs.used_second_slots).length){if(null==t.data.also_occupies_upgrades)return!1;for(p=!1,_t=0,B=S.length;_t<B;_t++)for(r=S[_t],bt=0,z=(ot=t.data.also_occupies_upgrades).length;bt<z;bt++)if(ot[bt]===r){p=!0;break}if(!p)return!1}if(null==t.data.also_occupies_upgrades&&this.hassecondslot.checked)return!1;if(this.unique_checkbox.checked&&!t.data.unique)return!1;if(this.non_unique_checkbox.checked&&t.data.unique)return!1;if(this.limited_checkbox.checked&&!t.data.max_per_squad)return!1;if(!(null!=t.data.charge&&t.data.charge<=this.maximum_charge.value&&t.data.charge>=this.minimum_charge.value||this.minimum_charge.value<=0&&null==t.data.charge))return!1;if(t.data.recurring&&!this.recurring_charge.checked)return!1;if(t.data.charge&&!t.data.recurring&&!this.not_recurring_charge.checked)return!1;if(null!=(null!=(d=exportObj.builders[7].collection)?d.counts:void 0)&&!((et=this.getCollectionNumber(t))>=this.minimum_owned_copies.value&&et<=this.maximum_owned_copies.value))return!1;if(null!=t.data.skill){if(!(t.data.skill>=this.minimum_ini.value&&t.data.skill<=this.maximum_ini.value))return!1}else if(!(this.minimum_ini.value<=0&&6<=this.maximum_ini.value))return!1;return!!(this.base_size_checkboxes.Small.checked&&this.base_size_checkboxes.Medium.checked&&this.base_size_checkboxes.Large.checked&&this.base_size_checkboxes.Huge.checked||(o=!1,"Ship"===t.orig_type?o=null!=t.data.base?o||this.base_size_checkboxes[t.data.base].checked:o||this.base_size_checkboxes.Small.checked:"Pilot"===t.orig_type&&(o=null!=(l=exportObj.ships[t.data.ship]).base?o||this.base_size_checkboxes[l.base].checked:o||this.base_size_checkboxes.Small.checked),o))&&(("0"===this.minimum_hull.value&&"12"===this.maximum_hull.value||null!=t.data.hull&&t.data.hull>=this.minimum_hull.value&&t.data.hull<=this.maximum_hull.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].hull>=this.minimum_hull.value&&exportObj.ships[t.data.ship].hull<=this.maximum_hull.value)&&(("0"===this.minimum_shields.value&&"6"===this.maximum_shields.value||null!=t.data.shields&&t.data.shields>=this.minimum_shields.value&&t.data.shields<=this.maximum_shields.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].shields>=this.minimum_shields.value&&exportObj.ships[t.data.ship].shields<=this.maximum_shields.value)&&(("0"===this.minimum_agility.value&&"3"===this.maximum_agility.value||null!=t.data.agility&&t.data.agility>=this.minimum_agility.value&&t.data.agility<=this.maximum_agility.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].agility>=this.minimum_agility.value&&exportObj.ships[t.data.ship].agility<=this.maximum_agility.value)&&(("0"===this.minimum_attack.value&&"5"===this.maximum_attack.value||null!=t.data.attack&&t.data.attack>=this.minimum_attack.value&&t.data.attack<=this.maximum_attack.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attack&&exportObj.ships[t.data.ship].attack>=this.minimum_attack.value&&exportObj.ships[t.data.ship].attack<=this.maximum_attack.value||null==exportObj.ships[t.data.ship].attack&&this.minimum_attack.value<=0)||"Ship"===t.orig_type&&null==t.data.attack&&this.minimum_attack.value<=0)&&(("0"===this.minimum_attackt.value&&"5"===this.maximum_attackt.value||null!=t.data.attackt&&t.data.attackt>=this.minimum_attackt.value&&t.data.attackt<=this.maximum_attackt.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackt&&exportObj.ships[t.data.ship].attackt>=this.minimum_attackt.value&&exportObj.ships[t.data.ship].attackt<=this.maximum_attackt.value||null==exportObj.ships[t.data.ship].attackt&&this.minimum_attackt.value<=0)||"Ship"===t.orig_type&&null==t.data.attackt&&this.minimum_attackt.value<=0)&&(("0"===this.minimum_attackdt.value&&"5"===this.maximum_attackdt.value||null!=t.data.attackdt&&t.data.attackdt>=this.minimum_attackdt.value&&t.data.attackdt<=this.maximum_attackdt.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackdt&&exportObj.ships[t.data.ship].attackdt>=this.minimum_attackdt.value&&exportObj.ships[t.data.ship].attackdt<=this.maximum_attackdt.value||null==exportObj.ships[t.data.ship].attackdt&&this.minimum_attackdt.value<=0)||"Ship"===t.orig_type&&null==t.data.attackdt&&this.minimum_attackdt.value<=0)&&(("0"===this.minimum_attackf.value&&"5"===this.maximum_attackf.value||null!=t.data.attackf&&t.data.attackf>=this.minimum_attackf.value&&t.data.attackf<=this.maximum_attackf.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackf&&exportObj.ships[t.data.ship].attackf>=this.minimum_attackf.value&&exportObj.ships[t.data.ship].attackf<=this.maximum_attackf.value||null==exportObj.ships[t.data.ship].attackf&&this.minimum_attackf.value<=0)||"Ship"===t.orig_type&&null==t.data.attackf&&this.minimum_attackf.value<=0)&&(("0"===this.minimum_attackb.value&&"5"===this.maximum_attackb.value||null!=t.data.attackb&&t.data.attackb>=this.minimum_attackb.value&&t.data.attackb<=this.maximum_attackb.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackb&&exportObj.ships[t.data.ship].attackb>=this.minimum_attackb.value&&exportObj.ships[t.data.ship].attackb<=this.maximum_attackb.value||null==exportObj.ships[t.data.ship].attackb&&this.minimum_attackb.value<=0)||"Ship"===t.orig_type&&null==t.data.attackb&&this.minimum_attackb.value<=0)&&(("0"===this.minimum_attackbull.value&&"5"===this.maximum_attackbull.value||null!=t.data.attackbull&&t.data.attackbull>=this.minimum_attackbull.value&&t.data.attackbull<=this.maximum_attackbull.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackbull&&exportObj.ships[t.data.ship].attackbull>=this.minimum_attackbull.value&&exportObj.ships[t.data.ship].attackbull<=this.maximum_attackbull.value||null==exportObj.ships[t.data.ship].attackbull&&this.minimum_attackbull.value<=0)||"Ship"===t.orig_type&&null==t.data.attackbull&&this.minimum_attackbull.value<=0)&&("0"===this.minimum_force.value&&"3"===this.maximum_force.value||null!=t.data.force&&t.data.force>=this.minimum_force.value&&t.data.force<=this.maximum_force.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].force>=this.minimum_force.value&&exportObj.ships[t.data.ship].force<=this.maximum_force.value||null==t.data.force&&"0"===this.minimum_force.value))))))))))},t}(),(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).RulesBrowser=function(){function t(t){this.container=$(t.container),this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.prepareRulesData(),this.setupRuleUI(),this.setupRulesHandlers()}return t.prototype.setupRuleUI=function(){var t,e;return this.container.append($.trim('<div class="container-fluid xwing-rules-browser">\n    <div class="row">\n        <div class="col-md-4">\n            <div class="card card-search-container">\n                <h5 class="card-title translated" defaultText="Rules Search"></h5>\n                <div class="advanced-search-container">\n                    <h6 class="card-subtitle mb-2 text-muted version"><span class="translated" defaultText="Version"></span>: </h6>\n                    <label class = "text-search advanced-search-label">\n                        <strong class="translated" defaultText="Term:"></strong>\n                        <input type="search" placeholder="'+exportObj.translate("ui","Search for game term or card")+'" class = "rule-search-text">\n                    </label>\n                </div>\n                <div class="rules-container card-selector-container">\n                </div>\n            </div>\n        </div>\n        <div class="col-md-8">\n            <div class="card card-viewer-container card-search-container">\n                <h4 class="card-title info-name"></h4>\n                <br />\n                <p class="info-text" />\n            </div>\n        </div>\n    </div>\n</div>')),this.versionlabel=$(this.container.find(".xwing-rules-browser .version")),this.rule_selector_container=$(this.container.find(".xwing-rules-browser .rules-container")),this.rule_viewer_container=$(this.container.find(".xwing-rules-browser .card-viewer-container")),this.rule_viewer_container.hide(),this.advanced_search_container=$(this.container.find(".xwing-rules-browser .advanced-search-container")),exportObj.translateUIElements(this.container),e=this.all_rules.version.number,t=this.all_rules.version.date,this.versionlabel.append(e+", "+t),this.rule_search_rules_text=$(this.container.find(".xwing-rules-browser .rule-search-text"))[0]},t.prototype.setupRulesHandlers=function(){var n,t;return this.renderRulesList(),$(window).on("xwing:afterLanguageLoad",(n=this,function(t,e,i){return null==i&&(i=$.noop),n.language=e,exportObj.loadRules(e),n.prepareRulesData(),n.renderRulesList()})),this.rule_search_rules_text.oninput=(t=this,function(){return t.renderRulesList()})},t.prototype.prepareRulesData=function(){return this.all_rules=exportObj.rulesEntries(),this.ruletype=["glossary","faq"]},t.prototype.renderRulesList=function(){var t,e,i,n,a,s,l,o,r,d;for(null!=this.rule_selector&&this.rule_selector.remove(),this.rule_selector=$(document.createElement("SELECT")),this.rule_selector.addClass("card-selector"),this.rule_selector.attr("size",25),this.rule_selector_container.append(this.rule_selector),s=0,l=(o=this.ruletype).length;s<l;s++){for(n in a=o[s],(t=$(document.createElement("OPTGROUP"))).attr("label",exportObj.translate("rulestypes",a)),e=!1,r=this.all_rules[a])i=r[n],this.checkRulesSearchCriteria(i)&&(this.addRulesTo(t,i),e=!0);e&&this.rule_selector.append(t)}return this.rule_selector.change((d=this,function(t){return d.renderRules($(d.rule_selector.find(":selected")))}))},t.prototype.renderRules=function(t){t={name:t.data("name"),text:t.data("text")};return this.rule_viewer_container.show(),exportObj.builders[0].showTooltip("Rules",t,"undefined"!=typeof add_opts&&null!==add_opts?add_opts:{},this.rule_viewer_container)},t.prototype.addRulesTo=function(t,e){var i=$(document.createElement("OPTION"));return i.text(""+e.name),i.data("name",e.name),i.data("text",exportObj.fixIcons(e)),$(t).append(i)},t.prototype.checkRulesSearchCriteria=function(t){var e=this.rule_search_rules_text.value.toLowerCase();return-1<t.name.toLowerCase().indexOf(e)||-1<(t.text&&t.text.toLowerCase().indexOf(e))},t}(),SHOW_DEBUG_OUT_MISSING_TRANSLATIONS=!(DFL_LANGUAGE="English"),builders=[],(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).languagePriority=-1;try{!function(){var t,e,i,n,a;if(!(3<exportObj.languagePriority)&&(exportObj.currentLanguage=DFL_LANGUAGE,-1!==exportObj.languagePriority)){for(a=[],i=0,n=(e=[navigator.language].concat(navigator.languages)).length;i<n;i++){if((t=(t=e[i]).split("-")[0])in exportObj.codeToLanguage){exportObj.currentLanguage=exportObj.codeToLanguage[t],exportObj.languagePriority=3;break}a.push(void 0)}}}()}catch(t){all=t,exportObj.currentLanguage=DFL_LANGUAGE}exportObj.loadCards=function(t){return exportObj.cardLoaders[t]()},exportObj.loadRules=function(t){return t in exportObj.ruleLoaders?(exportObj.rulesLang!==t&&(exportObj.ruleLoaders[t](),exportObj.rulesLang=t),!0):(exportObj.rulesLang!==DFL_LANGUAGE&&(exportObj.ruleLoaders[DFL_LANGUAGE](),exportObj.rulesLang=DFL_LANGUAGE),!1)},exportObj.translate=function(){var t=arguments[0],e=arguments[1],i=3<=arguments.length?__slice.call(arguments,2):[];return exportObj.translateToLang.apply(exportObj,[exportObj.currentLanguage,t,e].concat(__slice.call(i)))},exportObj.translateToLang=function(){var e,t=arguments[0],i=arguments[1],n=arguments[2],a=4<=arguments.length?__slice.call(arguments,3):[];try{e=exportObj.translations[t][i][n]}catch(t){all=t,e=void 0}return null!=e?e instanceof Function?e.apply(null,[exportObj.translate].concat(__slice.call(a))):e:t!==DFL_LANGUAGE?(SHOW_DEBUG_OUT_MISSING_TRANSLATIONS&&console.log(t+" translation for "+String(n)+" (category "+String(i)+") missing"),exportObj.translateToLang.apply(exportObj,[DFL_LANGUAGE,i,n].concat(__slice.call(a)))):n},exportObj.setupTranslationSupport=function(){var t,e,p;return p=builders,$(exportObj).on("xwing:languageChanged",function(c,i,t,e){var n,a,s,l,o,r,d,u=__iced_k_noop,h=iced.findDeferral(arguments);if(null==t&&(t=5),null==e&&(e=$.noop),"reload"!==t){if(t<exportObj.languagePriority)return;exportObj.languagePriority=t,exportObj.currentLanguage=i}if(!(i in exportObj.translations))return u();$(".language-placeholder").text(i),a="",o=(l=p).length,r=0,(d=function(t){var e=function(){return iced.trampoline(function(){return++r,d(t)})};if(!(r<o))return t();n=l[r],a=n.language,s=new iced.Deferrals(e,{parent:h}),n.container.trigger("xwing:beforeLanguageLoad",s.defer({lineno:2269})),s._fulfill()})(function(){var t,e;if(i!==a)exportObj.loadCards(i);for(exportObj.translateUIElements(),t=0,e=p.length;t<e;t++){n=p[t];n.container.trigger("xwing:afterLanguageLoad",i)}return u()})}),t=exportObj.basicCardData(),e=exportObj.basicQuickBuilds(),exportObj.canonicalizeShipNames(t),exportObj.ships=t.ships,exportObj.setupCommonCardData(t),exportObj.setupQuickBuilds(e),exportObj.loadCards(DFL_LANGUAGE),exportObj.loadRules(exportObj.currentLanguage),DFL_LANGUAGE!==exportObj.currentLanguage&&exportObj.loadCards(exportObj.currentLanguage),$(exportObj).trigger("xwing:languageChanged",[exportObj.currentLanguage,"reload"])},exportObj.translateUIElements=function(t){var e,i,n,a,s;for(null==t&&(t=void 0),s=[],i=0,n=(a=$(".translated",t)).length;i<n;i++)e=a[i],s.push(e.innerHTML=exportObj.translate("ui",e.getAttribute("defaultText")));return s},exportObj.setupTranslationUI=function(t){for(var e,n,i=Object.keys(exportObj.cardLoaders).sort(),a=function(e,i){return n.click(function(t){return null!=i&&i.set("language",e),$(exportObj).trigger("xwing:languageChanged",[e,100])})},s=[],l=0,o=i.length;l<o;l++)e=i[l],(n=$(document.createElement("LI"))).text(e),a(e,t),s.push($(".language-picker .dropdown-menu").append(n));return s},exportObj.registerBuilderForTranslation=function(t){if(__indexOf.call(builders,t)<0)return builders.push(t)},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).sortHelper=function(t,e){var i,n;return t.points===e.points?(i=t.text.replace(/[^a-z0-9]/gi,""))===(n=e.text.replace(/[^a-z0-9]/gi,""))?0:n<i?1:-1:"string"==typeof t.points||t.points>e.points?1:-1},exportObj.toTTS=function(t){return null==t?null:t.replace(/\(.*\)/g,"").replace("",'"').replace("",'"')},exportObj.slotsMatching=function(t,e){if(t===e)return!0;switch(t){case"HardpointShip":if("Torpedo"===e||"Cannon"===e||"Missile"===e)return!0;break;case"VersatileShip":if("Torpedo"===e||"Missile"===e)return!0}switch(e){case"HardpointShip":if("Torpedo"===t||"Cannon"===t||"Missile"===t)return!0;break;case"VersatileShip":if("Torpedo"===t||"Missile"===t)return!0}return!1},$.isMobile=function(){return!!(navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/i)||1<navigator.maxTouchPoints)},$.randomInt=function(t){return Math.floor(Math.random()*t)},$.isElementInView=function(t,e){var i=$(window).scrollTop(),n=i+$(window).height(),a=null!=(a=$(t))&&null!=(s=a.offset())?s.top:void 0,s=a+$(t).height();return e?i<a&&s<n:a<=n&&i<=s},$.getParameterByName=function(t){return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===(t=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search))?"":decodeURIComponent(t[1].replace(/\+/g," "))},Array.prototype.intersects=function(t){for(var e,i=0,n=this.length;i<n;i++)if(e=this[i],0<=__indexOf.call(t,e))return!0;return!1},Array.prototype.removeItem=function(t){t=this.indexOf(t);return-1!==t&&this.splice(t,1),this},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.getXWSBaseName=function(){return this.split("-")[0]},URL_BASE=window.location.protocol+"//"+window.location.host+window.location.pathname,SQUAD_DISPLAY_NAME_MAX_LENGTH=24,statAndEffectiveStat=function(t,e,i){return null!=t?""+t+(null!=e&&null!=e[i]&&e[i]!==t?" ("+e[i]+")":""):null!=e&&null!=e[i]?"0 ("+e[i]+")":"0"},getPrimaryFaction=function(t){switch(t){case"Rebel Alliance":return"Rebel Alliance";case"Galactic Empire":return"Galactic Empire";default:return t}},conditionToHTML=function(t){return $.trim('<div class="condition">\n    <div class="name">'+(t.unique?"&middot;&nbsp;":"")+(t.display_name||t.name)+'</div>\n    <div class="text">'+t.text+"</div>\n</div>")},exportObj.SquadBuilder=function(){function t(t){this._makeRandomizerLoopFunc=__bind(this._makeRandomizerLoopFunc,this),this._randomizerLoopBody=__bind(this._randomizerLoopBody,this),this.releaseUnique=__bind(this.releaseUnique,this),this.claimUnique=__bind(this.claimUnique,this),this.updatePrintAndExportTexts=__bind(this.updatePrintAndExportTexts,this),this.onSquadNameChanged=__bind(this.onSquadNameChanged,this),this.onSquadDirtinessChanged=__bind(this.onSquadDirtinessChanged,this),this.onSquadLoadRequested=__bind(this.onSquadLoadRequested,this),this.onPointsUpdated=__bind(this.onPointsUpdated,this),this.onGameTypeChanged=__bind(this.onGameTypeChanged,this),this.onNotesUpdated=__bind(this.onNotesUpdated,this),this.updatePermaLink=__bind(this.updatePermaLink,this),this.updateShipOrder=__bind(this.updateShipOrder,this),this.getPermaLink=__bind(this.getPermaLink,this),this.getPermaLinkParams=__bind(this.getPermaLinkParams,this),this.container=$(t.container),this.faction=$.trim(t.faction),this.printable_container=$(t.printable_container),this.tab=$(t.tab),this.show_points_destroyed=!1,this.ships=[],this.uniques_in_use={Pilot:[],Upgrade:[],Slot:[]},this.standard_list={Upgrade:[],Ship:[]},this.suppress_automatic_new_ship=!1,this.tooltip_currently_displaying=null,this.randomizer_options={sources:null,points:20,ship_limit:0,collection_only:!0,fill_zero_pts:!1},this.total_points=0,this.isStandard=null==(t=null!=(t=exportObj.builders[0])?t.isStandard:void 0)||t,this.isEpic=null!=(t=null!=(t=exportObj.builders[0])?t.isEpic:void 0)&&t,this.isQuickbuild=null!=(t=null!=(t=exportObj.builders[0])?t.isQuickbuild:void 0)&&t,this.backend=null,this.current_squad={},this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.collection=null,this.current_obstacles=[],this.setupUI(),"All"===this.faction?this.game_type_selector.val("epic").trigger("change"):this.game_type_selector.val((null!=(t=exportObj.builders[0])?t:this).game_type_selector.val()),this.setupEventHandlers(),window.setInterval(this.updatePermaLink,250),this.isUpdatingPoints=!1,$.getParameterByName("f")===this.faction?(this.resetCurrentSquad(!0),this.loadFromSerialized($.getParameterByName("d"))):(this.resetCurrentSquad(),this.addShip())}return t.prototype.resetCurrentSquad=function(t){var e,i,n;return null==t&&(t=!1),e=this.uitranslation("Unnamed Squadron"),i=$.trim(this.squad_name_input.val())||e,t&&$.trim($.getParameterByName("sn"))&&(i=$.trim($.getParameterByName("sn"))),n=[],t&&$.trim($.getParameterByName("obs"))?(n=$.trim($.getParameterByName("obs")).split(",").slice(0,3),this.updateObstacleSelect(n)):this.current_obstacles&&(n=this.current_obstacles),this.current_squad={id:null,name:i,dirty:!1,additional_data:{points:this.total_points,description:"",cards:[],notes:"",obstacles:n,tag:""},faction:this.faction},0<this.total_points&&(i===e&&(this.current_squad.name=this.uitranslation("Unsaved Squadron")),this.current_squad.dirty=!0),this.old_version_container.toggleClass("d-none",!0),this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.newSquadFromScratch=function(t){return null==t&&(t=this.uitranslation("New Squadron")),this.squad_name_input.val(t),this.removeAllShips(),this.suppress_automatic_new_ship||this.addShip(),this.updateObstacleSelect([]),this.resetCurrentSquad(),this.notes.val(""),this.tag.val("")},t.prototype.uitranslation=function(){var t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[];return exportObj.translate("ui",t,e)},t.prototype.setupUI=function(){var t,u,h,p,f,m,_,b,g,v,e,i,n,a,s,x,k,l,y,w,q,O,S,j,T,C,o,I,L,A,U,r,d,P,E,c,D,M,B;for(this.status_container=$(document.createElement("DIV")),this.status_container.addClass("container-fluid"),this.status_container.append($.trim('<div class="row squad-name-and-points-row">\n    <div class="col-md-3 squad-name-container">\n        <div class="display-name">\n            <span class="squad-name"></span>\n            <i class="far fa-edit"></i>\n        </div>\n        <div class="input-append">\n            <input type="text" maxlength="64" placeholder="'+this.uitranslation("Name your squad...")+'" />\n            <button class="btn save"><i class="fa fa-pen-square"></i></button>\n        </div>\n        <br />\n        <select class="game-type-selector">\n            <option value="standard" class="translated" defaultText="Standard" selected="selected">'+this.uitranslation("Standard")+'</option>\n            <option value="extended" class="translated" defaultText="Extended"></option>\n            <option value="epic" class="translated" defaultText="Epic"></option>\n            <option value="quickbuild" class="translated" defaultText="Quickbuild"></option>\n        </select>\n    </div>\n    <div class="col-md-4 points-display-container">\n        Points: <span class="total-points">0</span> / <input type="number" class="desired-points" value="20">\n        <span class="points-remaining-container">(<span class="points-remaining"></span>&nbsp;left) <span class="points-destroyed red"></span></span>\n        <span class="content-warning unreleased-content-used d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Unreleased content warning"></span></span>\n        <span class="content-warning loading-failed-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Broken squad link warning"></span></span>\n        <span class="content-warning old-version-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="This squad was created for an older version of X-Wing."></span></span>\n        <span class="content-warning collection-invalid d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Collection warning"></span></span>\n        <span class="content-warning ship-number-invalid-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Ship number warning"></span></span>\n        <span class="content-warning multi-faction-warning-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Multi-Faction warning"></span></span>\n        <span class="content-warning epic-not-legal-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Epic Unofficial"></span></span>\n    </div>\n    <div class="col-md-5 float-right button-container">\n        <div class="btn-group float-right">\n\n            <button class="btn btn-info view-as-text"><span class="d-none d-lg-block"><i class="fa fa-print"></i>&nbsp;<span class="translated" defaultText="Print/Export"></span></span><span class="d-lg-none"><i class="fa fa-print"></i></span></button>\n            <a class="btn btn-primary d-none collection"><span class="d-none d-lg-block"><i class="fa fa-folder-open"></i> <span class="translated" defaultText="Your Collection"></span></span><span class="d-lg-none"><i class="fa fa-folder-open"></i></span></a>\n            \x3c!-- Randomize button is marked as danger, since it creates a new squad --\x3e\n            <button class="btn btn-danger randomize"><span class="d-none d-lg-block"><i class="fa fa-random"></i> <span class="translated" defaultText="Randomize!"></span></span><span class="d-lg-none"><i class="fa fa-random"></i></span></button>\n            <button class="btn btn-danger dropdown-toggle" data-toggle="dropdown">\n                <span class="caret"></span>\n            </button>\n            <ul class="dropdown-menu">\n                <li><a class="dropdown-item randomize-options translated" defaultText="Randomizer Options"></a></li>\n                <li><a class="dropdown-item misc-settings translated" defaultText="Misc Settings"></a></li>\n            </ul>\n        </div>\n    </div>\n</div>\n\n<div class="row squad-save-buttons">\n    <div class="col-md-12">\n        <button class="show-authenticated btn btn-primary save-list"><i class="far fa-save"></i>&nbsp;<span class="translated" defaultText="Save"></span></button>\n        <button class="show-authenticated btn btn-primary save-list-as"><i class="far fa-file"></i>&nbsp;<span class="translated" defaultText="Save As..."></span></button>\n        <button class="show-authenticated btn btn-primary delete-list disabled"><i class="fa fa-trash"></i>&nbsp;<span class="translated" defaultText="Delete"></span></button>\n        <button class="show-authenticated btn btn-info backend-list-my-squads show-authenticated"><i class="fa fa-download"></i>&nbsp;<span class = "translated" defaultText="Load Squad"></span></button>\n        <button class="btn btn-info import-squad"><i class="fa fa-file-import"></i>&nbsp;<span class="translated" defaultText="Import"></span></button>\n        <button class="btn btn-info show-points-destroyed"><i class="fas fa-bullseye"></i>&nbsp;<span class="show-points-destroyed-span translated" defaultText="'+this.uitranslation("Show Points Destroyed")+'"></span></button>                    \n        <button class="btn btn-danger clear-squad"><i class="fa fa-plus-circle"></i>&nbsp;<span class="translated" defaultText="New Squad"></span></button>\n        <span class="show-authenticated backend-status"></span>\n    </div>\n</div>')),this.container.append(this.status_container),this.xws_import_modal=$(document.createElement("DIV")),this.xws_import_modal.addClass("modal fade import-modal d-print-none"),this.xws_import_modal.tabindex="-1",this.xws_import_modal.role="dialog",this.xws_import_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="XWS Import"></h3>\n            <button type="button" class="close d-print-none" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <span class="translated" defaultText="XWS Import Dialog"></span>\n            <div class="container-fluid">\n                <textarea class="xws-content" placeholder=\''+this.uitranslation("Paste XWS here")+'\'></textarea>\n            </div>\n        </div>\n        <div class="modal-footer d-print-none">\n            <span class="xws-import-status"></span>&nbsp;\n            <button class="btn btn-danger import-xws translated" defaultText="Import"></button>\n        </div>\n    </div>\n</div>')),this.from_xws_button=this.container.find("button.import-squad"),this.from_xws_button.click((_=this,function(t){return t.preventDefault(),_.xws_import_modal.find(".xws-import-status").text(" "),_.xws_import_modal.modal("show")})),this.load_xws_button=$(this.xws_import_modal.find("button.import-xws")),this.load_xws_button.click((b=this,function(t){return t.preventDefault(),exportObj.loadXWSButton(b.xws_import_modal)})),this.container.append(this.xws_import_modal),this.list_modal=$(document.createElement("DIV")),this.list_modal.addClass("modal fade text-list-modal"),this.list_modal.tabindex="-1",this.list_modal.role="dialog",this.container.append(this.list_modal),this.list_modal.append($.trim('<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <div class="d-print-none">\n                <h4 class="modal-title"><span class="squad-name"></span> (<span class="total-points"></span>)</h4>\n            </div>\n            <div class="d-none d-print-block">\n                <div class="fancy-header">\n                    <div class="squad-name"></div>\n                    <div class="squad-faction"></div>\n                    <div class="mask">\n                        <div class="outer-circle">\n                            <div class="inner-circle">\n                                <span class="total-points"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="fancy-under-header"></div>\n            </div>\n            <button type="button" class="close d-print-none" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <div class="fancy-list"></div>\n            <div class="simple-list"></div>\n            <div class="simplecopy-list">\n                <span class="translated" defaultText="Copy below simple text"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="reddit-list">\n                <span class="translated" defaultText="Copy below markdown"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="tts-list">\n                <span class="translated" defaultText="Copy below TTS"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="xws-list">\n                <span class="translated" defaultText="Copy below XWS"></span>\n                <div class="row full-row">\n                    <div class="col d-inline-block d-none d-sm-block"><textarea></textarea><br /><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button></div>\n                    <div class="col d-inline-block d-none d-sm-block qrcode-container" id="xws-qrcode-container"></div>\n                </div>\n            </div>\n        </div>\n        <div class="container-fluid modal-footer d-print-none">\n            <div class="row full-row">\n                <div class="col d-inline-block d-none d-sm-block right-col">\n                    <label class="color-skip-text-checkbox">\n                        <span class="translated" defaultText="Skip Card Text"></span> <input type="checkbox" class="toggle-skip-text-print" />\n                    </label><br />\n                    <label class="horizontal-space-checkbox">\n                        <span class="translated" defaultText="Space for Cards"></span> <input type="checkbox" class="toggle-horizontal-space" />\n                    </label><br />\n                    <label class="maneuver-print-checkbox">\n                        <span class="translated" defaultText="Include Maneuvers Chart"></span> <input type="checkbox" class="toggle-maneuver-print" />\n                    </label><br />\n                    <label class="expanded-shield-hull-print-checkbox">\n                        <span class="translated" defaultText="Expand Shield and Hull"></span> <input type="checkbox" class="toggle-expanded-shield-hull-print" />\n                    </label>\n                </div>\n                <div class="col d-inline-block d-none d-sm-block right-col">\n                    <label class="color-print-checkbox">\n                        <span class="translated" defaultText="Print Color"></span> <input type="checkbox" class="toggle-color-print" checked="checked" />\n                    </label><br />\n                    <label class="qrcode-checkbox">\n                        <span class="translated" defaultText="Include QR codes"></span> <input type="checkbox" class="toggle-juggler-qrcode" checked="checked" />\n                    </label><br />\n                    <label class="obstacles-checkbox">\n                        <span class="translated" defaultText="Include Obstacle Choices"></span> <input type="checkbox" class="toggle-obstacles" checked="checked" />\n                    </label>\n                </div>\n            </div>\n            <div class="row btn-group list-display-mode">\n                <button class="btn btn-modal select-simple-view translated" defaultText="Simple"></button>\n                <button class="btn btn-modal select-fancy-view translated" defaultText="Fancy"></button>\n                <button class="btn btn-modal select-simplecopy-view translated" defaultText="Text"></button>\n                <button class="btn btn-modal select-reddit-view translated" defaultText="Reddit"></button>\n                <button class="btn btn-modal select-tts-view d-none d-sm-block translated" defaultText="TTS"></button>\n                <button class="btn btn-modal select-xws-view translated" defaultText="XWS"></button>\n            </div>\n            <div class="row btn-group list-display-mode">\n                <button class="btn btn-modal copy-url translated" defaultText="Copy URL"></button>\n                <button class="btn btn-modal print-list d-sm-block"><span class="d-none d-lg-block"><i class="fa fa-print"></i>&nbsp;<span class="translated" defaultText="Print"></span></span><span class="d-lg-none"><i class="fa fa-print"></i></span></button>\n            </div>\n        </div>\n    </div>\n</div>')),this.fancy_container=$(this.list_modal.find(".fancy-list")),this.fancy_total_points_container=$(this.list_modal.find("div.modal-header .total-points")),this.simple_container=$(this.list_modal.find("div.modal-body .simple-list")),this.reddit_container=$(this.list_modal.find("div.modal-body .reddit-list")),this.reddit_textarea=$(this.reddit_container.find("textarea")),this.reddit_textarea.attr("readonly","readonly"),this.simplecopy_container=$(this.list_modal.find("div.modal-body .simplecopy-list")),this.simplecopy_textarea=$(this.simplecopy_container.find("textarea")),this.simplecopy_textarea.attr("readonly","readonly"),this.tts_container=$(this.list_modal.find("div.modal-body .tts-list")),this.tts_textarea=$(this.tts_container.find("textarea")),this.tts_textarea.attr("readonly","readonly"),this.xws_container=$(this.list_modal.find("div.modal-body .xws-list")),this.xws_textarea=$(this.xws_container.find("textarea")),this.xws_textarea.attr("readonly","readonly"),this.toggle_vertical_space_container=$(this.list_modal.find(".horizontal-space-checkbox")),this.toggle_color_print_container=$(this.list_modal.find(".color-print-checkbox")),this.toggle_color_skip_text=$(this.list_modal.find(".color-skip-text-checkbox")),this.toggle_maneuver_dial_container=$(this.list_modal.find(".maneuver-print-checkbox")),this.toggle_expanded_shield_hull_container=$(this.list_modal.find(".expanded-shield-hull-print-checkbox")),this.toggle_qrcode_container=$(this.list_modal.find(".qrcode-checkbox")),this.toggle_obstacle_container=$(this.list_modal.find(".obstacles-checkbox")),this.btn_print_list=$(this.list_modal.find(".print-list"))[0],this.btn_copy_url=$(this.list_modal.find(".copy-url")),this.btn_copy_url.click((g=this,function(t){if(g.success=window.navigator.clipboard.writeText(window.location.href),g.self=$(t.currentTarget),g.success)return g.self.addClass("btn-success"),setTimeout(function(){return g.self.removeClass("btn-success")},1e3)})),["fullscreen","standalone","minimal-ui"].some(function(t){return window.matchMedia("(display-mode: "+t+")").matches})||this.btn_copy_url.hide(),this.list_modal.on("click","button.btn-copy",(v=this,function(t){if(v.self=$(t.currentTarget),v.self.siblings("textarea").select(),v.success=document.execCommand("copy"),v.success)return v.self.addClass("btn-success"),setTimeout(function(){return v.self.removeClass("btn-success")},1e3)})),this.select_simple_view_button=$(this.list_modal.find(".select-simple-view")),this.select_simple_view_button.click((e=this,function(t){if(e.select_simple_view_button.blur(),"simple"!==e.list_display_mode)return e.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),e.select_simple_view_button.addClass("btn-inverse"),e.list_display_mode="simple",e.simple_container.show(),e.fancy_container.hide(),e.simplecopy_container.hide(),e.reddit_container.hide(),e.tts_container.hide(),e.xws_container.hide(),e.toggle_vertical_space_container.hide(),e.toggle_color_print_container.hide(),e.toggle_color_skip_text.hide(),e.toggle_maneuver_dial_container.hide(),e.toggle_expanded_shield_hull_container.hide(),e.toggle_qrcode_container.show(),e.toggle_obstacle_container.show(),e.btn_print_list.disabled=!1})),this.select_fancy_view_button=$(this.list_modal.find(".select-fancy-view")),this.select_fancy_view_button.click((i=this,function(t){if(i.select_fancy_view_button.blur(),"fancy"!==i.list_display_mode)return i.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),i.select_fancy_view_button.addClass("btn-inverse"),i.list_display_mode="fancy",i.fancy_container.show(),i.simple_container.hide(),i.simplecopy_container.hide(),i.reddit_container.hide(),i.tts_container.hide(),i.xws_container.hide(),i.toggle_vertical_space_container.show(),i.toggle_color_print_container.show(),i.toggle_color_skip_text.show(),i.toggle_maneuver_dial_container.show(),i.toggle_expanded_shield_hull_container.show(),i.toggle_qrcode_container.show(),i.toggle_obstacle_container.show(),i.btn_print_list.disabled=!1})),this.select_reddit_view_button=$(this.list_modal.find(".select-reddit-view")),this.select_reddit_view_button.click((n=this,function(t){if(n.select_reddit_view_button.blur(),"reddit"!==n.list_display_mode)return n.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),n.select_reddit_view_button.addClass("btn-inverse"),n.list_display_mode="reddit",n.reddit_container.show(),n.simplecopy_container.hide(),n.tts_container.hide(),n.xws_container.hide(),n.simple_container.hide(),n.fancy_container.hide(),n.reddit_textarea.select(),n.reddit_textarea.focus(),n.toggle_vertical_space_container.hide(),n.toggle_color_print_container.hide(),n.toggle_color_skip_text.hide(),n.toggle_maneuver_dial_container.hide(),n.toggle_expanded_shield_hull_container.hide(),n.toggle_qrcode_container.hide(),n.toggle_obstacle_container.hide(),n.btn_print_list.disabled=!0})),this.select_simplecopy_view_button=$(this.list_modal.find(".select-simplecopy-view")),this.select_simplecopy_view_button.click((a=this,function(t){if(a.select_simplecopy_view_button.blur(),"simplecopy"!==a.list_display_mode)return a.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),a.select_simplecopy_view_button.addClass("btn-inverse"),a.list_display_mode="simplecopy",a.reddit_container.hide(),a.simplecopy_container.show(),a.tts_container.hide(),a.xws_container.hide(),a.simple_container.hide(),a.fancy_container.hide(),a.simplecopy_textarea.select(),a.simplecopy_textarea.focus(),a.toggle_vertical_space_container.hide(),a.toggle_color_print_container.hide(),a.toggle_color_skip_text.hide(),a.toggle_maneuver_dial_container.hide(),a.toggle_expanded_shield_hull_container.hide(),a.toggle_qrcode_container.hide(),a.toggle_obstacle_container.hide(),a.btn_print_list.disabled=!0})),this.select_tts_view_button=$(this.list_modal.find(".select-tts-view")),this.select_tts_view_button.click((s=this,function(t){if(s.select_tts_view_button.blur(),"tts"!==s.list_display_mode)return s.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),s.select_tts_view_button.addClass("btn-inverse"),s.list_display_mode="tts",s.tts_container.show(),s.xws_container.hide(),s.simple_container.hide(),s.simplecopy_container.hide(),s.reddit_container.hide(),s.fancy_container.hide(),s.tts_textarea.select(),s.tts_textarea.focus(),s.toggle_vertical_space_container.hide(),s.toggle_color_print_container.hide(),s.toggle_color_skip_text.hide(),s.toggle_maneuver_dial_container.hide(),s.toggle_expanded_shield_hull_container.hide(),s.toggle_qrcode_container.hide(),s.toggle_obstacle_container.hide(),s.btn_print_list.disabled=!0})),this.select_xws_view_button=$(this.list_modal.find(".select-xws-view")),this.select_xws_view_button.click((x=this,function(t){return x.select_xws_view()})),768<=$(window).width()?(this.simple_container.hide(),this.select_fancy_view_button.click()):this.select_simple_view_button.click(),this.clear_squad_button=$(this.status_container.find(".clear-squad")),this.clear_squad_button.click((k=this,function(t){return k.current_squad.dirty&&null!=k.backend?k.backend.warnUnsaved(k,function(){return k.newSquadFromScratch()}):k.newSquadFromScratch()})),this.show_points_destroyed_button=$(this.status_container.find(".show-points-destroyed")),this.show_points_destroyed_button_span=$(this.status_container.find(".show-points-destroyed-span")),this.show_points_destroyed_button.click((l=this,function(t){var e,i,n,a,s;for(l.show_points_destroyed=!l.show_points_destroyed,!1===l.show_points_destroyed?l.points_destroyed_span.hide():l.points_destroyed_span.show(),s=[],i=0,n=(a=l.ships).length;i<n;i++)null!=(e=a[i]).pilot?!1===l.show_points_destroyed?(l.show_points_destroyed_button_span.text(l.uitranslation("Show Points Destroyed")),s.push(e.points_destroyed_button.hide())):(l.show_points_destroyed_button_span.text(l.uitranslation("Hide Points Destroyed")),s.push(e.points_destroyed_button.show())):s.push(void 0);return s})),this.squad_name_container=$(this.status_container.find("div.squad-name-container")),this.squad_name_display=$(this.container.find(".display-name")),this.squad_name_placeholder=$(this.container.find(".squad-name")),this.squad_name_input=$(this.squad_name_container.find("input")),this.squad_name_save_button=$(this.squad_name_container.find("button.save")),this.squad_name_input.closest("div").hide(),this.points_container=$(this.status_container.find("div.points-display-container")),this.total_points_span=$(this.points_container.find(".total-points")),this.game_type_selector=$(this.status_container.find(".game-type-selector")),this.game_type_selector.select2({minimumResultsForSearch:-1}),this.game_type_selector.change((y=this,function(t){return y.onGameTypeChanged(y.game_type_selector.val())})),this.desired_points_input=$(this.points_container.find(".desired-points")),this.desired_points_input.change((w=this,function(t){return w.onPointsUpdated($.noop)})),this.points_remaining_span=$(this.points_container.find(".points-remaining")),this.points_destroyed_span=$(this.points_container.find(".points-destroyed")),this.points_remaining_container=$(this.points_container.find(".points-remaining-container")),this.unreleased_content_used_container=$(this.points_container.find(".unreleased-content-used")),this.loading_failed_container=$(this.points_container.find(".loading-failed-container")),this.old_version_container=$(this.points_container.find(".old-version-container")),this.ship_number_invalid_container=$(this.points_container.find(".ship-number-invalid-container")),this.multi_faction_warning_container=$(this.points_container.find(".multi-faction-warning-container")),this.epic_not_legal_container=$(this.points_container.find(".epic-not-legal-container")),this.collection_invalid_container=$(this.points_container.find(".collection-invalid")),this.view_list_button=$(this.status_container.find("div.button-container button.view-as-text")),this.randomize_button=$(this.status_container.find("div.button-container button.randomize")),this.customize_randomizer=$(this.status_container.find("div.button-container a.randomize-options")),this.misc_settings=$(this.status_container.find("div.button-container a.misc-settings")),this.backend_status=$(this.status_container.find(".backend-status")),this.backend_status.hide(),this.collection_button=$(this.status_container.find("div.button-container a.collection")),this.collection_button.click((q=this,function(t){if(t.preventDefault(),!q.collection_button.prop("disabled"))return q.collection.modal.modal("show")})),this.squad_name_input.keypress((O=this,function(t){if(13===t.which)return O.squad_name_save_button.click(),!1})),this.squad_name_input.change((S=this,function(t){return S.backend_status.fadeOut("slow")})),this.squad_name_input.blur((j=this,function(t){return j.squad_name_input.change(),j.squad_name_save_button.click()})),this.squad_name_display.click((T=this,function(t){return t.preventDefault(),T.squad_name_display.hide(),T.squad_name_input.val($.trim(T.current_squad.name)),window.setTimeout(function(){return T.squad_name_input.focus(),T.squad_name_input.select()},100),T.squad_name_input.closest("div").show()})),this.squad_name_save_button.click((C=this,function(t){if(t.preventDefault(),C.current_squad.dirty=!0,C.container.trigger("xwing-backend:squadDirtinessChanged"),0<(C.current_squad.name=$.trim(C.squad_name_input.val())).length)return C.squad_name_display.show(),C.container.trigger("xwing-backend:squadNameChanged"),C.squad_name_input.closest("div").hide()})),this.randomizer_options_modal=$(document.createElement("DIV")),this.randomizer_options_modal.addClass("modal fade randomizer-modal"),this.randomizer_options_modal.tabindex="-1",this.randomizer_options_modal.role="dialog",$("body").append(this.randomizer_options_modal),this.randomizer_options_modal.append($.trim('<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Random Squad Builder Options"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <form>\n                <label>\n                    <span class="translated" defaultText="Maximum Ship Count"></span>\n                    <input type="number" class="randomizer-ship-limit" value="0" placeholder="0" />\n                </label><br />\n                <label>\n                    <input type="checkbox" class="randomizer-collection-only" checked="checked"/> \n                    <span class="translated" defaultText="Limit to collection"></span>\n                </label><br />\n                <label>\n                    <span class="translated" defaultText="Sets and Expansions"></span>\n                    <select class="randomizer-sources" multiple="1" data-placeholder=\''+this.uitranslation("All sets and expansions")+'\'>\n                    </select>\n                </label><br />\n                <label>\n                    <input type="checkbox" class="randomizer-fill-zero-pts" /> \n                    <span class="translated" defaultText="Always fill 0-point slots"></span>\n                </label><br />\n                <label>\n                    <span class="translated" defaultText="Maximum Seconds to Spend Randomizing"></span>\n                    <input type="number" class="randomizer-timeout" value="4" placeholder="4" />\n                </label>\n            </form>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-primary do-randomize translated" aria-hidden="true" defaultText="Roll!"></button>\n            <button class="btn translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),exportObj.translateUIElements(this.randomizer_options_modal),this.randomizer_source_selector=$(this.randomizer_options_modal.find("select.randomizer-sources")),p=0,f=(m=exportObj.expansions).length;p<f;p++)t=m[p],(h=$(document.createElement("OPTION"))).text(t),this.randomizer_source_selector.append(h);return this.randomizer_source_selector.select2({width:"100%",minimumResultsForSearch:$.isMobile()?-1:0}),this.randomizer_collection_selector=$(this.randomizer_options_modal.find(".randomizer-collection-only"))[0],this.randomizer_fill_zero_pts=$(this.randomizer_options_modal.find(".randomizer-fill-zero-pts"))[0],this.randomize_button.click((o=this,function(t){var e,i;return t.preventDefault(),o.current_squad.dirty&&null!=o.backend?o.backend.warnUnsaved(o,function(){return o.randomize_button.click()}):(t=parseInt(o.desired_points_input.val()),(isNaN(t)||t<=0)&&(t=20),e=parseInt($(o.randomizer_options_modal.find(".randomizer-ship-limit")).val()),(isNaN(e)||e<0)&&(e=0),i=parseInt($(o.randomizer_options_modal.find(".randomizer-timeout")).val()),(isNaN(i)||i<=0)&&(i=4),o.randomSquad(t,o.randomizer_source_selector.val(),1e3*i,e,o.randomizer_collection_selector.checked,o.randomizer_fill_zero_pts.checked))})),this.randomizer_options_modal.find("button.do-randomize").click((I=this,function(t){return t.preventDefault(),I.randomizer_options_modal.modal("hide"),I.randomize_button.click()})),this.customize_randomizer.click((L=this,function(t){return t.preventDefault(),L.randomizer_options_modal.modal()})),this.misc_settings_modal=$(document.createElement("DIV")),this.misc_settings_modal.addClass("modal fade"),this.misc_settings_modal.tabindex="-1",this.misc_settings_modal.role="dialog",$("body").append(this.misc_settings_modal),this.misc_settings_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Miscellaneous Settings"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <label class = "toggle-initiative-prefix-names misc-settings-label">\n                <input type="checkbox" class="initiative-prefix-names-checkbox misc-settings-checkbox" /> <span class="translated" defaultText="Use INI prefix"></span> \n            </label><br />\n            <label class = "enable-ban-list misc-settings-label">\n                <input type="checkbox" class="enable-ban-list-checkbox misc-settings-checkbox" /> <span class="translated" defaultText="Enable Ban List (Not Standard)"></span> \n            </label><br />\n        </div>\n        <div class="modal-footer">\n            <span class="misc-settings-infoline"></span>\n            &nbsp;\n            <button class="btn translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.misc_settings_infoline=$(this.misc_settings_modal.find(".misc-settings-infoline")),this.misc_settings_initiative_prefix=$(this.misc_settings_modal.find(".initiative-prefix-names-checkbox")),this.misc_settings_ban_list=$(this.misc_settings_modal.find(".enable-ban-list-checkbox")),null!=this.backend?this.backend.getSettings((U=this,function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=null!=t.showInitiativeInFrontOfPilotName,null!=t.showInitiativeInFrontOfPilotName&&U.misc_settings_initiative_prefix.prop("checked",!0),exportObj.settings.ban_list=null!=t.enableBanList,null!=t.enableBanList)return U.misc_settings_ban_list.prop("checked",!0)})):(null==this.waiting_for_backend&&(this.waiting_for_backend=[]),this.waiting_for_backend.push((A=this,function(){return A.backend.getSettings(function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=null!=t.showInitiativeInFrontOfPilotName,null!=t.showInitiativeInFrontOfPilotName&&A.misc_settings_initiative_prefix.prop("checked",!0),exportObj.settings.ban_list=null!=t.enableBanList,null!=t.enableBanList)return A.misc_settings_ban_list.prop("checked",!0)})}))),this.misc_settings_initiative_prefix.click((r=this,function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=r.misc_settings_initiative_prefix.prop("checked"),null!=r.backend)return r.misc_settings_initiative_prefix.prop("checked")?r.backend.set("showInitiativeInFrontOfPilotName","1",function(t){return r.misc_settings_infoline.text(r.uitranslation("Changes Saved")),r.misc_settings_infoline.fadeIn(100,function(){return r.misc_settings_infoline.fadeOut(3e3)})}):r.backend.deleteSetting("showInitiativeInFrontOfPilotName",function(t){return r.misc_settings_infoline.text(r.uitranslation("Changes Saved")),r.misc_settings_infoline.fadeIn(100,function(){return r.misc_settings_infoline.fadeOut(3e3)})})})),this.misc_settings_ban_list.click((d=this,function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.ban_list=d.misc_settings_ban_list.prop("checked"),null!=d.backend)return d.misc_settings_ban_list.prop("checked")?d.backend.set("enableBanList","1",function(t){return d.misc_settings_infoline.text(d.uitranslation("Changes Saved")),d.misc_settings_infoline.fadeIn(100,function(){return d.misc_settings_infoline.fadeOut(3e3)})}):d.backend.deleteSetting("enableBanList",function(t){return d.misc_settings_infoline.text(d.uitranslation("Changes Saved")),d.misc_settings_infoline.fadeIn(100,function(){return d.misc_settings_infoline.fadeOut(3e3)})})})),this.misc_settings.click((P=this,function(t){return t.preventDefault(),P.misc_settings_modal.modal(),P.misc_settings_initiative_prefix.prop("checked",null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix)})),exportObj.translateUIElements(this.misc_settings_modal),this.choose_obstacles_modal=$(document.createElement("DIV")),this.choose_obstacles_modal.addClass("modal fade choose-obstacles-modal"),this.choose_obstacles_modal.tabindex="-1",this.choose_obstacles_modal.role="dialog",this.container.append(this.choose_obstacles_modal),this.choose_obstacles_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <label class=\'choose-obstacles-description translated\' defaultText="Choose obstacles dialog"></label>\n        </div>\n        <div class="modal-body row">\n            <div class="obstacle-select-container col-md-12">\n            </div>\n            <div>\n                <div class="obstacle-sources-container">\n                    <span class="info-header obstacle-sources translated" defaultText="Sources:" style="padding-left: 8px;"></span> <br>\n                    <div class="info-data obstacle-sources" style="padding-left: 8px;padding-right:10px;"></div>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer d-print-none">\n            <button class="btn btn-danger reset-obstacles translated" defaultText="Reset Obstacles"></button>\n            <button class="btn btn-danger close-print-dialog translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.obstacles_reset=this.choose_obstacles_modal.find(".reset-obstacles"),this.obstacles_select=this.choose_obstacles_modal.find(".obstacle-select-container"),this.obstacles_select_sources=this.choose_obstacles_modal.find(".info-data.obstacle-sources"),u=function(t){return"<img class='obstacle' src='"+("images/"+t.id+".png")+"' style='height: 100px;' /></br>"+t.text},this.obstacle_data=[{id:"coreasteroid0",text:"Core Asteroid 1"},{id:"coreasteroid1",text:"Core Asteroid 2"},{id:"coreasteroid2",text:"Core Asteroid 3"},{id:"coreasteroid3",text:"Core Asteroid 4"},{id:"coreasteroid4",text:"Core Asteroid 5"},{id:"coreasteroid5",text:"Core Asteroid 6"},{id:"yt2400debris0",text:"YT2400 Debris 1"},{id:"yt2400debris1",text:"YT2400 Debris 2"},{id:"yt2400debris2",text:"YT2400 Debris 3"},{id:"vt49decimatordebris0",text:"VT49 Debris 1"},{id:"vt49decimatordebris1",text:"VT49 Debris 2"},{id:"vt49decimatordebris2",text:"VT49 Debris 3"},{id:"core2asteroid0",text:"FA Asteroid 1"},{id:"core2asteroid1",text:"FA Asteroid 2"},{id:"core2asteroid2",text:"FA Asteroid 3"},{id:"core2asteroid3",text:"FA Asteroid 4"},{id:"core2asteroid4",text:"FA Asteroid 5"},{id:"core2asteroid5",text:"FA Asteroid 6"},{id:"gascloud1",text:"Gas Cloud 1"},{id:"gascloud2",text:"Gas Cloud 2"},{id:"gascloud3",text:"Gas Cloud 3"},{id:"gascloud4",text:"Gas Cloud 4"},{id:"gascloud5",text:"Gas Cloud 5"},{id:"gascloud6",text:"Gas Cloud 6"},{id:"pomasteroid1",text:"PoM Rock 1"},{id:"pomasteroid2",text:"PoM Rock 2"},{id:"pomasteroid3",text:"PoM Rock 3"},{id:"pomdebris1",text:"PoM Debris 1"},{id:"pomdebris2",text:"PoM Debris 2"},{id:"pomdebris3",text:"PoM Debris 3"}],this.obstacles_select.select2({data:this.obstacle_data,width:"90%",multiple:!0,maximumSelectionSize:3,placeholder:"Select an Obstacle",minimumResultsForSearch:$.isMobile()?-1:0,formatResult:u,formatSelection:u}),$.isMobile()&&(this.obstacles_select.select2.minimumResultsForSearch=-1),this.backend_list_squads_button=$(this.container.find("button.backend-list-my-squads")),this.backend_list_squads_button.click((E=this,function(t){if(t.preventDefault(),null!=E.backend)return E.backend.list(E)})),this.backend_save_list_button=$(this.container.find("button.save-list")),this.backend_save_list_button.click((c=this,function(t){var e,i,n=__iced_k_noop,a=iced.findDeferral(arguments);if(t.preventDefault(),null==c.backend||c.backend_save_list_button.hasClass("disabled"))return n();e={points:c.total_points,description:c.describeSquad(),cards:c.listCards(),notes:c.notes.val().substr(0,1024),obstacles:c.getObstacles(),tag:c.tag.val().substr(0,1024)},c.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;<span class="translated" defaultText="Saving squad..."></span>')),c.backend_status.show(),c.backend_save_list_button.addClass("disabled"),a=new iced.Deferrals(function(){return n(i.success?(c.current_squad.dirty=false,c.current_squad.id!=null?c.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;<span class="translated" defaultText="Squad updated successfully."></span>')):(c.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;<span class="translated" defaultText="New squad saved successfully."></span>')),c.current_squad.id=i.id),c.container.trigger("xwing-backend:squadDirtinessChanged")):(c.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+i.error)),c.backend_save_list_button.removeClass("disabled")))},{parent:a}),c.backend.save(c.serialize(),c.current_squad.id,c.current_squad.name,c.faction,e,a.defer({assign_fn:function(){return i=arguments[0]},lineno:3383})),a._fulfill()})),this.backend_save_list_as_button=$(this.container.find("button.save-list-as")),this.backend_save_list_as_button.addClass("disabled"),this.backend_save_list_as_button.click((D=this,function(t){if(t.preventDefault(),null!=D.backend&&!D.backend_save_list_as_button.hasClass("disabled"))return D.backend.showSaveAsModal(D)})),this.backend_delete_list_button=$(this.container.find("button.delete-list")),this.backend_delete_list_button.click((M=this,function(t){if(t.preventDefault(),null!=M.backend&&!M.backend_delete_list_button.hasClass("disabled"))return M.backend.showDeleteModal(M)})),(u=$(document.createElement("DIV"))).addClass("container-fluid"),this.container.append(u),u.append($.trim('<div class="row">\n    <div class="col-md-9 ship-container">\n        <label class="unsortable notes-container show-authenticated col-md-10">\n            <span class="notes-name translated" defaultText="Squad Notes:"></span>\n            <br />\n            <textarea class="squad-notes"></textarea>\n            <br />\n            <span class="tag-name translated" defaultText="Tag:"></span>\n            <input type="search" class="squad-tag"></input>\n        </label>\n        <div class="unsortable obstacles-container">\n                <button class="btn btn-info choose-obstacles"><i class="fa fa-cloud"></i>&nbsp;<span class="translated" defaultText="Choose Obstacles"</span></button>\n        </div>\n    </div>\n    <div class="col-md-3 info-container" id="info-container">\n    </div>\n</div>')),this.ship_container=$(u.find("div.ship-container")),this.info_container=$(u.find("div.info-container")),this.obstacles_container=u.find(".obstacles-container"),this.notes_container=$(u.find(".notes-container")),this.notes=$(this.notes_container.find("textarea.squad-notes")),this.tag=$(this.notes_container.find("input.squad-tag")),this.ship_container.sortable({cancel:".unsortable"}),this.info_container.append($.trim(this.createInfoContainerUI())),this.info_container.find(".info-well").hide(),this.info_intro=this.info_container.find(".intro"),this.print_list_button=$(this.container.find("button.print-list")),this.container.find("[rel=tooltip]").tooltip(),this.obstacles_button=$(this.container.find("button.choose-obstacles")),this.obstacles_button.click((B=this,function(t){return t.preventDefault(),B.showChooseObstaclesModal()})),this.condition_container=$(document.createElement("div")),this.condition_container.addClass("conditions-container d-flex flex-wrap"),this.container.append(this.condition_container),this.mobile_tooltip_modal=$(document.createElement("DIV")),this.mobile_tooltip_modal.addClass("modal fade choose-obstacles-modal d-print-none"),this.mobile_tooltip_modal.tabindex="-1",this.mobile_tooltip_modal.role="dialog",this.container.append(this.mobile_tooltip_modal),this.mobile_tooltip_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n        </div>\n        <div class="modal-body">'+this.createInfoContainerUI(!1)+'        </div>\n        <div class="modal-footer">\n            <button class="btn btn-danger close-print-dialog translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.mobile_tooltip_modal.find("intro").hide(),exportObj.translateUIElements(this.container)},t.prototype.createInfoContainerUI=function(t){return(!0===(t=null==t?!0:t)?'<div class="card intro translated" defaultText="Intro Card YASB">\n</div>':"")+'\n<div class="card info-well">\n    <div class="info-name"></div>\n    <div class="info-type"></div>\n    <span class="info-collection"></span>\n    <div class="row">\n        <div class="col-sm-5">\n            <table class="table-sm">\n                <tbody>\n                    <tr class="info-attack-bullseye">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-bullseyearc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-frontarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-fullfront">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-fullfrontarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-left">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-leftarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-right">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-rightarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-back">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-reararc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-turret">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-singleturretarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-doubleturret">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-doubleturretarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-agility">\n                        <td class="info-header"><i class="xwing-miniatures-font header-agility xwing-miniatures-font-agility"></i></td>\n                        <td class="info-data info-agility"></td>\n                    </tr>\n                    <tr class="info-hull">\n                        <td class="info-header"><i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull"></i></td>\n                        <td class="info-data info-hull"></td>\n                    </tr>\n                    <tr class="info-shields">\n                        <td class="info-header"><i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield"></i></td>\n                        <td class="info-data info-shields"></td>\n                    </tr>\n                    <tr class="info-force">\n                        <td class="info-header"><i class="xwing-miniatures-font header-force xwing-miniatures-font-forcecharge"></i></td>\n                        <td class="info-data info-force"></td>\n                    </tr>\n                    <tr class="info-charge">\n                        <td class="info-header"><i class="xwing-miniatures-font header-charge xwing-miniatures-font-charge"></i></td>\n                        <td class="info-data info-charge"></td>\n                    </tr>\n                    <tr class="info-energy">\n                        <td class="info-header"><i class="xwing-miniatures-font header-energy xwing-miniatures-font-energy"></i></td>\n                        <td class="info-data info-energy"></td>\n                    </tr>\n                    <tr class="info-range">\n                        <td class="info-header translated" defaultText="Range"></td>\n                        <td class="info-data info-range"></td><td class="info-rangebonus"><i class="xwing-miniatures-font red header-range xwing-miniatures-font-rangebonusindicator"></i></td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n        <div class="col-sm-7">\n            <table class="table-sm">\n                <tbody>\n                    <tr class="info-skill">\n                        <td class="info-header translated" defaultText="Initiative"></td>\n                        <td class="info-data info-skill"></td>\n                    </tr>\n                    <tr class="info-engagement">\n                        <td class="info-header translated" defaultText="Engagement"></td>\n                        <td class="info-data info-engagement"></td>\n                    </tr>\n                    <tr class="info-faction">\n                        <td class="info-header translated" defaultText="Faction"></td>\n                        <td class="info-data"></td>\n                    </tr>\n                    <tr class="info-base">\n                        <td class="info-header translated" defaultText="Base"></td>\n                        <td class="info-data"></td> \n                    </tr>\n                    <tr class="info-points">\n                        <td class="info-header translated" defaultText="Points"></td>\n                        <td class="info-data info-points"></td>\n                    </tr>\n                    <tr class="info-loadout">\n                        <td class="info-header translated" defaultText="Loadout"></td>\n                        <td class="info-data info-loadout"></td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n    </div>\n    <table class="table-sm">\n        <tbody>\n            <tr class="info-ship">\n                <td class="info-header translated" defaultText="Ship"></td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-actions">\n                <td class="info-header translated" defaultText="Actions"></td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-upgrades">\n                <td class="info-header translated" defaultText="Upgrades"></td>\n                <td class="info-data"></td>\n            </tr>\n        </tbody>\n    </table>\n    <p class="info-restrictions"></p>\n    <p class="info-text"></p>\n    <p class="info-chassis"></p>\n    <p class="info-maneuvers"></p>\n    <br />\n    <span class="info-header info-sources translated" defaultText="Sources:"></span> \n    <span class="info-data info-sources"></span>\n</div>'},t.prototype.setupEventHandlers=function(){var o,l,c,u,h,p,i,f,m,n,a,_,b,g,s,v,x,k,e,r,y,C,d;return this.container.on("xwing:claimUnique",(m=this,function(t,e,i,n){return m.claimUnique(e,i,n)})).on("xwing:releaseUnique",(f=this,function(t,e,i,n){return f.releaseUnique(e,i,n)})).on("xwing:pointsUpdated",(i=this,function(t,e){return null==e&&(e=$.noop),i.isUpdatingPoints?e():(i.isUpdatingPoints=!0,i.onPointsUpdated(function(){return i.isUpdatingPoints=!1,e()}))})).on("xwing-backend:squadLoadRequested",(p=this,function(t,e,i){return null==i&&(i=$.noop),p.onSquadLoadRequested(e),i()})).on("xwing-backend:squadDirtinessChanged",(h=this,function(t){return h.onSquadDirtinessChanged()})).on("xwing-backend:squadNameChanged",(u=this,function(t){return u.onSquadNameChanged()})).on("xwing:beforeLanguageLoad",(c=this,function(t,e){return null==e&&(e=$.noop),c.pretranslation_serialized=c.serialize(),e()})).on("xwing:afterLanguageLoad",(l=this,function(t,e,i){var n,a,s;if(null==i&&(i=$.noop),l.language!==e){for(l.language=e,e=l.current_squad.dirty,null!=l.pretranslation_serialized.length&&l.loadFromSerialized(l.pretranslation_serialized),n=0,a=(s=l.ships).length;n<a;n++)s[n].updateSelections();l.current_squad.dirty=e,l.pretranslation_serialized=void 0}return i()})).on("xwing:shipUpdated",(o=this,function(t,e){var i,n,a,s,l;for(null==e&&(e=$.noop),i=!0,a=0,s=(l=o.ships).length;a<s;a++)(n=l[a]).updateSelections(),""===n.ship_selector.val()&&(i=!1);if(i&&!o.suppress_automatic_new_ship)return o.addShip()})),$(window).on("xwing-backend:authenticationChanged",(v=this,function(t){return v.resetCurrentSquad()})).on("xwing-collection:created",(s=this,function(t,e){return s.collection=e,s.checkCollection(),s.collection_button.removeClass("d-none")})).on("xwing-collection:changed",(g=this,function(t,e){return g.checkCollection()})).on("xwing-collection:destroyed",(b=this,function(t,e){return b.collection=null,b.collection_button.addClass("d-none")})).on("xwing:pingActiveBuilder",(_=this,function(t,e){if(_.container.is(":visible"))return e(_)})).on("xwing:activateBuilder",(a=this,function(t,e,i){if(e===a.faction)return a.tab.tab("show"),i(a)})).on("xwing:gameTypeChanged",(n=this,function(t,e,i){if(null==i&&(i=$.noop),n.onGameTypeChanged(e,i),n.game_type_selector.val()!==e)return n.game_type_selector.val(e).trigger("change")})),this.ship_container.on("sortstart",(k=this,function(t,e){return k.oldIndex=e.item.index()})).on("sortstop",(x=this,function(t,e){return x.updateShipOrder(x.oldIndex,e.item.index())})),this.obstacles_reset.click((e=this,function(t){if(e.current_obstacles!==[])return e.current_obstacles=[],e.obstacles_select.select2("data",null),e.current_squad.additional_data.obstacles=e.current_obstacles,e.current_squad.dirty=!0,e.container.trigger("xwing-backend:squadDirtinessChanged"),e.container.trigger("xwing:pointsUpdated")})),this.obstacles_select.change((r=this,function(t){return r.current_obstacles=r.obstacles_select.val().split(","),r.current_squad.additional_data.obstacles=r.current_obstacles,r.current_squad.dirty=!0,r.showObstaclesSelectInfo(),r.container.trigger("xwing-backend:squadDirtinessChanged"),r.container.trigger("xwing:pointsUpdated")})),this.view_list_button.click((y=this,function(t){return t.preventDefault(),y.showTextListModal()})),this.print_list_button.click((C=this,function(t){var c,u,h,e,i,p,f,n,a,s,l,m,_,b,g,v,x,k,o,r,d,y,w,q,O,S,j,T;if(t.preventDefault(),C.printable_container.find(".printable-header").html(C.list_modal.find(".modal-header").html()),C.printable_container.find(".printable-body").text(""),"simple"===C.list_display_mode)C.printable_container.find(".printable-body").html(C.simple_container.html());else{for(n=0,m=(y=C.ships).length;n<m;n++)null!=(e=y[n]).pilot&&C.printable_container.find(".printable-body").append(e.toHTML());if(C.list_modal.find(".toggle-horizontal-space").prop("checked")&&C.printable_container.find(".upgrade-container").addClass("wide"),C.printable_container.find(".printable-body").toggleClass("bw",!C.list_modal.find(".toggle-color-print").prop("checked")),C.list_modal.find(".toggle-skip-text-print").prop("checked"))for(a=0,_=(w=C.printable_container.find(".upgrade-text, .fancy-pilot-text")).length;a<_;a++)(i=w[a]).hidden=!0;for(C.list_modal.find(".toggle-maneuver-print").prop("checked")&&C.printable_container.find(".printable-body").append(C.getSquadDialsAsHTML()),c=C.list_modal.find(".toggle-expanded-shield-hull-print").prop("checked"),s=0,b=(q=C.printable_container.find(".expanded-hull-or-shield")).length;s<b;s++)q[s].hidden=!c;for(l=0,g=(O=C.printable_container.find(".simple-hull-or-shield")).length;l<g;l++)O[l].hidden=c;t=function(){switch(this.faction){case"Rebel Alliance":return"rebel";case"Galactic Empire":return"empire";case"Scum and Villainy":return"scum";case"Resistance":return"rebel-outline";case"First Order":return"firstorder";case"Galactic Republic":return"republic";case"Separatist Alliance":return"separatists";case"All":return"first-player-4"}}.call(C),C.list_modal.find(".toggle-color-print").prop("checked")&&C.printable_container.find(".fancy-header").addClass(t),C.list_modal.find(".toggle-color-print").prop("checked")&&C.printable_container.find(".fancy-pilot-header").addClass(t+"-pilot"),C.printable_container.find(".squad-faction").html('<i class="xwing-miniatures-font xwing-miniatures-font-'+t+'"></i>')}if(C.isStandard&&C.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i>'),C.isEpic&&C.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-energy"></i>'),C.printable_container.find(".fancy-under-header").append($.trim('<div class="version">Points Version: 02/23/2024</div>')),""!==$.trim(C.notes.val())&&(C.printable_container.find(".printable-body").append($.trim('<h5 class="print-notes translated" defaultText="Notes:"></h5>\n<pre class="print-notes"></pre>')),C.printable_container.find(".printable-body pre.print-notes").text(C.notes.val())),C.printable_container.find(".printable-body").append($.trim('<div class="print-conditions"></div>')),C.printable_container.find(".printable-body .print-conditions").html(C.condition_container.html()),C.list_modal.find(".toggle-obstacles").prop("checked")){for(u="",o=0,v=(h=C.getObstacles()).length;o<v;o++)u+='<img class="obstacle-silhouettes" src="images/'+h[o]+'.png" />';C.printable_container.find(".printable-body").append($.trim('<div class="obstacles">\n    <div>Chosen Obstacles:<br>'+u+"</div>\n</div>"))}for(null!=(t=C.getPermaLinkParams(["sn","obs"]))&&C.list_modal.find(".toggle-juggler-qrcode").prop("checked")&&(C.printable_container.find(".printable-body").append($.trim('<div class="qrcode-container">\n    <div class="permalink-container">\n        <div class="qrcode">YASB Link</div>\n        <div class="qrcode-text translated" defaultText="Scan QR-Code"></div>\n    </div>\n    <div class="xws-container">\n        <div class="qrcode">XWS Data</div>\n        <div class="qrcode-text translated" defaultText="XWS QR-Code"></div>\n    </div>\n</div>')),i=JSON.stringify(C.toXWS()),console.log(""+i),C.printable_container.find(".xws-container .qrcode").qrcode({render:"div",ec:"M",size:i.length<144?144:256,text:i}),i="https://yasb.app/"+t,C.printable_container.find(".permalink-container .qrcode").qrcode({render:"div",ec:"M",size:i.length<144?144:256,text:i})),p="while you perform",r=0,x=(S=C.ships).length;r<x;r++)for(null!=(null!=(j=(e=S[r]).pilot)?j.text:void 0)&&-1<e.pilot.text.match(p)&&e.pilot.name,d=0,k=(T=e.upgrades).length;d<k;d++)null!=(f=T[d]).text&&-1<f.text.match(p)&&f.name;return window.print()})),$(window).resize((d=this,function(){var t,e,i,n,a;for($(window).width()<768&&"simple"!==d.list_display_mode&&d.select_simple_view_button.click(),a=[],e=0,i=(n=d.ships).length;e<i;e++)t=n[e],a.push(t.checkPilotSelectorQueryModal());return a})),this.notes.change(this.onNotesUpdated),this.tag.change(this.onNotesUpdated),this.notes.on("keyup",this.onNotesUpdated),this.tag.on("keyup",this.onNotesUpdated)},t.prototype.getPermaLinkParams=function(t){var e,i,n={};return __indexOf.call(t=null==t?[]:t,"f")<0&&(n.f=encodeURI(this.faction)),__indexOf.call(t,"d")<0&&(n.d=encodeURI(this.serialize())),__indexOf.call(t,"sn")<0&&(n.sn=encodeURIComponent(this.current_squad.name)),__indexOf.call(t,"obs")<0&&(n.obs=encodeURI(this.current_squad.additional_data.obstacles||"")),"?"+function(){var t=[];for(e in n)i=n[e],t.push(e+"="+i);return t}().join("&")},t.prototype.getPermaLink=function(t){return null==t&&(t=this.getPermaLinkParams()),""+URL_BASE+t},t.prototype.updateShipOrder=function(t,e){var i=this.ships[t];if(this.ships.splice(t,1),this.ships.splice(e,0,i),this.updatePermaLink,t!==e)return this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.updatePermaLink=function(){var t;if(this.container.is(":visible"))return t=this.getPermaLinkParams(),window.location.search!==t?window.history.replaceState(t,"",this.getPermaLink(t)):void 0},t.prototype.onNotesUpdated=function(){if(0<this.total_points)return this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.onGameTypeChanged=function(t,e){var i,n;switch(null==e&&(e=$.noop),this.isStandard,this.isEpic,i=this.isQuickbuild,this.isStandard=!1,this.isEpic=!1,this.isQuickbuild=!1,this.epic_not_legal_container.toggleClass("d-none",!0),t){case"extended":this.desired_points_input.val(20);break;case"epic":this.isEpic=!0,this.desired_points_input.val(20),this.epic_not_legal_container.toggleClass("d-none",!1);break;case"quickbuild":this.isQuickbuild=!0,this.desired_points_input.val(8);break;default:this.isStandard=!0,this.desired_points_input.val(20)}return i!==this.isQuickbuild?(n=this.current_squad.id,this.newSquadFromScratch($.trim(this.current_squad.name)),this.current_squad.id=n):(n=this.current_squad.id,this.container.trigger("xwing:pointsUpdated",$.noop),this.container.trigger("xwing:shipUpdated")),e()},t.prototype.addStandardizedToList=function(t){return t.addStandardizedUpgrades()},t.prototype.onPointsUpdated=function(t){var e,i,n,a,s,l,c,o,u,r,d,h,p,f,m;for(null==t&&(t=$.noop),a=o=0,u=!1,n=r=p=this.ships.length-1;p<=-1?r<-1:-1<r;n=p<=-1?++r:--r)(l=this.ships[n]).validate(),l&&(this.addStandardizedToList(l),o+=l.getPoints(),1===l.destroystate?a+=Math.floor(l.getPoints()/2):2===l.destroystate&&(a+=l.getPoints()),(c=l.checkUnreleasedContent())&&(u=c));if(this.total_points=o,this.points_destroyed=a,this.total_points_span.text(this.total_points),s=parseInt(this.desired_points_input.val())-this.total_points,parseInt(this.total_points),this.points_remaining_span.text(s),this.points_destroyed_span.html(0!==a?'<i class="xwing-miniatures-font xwing-miniatures-font-hit"></i>'+a:""),this.points_remaining_container.toggleClass("red",s<0),this.unreleased_content_used_container.toggleClass("d-none",!u),this.fancy_total_points_container.text(this.total_points),this.updatePrintAndExportTexts(),this.checkCollection(),"undefined"!=typeof Set&&null!==Set){for(i=new Set,d=0,h=(f=this.ships).length;d<h;d++)(l=f[d]).getConditions().forEach(function(t){return i.add(t)});e=[],i.forEach(function(t){return e.push(t)}),e.sort(function(t,e){return t.name.canonicalize()<e.name.canonicalize()?-1:e.name.canonicalize()>t.name.canonicalize()?1:0}),this.condition_container.text(""),e.forEach((m=this,function(t){return m.condition_container.append(conditionToHTML(t))}))}return t(this.total_points)},t.prototype.onSquadLoadRequested=function(t){var e;return this.current_squad=t,this.backend_delete_list_button.removeClass("disabled"),this.updateObstacleSelect(this.current_squad.additional_data.obstacles),null!=t.serialized.length&&this.loadFromSerialized(t.serialized),this.notes.val(null!=(e=t.additional_data.notes)?e:""),this.tag.val(null!=(e=t.additional_data.tag)?e:""),this.backend_status.fadeOut("slow"),this.current_squad.dirty=!1,this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.onSquadDirtinessChanged=function(){return this.backend_save_list_button.toggleClass("disabled",!(this.current_squad.dirty&&0<this.total_points)),this.backend_save_list_as_button.toggleClass("disabled",0===this.total_points),this.backend_delete_list_button.toggleClass("disabled",null==this.current_squad.id),1<this.ships.length?$('meta[property="og:description"]').attr("content",this.uitranslation("X-Wing Squadron by YASB: ")+this.current_squad.name+": "+this.describeSquad()):$('meta[property="og:description"]').attr("content",this.uitranslation("YASB advertisment"))},t.prototype.onSquadNameChanged=function(){var t=this.current_squad.name.length>SQUAD_DISPLAY_NAME_MAX_LENGTH?this.current_squad.name.substr(0,SQUAD_DISPLAY_NAME_MAX_LENGTH)+"&hellip;":this.current_squad.name;if(this.squad_name_placeholder.text(""),this.squad_name_placeholder.append(t),this.squad_name_input.val(this.current_squad.name),$.getParameterByName("f")===this.faction)return this.current_squad.name!==this.uitranslation("Unnamed Squadron")&&this.current_squad.name!==this.uitranslation("Unsaved Squadron")?document.title!=="YASB - "+this.current_squad.name&&(document.title="YASB - "+this.current_squad.name):document.title="YASB",this.updatePrintAndExportTexts()},t.prototype.updatePrintAndExportTexts=function(){var t,e,i,n,a,s,l,o,r,d,c,u;for(this.fancy_container.text(""),this.simple_container.html('<table class="simple-table"></table>'),a=[],i=[],l=[],o=0,d=(u=this.ships).length;o<d;o++)null!=(n=u[o]).pilot&&(this.fancy_container.append(n.toHTML()),this.simple_container.find("table").append(n.toTableRow()),a.push(n.toSimpleCopy()),i.push(n.toRedditText()),l.push(n.toTTSText()));if(this.reddit_container.find("textarea").val($.trim(i.join("    \n")+"    \n**"+this.uitranslation("Total")+":** *"+this.total_points+"*    \n    \n["+this.uitranslation("View in YASB")+"]("+this.getPermaLink()+")")),this.simplecopy_container.find("textarea").val($.trim(a.join("")+"    \n"+this.uitranslation("Total")+": "+this.total_points+"    \n    \n"+this.uitranslation("View in YASB")+": "+this.getPermaLink())),null!=(e=this.getObstacles())&&0<e.length&&0<l.length){for(l[l.length-1]=l[l.length-1].slice(0,-2),s=" |",r=0,c=e.length;r<c;r++)null!=(t=e[r])&&(s+=" "+t+" /");s=s.slice(0,-1),l.push(s)}return this.tts_textarea.val($.trim(""+l.join(""))),this.xws_textarea.val($.trim(JSON.stringify(this.toXWS()))),$("#xws-qrcode-container").text(""),$("#xws-qrcode-container").qrcode({render:"canvas",text:JSON.stringify(this.toMinimalXWS()),ec:"L",size:128})},t.prototype.removeAllShips=function(){for(;0<this.ships.length;)this.removeShip(this.ships[0]);if(0<this.ships.length)throw new Error(this.uitranslation("Ships not emptied"))},t.prototype.showTextListModal=function(){return this.list_modal.modal("show")},t.prototype.showXWSModal=function(t){return this.select_xws_view(),this.showTextListModal()},t.prototype.showChooseObstaclesModal=function(){return this.obstacles_select.select2("val",this.current_squad.additional_data.obstacles),this.choose_obstacles_modal.modal("show")},t.prototype.showObstaclesSelectInfo=function(){var t,e,i,n,a,s=this.obstacles_select.val().split(",");if(s===[])return this.obstacles_select_sources.html("");for(t="",e=0,i=s.length;e<i;e++)t+="<u>"+(n=s[e])+"</u>: "+(1<(n=null!=(n=null!=(n=exportObj.obstacles[n])?n.sources:void 0)?n:[]).length||(a=exportObj.translate("sources","Loose Ships"),!(0<=__indexOf.call(n,a)))?0<n.length?n.join(", "):exportObj.translate("ui","unreleased"):this.uitranslation("Only available from 1st edition"))+"</br>";return this.obstacles_select_sources.html($.trim(t))},t.prototype.updateObstacleSelect=function(t){return this.current_obstacles=null!=t?t:[],this.obstacles_select.select2("val",t),this.showObstaclesSelectInfo()},t.prototype.serialize=function(){var a;return"v9Z"+function(){switch(this.game_type_selector.val()){case"standard":return"h";case"extended":return"s";case"epic":return"e";case"quickbuild":return"q"}}.call(this)+"Z"+$.trim(this.desired_points_input.val())+"Z"+function(){for(var t=this.ships,e=[],i=0,n=t.length;i<n;i++)null==(a=t[i]).pilot||this.isQuickbuild&&!a.primary||e.push(a.toSerialized());return e}.call(this).join("Y")},t.prototype.changeGameTypeOnSquadLoad=function(t){if(this.game_type_selector.val()!==t)return $(window).trigger("xwing:gameTypeChanged",t)},t.prototype.loadFromSerialized=function(t){var e,i,c,u,n,a,h,s,l,o,r,p,f,d,m;if(this.suppress_automatic_new_ship=!0,this.removeAllShips(),null!=(t=(0<=__indexOf.call(t,"Z")?/^v(\d+)Z(.*)/:/^v(\d+)!(.*)/).exec(t))){if(h=7<(l=parseInt(t[1]))?"Y":";",i=(t=7<l?(e=(d=t[2].split("Z"))[0],n=d[1],d=d[2],[e,parseInt(n),d]):(i=(t=t[2].split("!"))[0],d=t[1],n=parseInt(i.split("=")[1])?parseInt(i.split("=")[1]):20,[e=i.split("=")[0],n,d]))[0],e=t[1],n=t[2],l<9)return this.old_version_container.toggleClass("d-none",!1),this.suppress_automatic_new_ship=!1,void this.addShip();if(null==n)return this.loading_failed_container.toggleClass("d-none",!1),this.suppress_automatic_new_ship=!1,void this.addShip();switch(i){case"s":this.changeGameTypeOnSquadLoad("extended");break;case"h":this.changeGameTypeOnSquadLoad("standard");break;case"e":this.changeGameTypeOnSquadLoad("epic");break;case"q":this.changeGameTypeOnSquadLoad("quickbuild")}if(this.desired_points_input.val(e),this.desired_points_input.change(),s=[],null!=n.length){for(o=0,p=(m=n.split(h)).length;o<p;o++)""!==(u=m[o])&&((c=this.addShip()).fromSerialized(l,u)&&c.pilot||s.push([c,u]));for(r=0,f=s.length;r<f;r++)(a=s[r])[0].pilot||(a[0]=this.addShip()),a[0].fromSerialized(l,a[1])}}return this.suppress_automatic_new_ship=!1,this.addShip()},t.prototype.select_xws_view=function(){if(this.select_xws_view_button.blur(),"xws"!==this.list_display_mode)return this.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),this.select_xws_view_button.addClass("btn-inverse"),this.list_display_mode="xws",this.xws_container.show(),this.simple_container.hide(),this.simplecopy_container.hide(),this.reddit_container.hide(),this.fancy_container.hide(),this.tts_container.hide(),this.xws_textarea.select(),this.xws_textarea.focus(),this.toggle_vertical_space_container.hide(),this.toggle_color_print_container.hide(),this.toggle_color_skip_text.hide(),this.toggle_maneuver_dial_container.hide(),this.toggle_expanded_shield_hull_container.hide(),this.toggle_qrcode_container.hide(),this.toggle_obstacle_container.hide(),this.btn_print_list.disabled=!0},t.prototype.uniqueIndex=function(t,e){if(!(e in this.uniques_in_use))throw new Error("Invalid unique type '"+e+"'");return this.uniques_in_use[e].indexOf(t)},t.prototype.claimUnique=function(t,e,i){var n,a,s,l,o,r,d;if(!(this.uniqueIndex(t,e)<0))throw new Error("Unique "+e+" '"+t.name+"' already claimed");for(a=0,l=(r=exportObj.pilotsByUniqueName[t.canonical_name.getXWSBaseName()]||[]).length;a<l;a++)if(t!==(n=r[a])){if(!(this.uniqueIndex(n,"Pilot")<0))throw new Error("Unique "+e+" '"+t.name+"' already claimed as pilot");this.uniques_in_use.Pilot.push(n)}for(s=0,o=(d=exportObj.upgradesByUniqueName[t.canonical_name.getXWSBaseName()]||[]).length;s<o;s++){if(n=d[s],!(this.uniqueIndex(n,"Upgrade")<0))throw new Error("Unique "+e+" '"+n.name+"' already claimed as pilot");this.uniques_in_use.Upgrade.push(n)}return null!=t.solitary&&this.uniques_in_use.Slot.push(t.slot),this.uniques_in_use[e].push(t),i()},t.prototype.releaseUnique=function(t,e,i){var n,a,s,l,o,r,d;if(!(0<=this.uniqueIndex(t,e)))throw new Error("Unique "+e+" '"+t.name+"' not in use");for(e in d=this.uniques_in_use)if(a=d[e],"Slot"===e){if(null!=t.solitary)for(this.uniques_in_use[e]=[],s=0,o=a.length;s<o;s++)(n=a[s])!==t.slot&&this.uniques_in_use[e].push(n.slot)}else for(this.uniques_in_use[e]=[],l=0,r=a.length;l<r;l++)(n=a[l]).canonical_name.getXWSBaseName()!==t.canonical_name.getXWSBaseName()&&this.uniques_in_use[e].push(n);return i()},t.prototype.addShip=function(){var t=new Ship({builder:this,container:this.ship_container});return this.ships.push(t),this.ship_number_invalid_container.toggleClass("d-none",this.ships.length<10&&3<this.ships.length),this.multi_faction_warning_container.toggleClass("d-none","All"!==this.faction),t},t.prototype.removeShip=function(t,e){__iced_k_noop;var i,n,a=iced.findDeferral(arguments),s=(null==e&&(e=$.noop),n=this,function(){return e()});null!=(null!=t?t.destroy:void 0)?(i=new iced.Deferrals(function(){var t=function(){n.current_squad.dirty=true;n.container.trigger("xwing-backend:squadDirtinessChanged");n.ship_number_invalid_container.toggleClass("d-none",n.ships.length<10&&n.ships.length>3);return s(n.multi_faction_warning_container.toggleClass("d-none",n.faction!=="All"))};i=new iced.Deferrals(t,{parent:a,funcname:"SquadBuilder.removeShip"}),n.container.trigger("xwing:pointsUpdated",i.defer({lineno:4299})),i._fulfill()},{parent:a,funcname:"SquadBuilder.removeShip"}),t.destroy(i.defer({lineno:4298})),i._fulfill()):s()},t.prototype.matcher=function(t,e){return 0<=t.toUpperCase().indexOf(e.toUpperCase())},t.prototype.isOurFaction=function(t,e){var i,n,a,s;if(null==e&&(e=""),i=this.faction,"All"===this.faction){if(""===e)return!0;i=e}if(t instanceof Array){for(a=0,s=t.length;a<s;a++)if(n=t[a],getPrimaryFaction(n)===i)return!0;return!1}return getPrimaryFaction(t)===i},t.prototype.isItemAvailable=function(t,e){var i;return null==e&&(e=!1),!!this.isQuickbuild||(this.isStandard?exportObj.standardCheck(t,this.faction,e):this.isEpic?!(null!=(null!=(i=exportObj.settings)?i.ban_list:void 0)&&exportObj.settings.ban_list&&!exportObj.standardCheck(t,this.faction,e,!0)):!(null!=(null!=(i=exportObj.settings)?i.ban_list:void 0)&&exportObj.settings.ban_list&&!exportObj.standardCheck(t,this.faction,e,!0))&&exportObj.epicExclusions(t))},t.prototype.getAvailableShipsMatching=function(t,e,i){var n,a,s,l;for(a in null==t&&(t=""),null==e&&(e=!0),null==i&&(i=!1),s=[],l=exportObj.ships)n=l[a],this.isOurFaction(n.factions)&&(this.matcher(n.name,t)||n.display_name&&this.matcher(n.display_name,t))&&this.isItemAvailable(n,!0)&&(!i||null!=this.collection&&"true"===this.collection.checks.collectioncheck&&this.collection.checkShelf("ship",n.name))&&s.push({id:n.name,text:n.display_name||n.name,chassis:n.chassis,name:n.name,display_name:n.display_name,canonical_name:n.canonical_name,xws:n.name.canonicalize(),icon:n.icon||n.name.canonicalize()});return e&&s.sort(exportObj.sortHelper),s},t.prototype.getAvailableShipsMatchingAndCheapEnough=function(t,e,i,n){for(var a,s,l,o=[],r=0,d=(s=this.getAvailableShipsMatching(e=null==e?"":e,i=null==i?!1:i,n=null==n?!1:n)).length;r<d;r++)l=s[r],(a=this.getAvailablePilotsForShipIncluding(l.name,null,"",!0)).length&&a[0].points<=t&&o.push(l);return o},t.prototype.getAvailablePilotsForShipIncluding=function(s,e,i,u,l){var o,h,p,f,m,t,_,a,b,r,g,n,d,v,c,x,k,y,w,q,O,S,$,j,T;if(null==i&&(i=""),null==u&&(u=!0),null==l&&(l=null),n=[],this.isQuickbuild){if(g=function(){var t=exportObj.quickbuildsById,e=[];for(f in t)r=t[f],(null==s||r.ship===s)&&this.isOurFaction(r.faction)&&(this.matcher(r.pilot,i)||null!=exportObj.pilots[r.pilot].display_name&&this.matcher(exportObj.pilots[r.pilot].display_name,i))&&e.push(r);return e}.call(this),d=[],null!=e&&-1!==e){if(m=exportObj.quickbuildsById[e],null!=($=exportObj.pilots[m.pilot]).unique)for(d.push($),x=0,w=(S=exportObj.pilotsByUniqueName[$.canonical_name.getXWSBaseName()]||[]).length;x<w;x++)null!=(_=S[x])&&d.push(_);for(k=0,q=(j=null!=($=m.upgrades)?$:[]).length;k<q;k++){if(t=j[k],null!=(t=exportObj.upgrades[t]).unique)for(d.push(_),y=0,O=(T=exportObj.pilotsByUniqueName[t.canonical_name.getXWSBaseName()]||[]).length;y<O;y++)null!=(_=T[y])&&d.push(_);null!=t.solitary&&d.push(t.slot)}}o=[],function(){var t,e=[];for(f in g)r=g[f],!(null!=(null!=(t=exportObj.pilots[r.pilot])?t.unique:void 0)&&(t=exportObj.pilots[r.pilot],0<=__indexOf.call(this.uniques_in_use.Pilot,t))&&(t=exportObj.pilots[r.pilot],!(0<=__indexOf.call(d,t)))||null!=(null!=(t=exportObj.pilots[r.pilot])?t.max_per_squad:void 0)&&this.countPilots(exportObj.pilots[r.pilot].canonical_name)>=exportObj.pilots[r.pilot].max_per_squad&&(t=exportObj.pilots[r.pilot],!(0<=__indexOf.call(d,t))))?null!=r.upgrades?e.push(function(){for(var t,e,i=r.upgrades,n=[],a=0,s=i.length;a<s;a++)if(v=i[a],null!=(c=exportObj.upgrades[v])){if(null!=c.unique&&0<=__indexOf.call(this.uniques_in_use.Upgrade,c)&&!(0<=__indexOf.call(d,c))&&(null===l||!(0<=__indexOf.call(exportObj.quickbuildsById[l.quickbuildId].upgrades,v)||l.linkedShip&&0<=__indexOf.call(null!=(t=exportObj.quickbuildsById[null!=(t=l.linkedShip)?t.quickbuildId:void 0].upgrades)?t:[],v)))){o.push(r.id);break}if(null!=c.solitary&&(t=c.slot,0<=__indexOf.call(this.uniques_in_use.Slot,t))&&(e=c.slot,!(0<=__indexOf.call(d,e)))){o.push(r.id);break}n.push(void 0)}else console.log("There was an Issue including the upgrade "+v+" in some quickbuild. Please report that Issue!");return n}.call(this)):e.push(void 0):o.push(r.id);return e}.call(this),n=function(){for(var t,e=[],i=0,n=g.length;i<n;i++)r=g[i],e.push({id:r.id,text:(null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?exportObj.pilots[r.pilot].skill+" - ":"")+(exportObj.pilots[r.pilot].display_name||r.pilot)+r.suffix+" ("+r.threat+")",points:r.threat,ship:r.ship,disabled:(t=r.id,0<=__indexOf.call(o,t))});return e}()}else h=function(){var t=exportObj.pilots,e=[];for(b in t)a=t[b],(null==s||a.ship===s)&&this.isOurFaction(a.faction)&&(this.matcher(b,i)||a.display_name&&this.matcher(a.display_name,i))&&this.isItemAvailable(a,!0)&&e.push(a);return e}.call(this),p=function(){var t=[];for(b in h)(null==(a=h[b]).unique||__indexOf.call(this.uniques_in_use.Pilot,a)<0||a.canonical_name.getXWSBaseName()===(null!=e?e.canonical_name.getXWSBaseName():void 0))&&(null==a.max_per_squad||this.countPilots(a.canonical_name)<a.max_per_squad||a.canonical_name.getXWSBaseName()===(null!=e?e.canonical_name.getXWSBaseName():void 0))&&(null==a.upgrades||this.standard_restriction_check(a,e))&&(null==a.restriction_func||a.restriction_func({builder:this},a))&&t.push(a);return t}.call(this),null!=e&&null!=e.unique&&(this.matcher(e.name,i)||e.display_name&&this.matcher(e.display_name,i))&&p.push(e),n=function(){for(var t,e=[],i=0,n=h.length;i<n;i++)a=h[i],e.push({id:a.id,text:(null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?a.skill+" - ":"")+(a.display_name||a.name)+" ("+a.points+(null!=a.loadout?"/"+a.loadout:"")+")",points:a.points,ship:a.ship,name:a.name,display_name:a.display_name,disabled:__indexOf.call(p,a)<0});return e}();return n=u?n.sort(exportObj.sortHelper):n},t.prototype.standard_restriction_check=function(t,e){var i,n,a,s,l,o,r,d,c,u,h,p,f,m,_;if(null!=t.upgrades)for(l=0,d=(h=t.upgrades).length;l<d;l++)if(a=h[l],!0===(s=exportObj.upgrades[a]).unique)for(o=0,c=(p=this.ships).length;o<c;o++)if(null==(null!=(f=(i=p[o]).pilot)?f.name:void 0)||null==(null!=e?e.name:void 0)||i.pilot.name!==e.name)for(r=0,u=(m=i.upgrades).length;r<u;r++)if((null!=(n=m[r])&&null!=(_=n.data)?_.canonical_name:void 0)===s.canonical_name)return!1;return!0},t.prototype.countUpgrades=function(c){for(var t,e,i,n,a,s,l,o=0,r=this.ships,d=0,u=r.length;d<u;d++)if(null==(null!=(a=(t=r[d]).pilot)?a.upgrades:void 0))for(i=0,n=(s=t.upgrades).length;i<n;i++)(null!=(e=s[i])&&null!=(l=e.data)?l.canonical_name:void 0)===c&&o++;return o},t.prototype.countPilots=function(t){for(var e,i,n=0,a=this.ships,s=0,l=a.length;s<l;s++)(null!=(e=a[s])&&null!=(i=e.pilot)?i.canonical_name.getXWSBaseName():void 0)===t.getXWSBaseName()&&n++;return n},t.prototype.isShip=function(t,e){var i,n;if(t instanceof Array){for(i=0,n=t.length;i<n;i++)if(t[i]===e)return!0;return!1}return t===e},t.prototype.getAvailableUpgradesIncluding=function(u,i,a,n,s,l,e){var o,r,h,p,t,d,c,f,m,_,b,g,v,x;for(null==s&&(s=""),null==l&&(l=this.dfl_filter_func),null==e&&(e=!0),f=function(){for(var t=a.upgrades,e=[],i=0,n=t.length;i<n;i++)d=t[i],e.push(d.data);return e}(),o=function(){var t=exportObj.upgrades,e=[];for(c in t)d=t[c],exportObj.slotsMatching(d.slot,u)&&(this.matcher(c,s)||d.display_name&&this.matcher(d.display_name,s))&&(null==d.ship||this.isShip(d.ship,a.data.name))&&(null==d.faction||this.isOurFaction(d.faction,a.pilot.faction))&&this.isItemAvailable(d)&&null==d.standard&&e.push(d);return e}.call(this),l!==this.dfl_filter_func&&(o=function(){for(var t=[],e=0,i=o.length;e<i;e++)d=o[e],l(d)&&t.push(d);return t}()),p=a.upgrade_points_total-n.getPoints(i),r=function(){var t,e=[];for(c in o)d=o[c],__indexOf.call(this.uniques_in_use.Upgrade,d)<0&&a.standardized_check(d)&&a.restriction_check(d.restrictions||void 0,n,n.getPoints(d),p,d)&&__indexOf.call(f,d)<0&&(null==d.max_per_squad||a.builder.countUpgrades(d.canonical_name)<d.max_per_squad)&&(null==d.solitary||(t=d.slot,__indexOf.call(this.uniques_in_use.Slot,t)<0||null!=(null!=i?i.solitary:void 0)))&&e.push(d);return e}.call(this),m=0,b=(v=function(){for(var t=a.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(null!=(d=t[i])?d.data:void 0)&&e.push(d.data);return e}()).length;m<b;m++)h=v[m],r.removeItem(h);if(null!=i&&(this.matcher(i.name,s)||i.display_name&&this.matcher(i.display_name,s))&&r.push(i),t=function(){for(var t=[],e=0,i=o.length;e<i;e++)d=o[e],t.push({id:d.id,text:(d.display_name||d.name)+" ("+n.getPoints(d)+(d.variablepoints?"*":"")+")",points:n.getPoints(d),name:d.name,display_name:d.display_name,disabled:__indexOf.call(r,d)<0});return t}(),e&&(t=t.sort(exportObj.sortHelper)),"function"==typeof n&&n("undefined"!=typeof adjustment_func&&null!==adjustment_func)){for(x=[],_=0,g=t.length;_<g;_++)d=t[_],x.push(n.adjustment_func(d));return x}return t},t.prototype.getSquadDialsAsHTML=function(){for(var t,e,i,n,a="",s={},l=this.ships,o=0,r=l.length;o<r;o++)null!=(i=l[o]).pilot&&(e=i.data.maneuvers,t=i.effectiveStats().maneuvers,null!=s[i.data.name]&&(n=t.toString(),0<=__indexOf.call(s[i.data.name],n))||(s[i.data.name]=(null!=(n=s[i.data.name])?n:[]).concat([t.toString()]),a+='<div class="fancy-dial"><h4 class="ship-name-dial">'+(null!=i.data.display_name?i.data.display_name:i.data.name)+(t.toString()!==e.toString()?" ("+this.uitranslation("modified")+")":"")+"</h4>"+this.getManeuverTableHTML(t,e)+"</div>"));return'<div class="print-dials-container">\n    '+a+"\n</div>"},t.prototype.getManeuverTableHTML=function(i,c){var u,h,p,t,f,m,e,n,_,a,s,b,l,o,r,d,g,v,x,k,y,w,q,O,S,j,T,C;if(null==i||0===i.length)return this.uitranslation("Missing maneuver info.");for(p=function(){C=[];for(var t=0,e=i[0].length;0<=e?t<e:e<t;0<=e?t++:t--)C.push(t);return C}.apply(this),g=0,k=i.length;g<k;g++)for(u=v=0,y=(h=i[g]).length;v<y;u=++v)0<h[u]&&p.removeItem(u);for(s="<table><tbody>",l=x=S=i.length-1;S<=0?x<=0:0<=x;l=S<=0?++x:--x){for(m=!1,q=0,w=(j=i[l]).length;q<w;q++)if(0<j[q]){m=!0;break}if(m){for(s+="<tr><td>"+l+"</td>",d=O=0,T=i[l].length;0<=T?O<T:T<O;d=0<=T?++O:--O)if(!(0<=__indexOf.call(p,d))){if(s+="<td>",0<i[l][d]){if(f=function(){switch(i[l][d]){case 1:return"dodgerblue";case 2:return"white";case 3:return"red";case 4:return"purple"}}(),_=function(){switch(i[l][d]){case 1:return"svg-blue-maneuver";case 2:return"svg-white-maneuver";case 3:return"svg-red-maneuver";case 4:return"svg-purple-maneuver"}}(),s+='<svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 200 200">',b="black",a="svg-base-maneuver",i[l][d]!==c[l][d]&&(b="DarkSlateGrey",a="svg-modified-maneuver"),0===l&&2===d)s+='<rect class="svg-maneuver-stop '+_+" "+a+'" x="50" y="50" width="100" height="100" style="fill:'+f+"; stroke-width:5; stroke:"+b+'" />';else{switch(t=o="",d){case 0:n="M160,180 L160,70 80,70",e="M160,175 L160,70 70,70",r="M80,100 V40 L30,70 Z";break;case 1:n="M150,180 S150,120 80,60",e="M150,175 S150,120 80,60",r="M80,100 V40 L30,70 Z",o="transform='translate(-5 -15) rotate(45 70 90)' ";break;case 2:n="M100,180 L100,100 100,80",e="M100,175 L100,120 100,70",r="M70,80 H130 L100,30 Z";break;case 3:n="M50,180 S50,120 120,60",e="M50,175 S50,120 120,60",r="M120,100 V40 L170,70 Z",o="transform='translate(5 -15) rotate(-45 130 90)' ";break;case 4:n="M40,180 L40,70 120,70",e="M40,175 L40,70 130,70",r="M120,100 V40 L170,70 Z";break;case 5:n="M50,180 L50,100 C50,10 140,10 140,100 L140,120",e="M50,175 L50,100 C50,10 140,10 140,100 L140,130",r="M170,120 H110 L140,180 Z";break;case 6:n="M150,180 S150,120 80,60",e="M150,175 S150,120 85,65",r="M80,100 V40 L30,70 Z",o="transform='translate(0 50)'";break;case 7:n="M50,180 S50,120 120,60",e="M50,175 S50,120 115,65",r="M120,100 V40 L170,70 Z",o="transform='translate(0 50)'";break;case 8:n="M160,180 L160,70 80,70",e="M160,175 L160,70 85,70",r="M60,100 H100 L80,140 Z";break;case 9:n="M40,180 L40,70 120,70",e="M40,175 L40,70 115,70",r="M100,100 H140 L120,140 Z";break;case 10:n="M50,180 S50,120 120,60",e="M50,175 S50,120 120,60",r="M120,100 V40 L170,70 Z",o="transform='translate(5 -15) rotate(-45 130 90)' ",t="backwards";break;case 11:n="M100,180 L100,100 100,80",e="M100,175 L100,100 100,70",r="M70,80 H130 L100,30 Z",t="backwards";break;case 12:n="M150,180 S150,120 80,60",e="M150,175 S150,120 80,60",r="M80,100 V40 L30,70 Z",o="transform='translate(-5 -15) rotate(45 70 90)' ",t="backwards"}s+=$.trim('<g class="maneuver '+t+"\">\n  <path class = 'svg-maneuver-outer "+_+" "+a+"' stroke-width='25' fill='none' stroke='"+b+"' d='"+n+"' />\n  <path class = 'svg-maneuver-triangle "+_+" "+a+"' d='"+r+"' fill='"+f+"' stroke-width='5' stroke='"+b+"' "+o+"/>\n  <path class = 'svg-maneuver-inner "+_+" "+a+"' stroke-width='15' fill='none' stroke='"+f+"' d='"+e+"' />\n</g>")}s+="</svg>"}s+="</td>"}s+="</tr>"}}return s+="</tbody></table>"},t.prototype.formatActions=function(t,e,i){var n,a,s,l,o,r;for(null==i&&(i=[]),a=[],o=0,r=t.length;o<r;o++)n=t[o],s="",l=e,-1!==(n=0<=__indexOf.call(i,"Droid")?n.replace("Focus","Calculate"):n).search("> ")&&(n=n.replace(/> /gi,""),l=' <i class="xwing-miniatures-font xwing-miniatures-font-linked"></i> '),-1!==n.search("F-")&&(s="force ",n=n.replace(/F-/gi,"")),-1!==n.search("W-")?(l="White ",n=n.replace(/W-/gi,"")):-1!==n.search("R-")&&(s="red ",n=n.replace(/R-/gi,"")),n=n.toLowerCase().replace(/[^0-9a-z]/gi,""),a.push(l+'<i class="xwing-miniatures-font '+s+"xwing-miniatures-font-"+n+'"></i>');return a.join("").replace(e,"")},t.prototype.listStandardUpgrades=function(t){for(var e="",i=0,n=t.length;i<n;i++)e+=", "+t[i].split(" (")[0];return e.substr(2)},t.prototype.getPilotsMatchingUpgrade=function(t,e){var i,n,a,s,l,o,r,d;for(n in null==t&&(t=""),null==e&&(e=!0),a=[],r=exportObj.pilots)if(null!=(i=r[n]).upgrades)for(l=0,o=(d=i.upgrades).length;l<o;l++)s=d[l],this.matcher(s,t)&&a.push({id:i.name,name:i.name,display_name:i.display_name,chassis:i.chassis,canonical_name:i.canonical_name,xws:i.name.canonicalize(),icon:i.icon||i.name.canonicalize()});return e&&a.sort(exportObj.sortHelper),a},t.prototype.showTooltip=function(c,s,u,t,h){var p,f,e,m,_,b,g,v,x,k,y,w,n,q,O,S,j,i,a,T,C,I,L,A,U,P,E,D,M,B,z,N,R,F,W,G,H,l,X,o,r,d,Q,V,Y,Z;if(null==t&&(t=this.info_container),null==h&&(h=!1),s!==this.tooltip_currently_displaying||h){switch(c){case"Ship":for(T in S=[],O=[],j=[],C={},exportObj.upgradesBySlotCanonicalName)C[T]=-1;for(w in F=exportObj.pilots)if((n=F[w]).ship===s.name&&this.isOurFaction(n.faction)&&(W=n.skill,0<=__indexOf.call(S,W)||S.push(n.skill),O.push(n.points),null!=n.loadout&&j.push(n.loadout),null!=n.slots))for(T in C)switch(L=C[T],n.slots.filter(function(t){return t===T}).length){case 1:switch(L){case-1:C[T]=1;break;case 0:C[T]=2;break;case 3:C[T]=4}break;case 0:switch(L){case-1:C[T]=0;break;case 1:C[T]=2;break;case 3:case 4:C[T]=5}break;case 2:switch(L){case-1:C[T]=3;break;case 0:case 2:C[T]=5;break;case 1:C[T]=4}break;case 3:C[T]=6}for(S.sort(),t.find(".info-type").text(exportObj.translate("types",c)),t.find(".info-name").html(""+(s.display_name||s.name)+(exportObj.isReleased(s)?"":" ("+this.uitranslation("unreleased")+")")),null!=(null!=(l=this.collection)?l.counts:void 0)?(d=null!=(l=null!=(l=this.collection.counts)&&null!=(d=l.ship)?d[s.name]:void 0)?l:0,t.find(".info-collection").text(this.uitranslation("collectionContentShips",d)),t.find(".info-collection").show()):t.find(".info-collection").hide(),_=!0,v=String(S[0]),P=0,D=S.length;P<D;P++)g=S[P],_||(v+=", "+g),_=!1;for(t.find("tr.info-skill td.info-data").text(v),t.find("tr.info-skill").toggle(void 0!==g),l=Math.min.apply(Math,O)+" - "+Math.max.apply(Math,O),t.find("tr.info-points td.info-data").text(l),l=Math.min.apply(Math,j)+" - "+Math.max.apply(Math,j),t.find("tr.info-loadout td.info-data").text(l),t.find("tr.info-points").toggle(0<O.length),t.find("tr.info-loadout").toggle(0<j.length),t.find("tr.info-engagement").hide(),t.find("tr.info-attack td.info-data").text(s.attack),t.find("tr.info-attack-bullseye td.info-data").text(s.attackbull),t.find("tr.info-attack-fullfront td.info-data").text(s.attackf),t.find("tr.info-attack-left td.info-data").text(s.attackl),t.find("tr.info-attack-right td.info-data").text(s.attackr),t.find("tr.info-attack-back td.info-data").text(s.attackb),t.find("tr.info-attack-turret td.info-data").text(s.attackt),t.find("tr.info-attack-doubleturret td.info-data").text(s.attackdt),t.find("tr.info-attack").toggle(null!=s.attack),t.find("tr.info-attack-bullseye").toggle(null!=s.attackbull),t.find("tr.info-attack-fullfront").toggle(null!=s.attackf),t.find("tr.info-attack-left").toggle(null!=s.attackl),t.find("tr.info-attack-right").toggle(null!=s.attackr),t.find("tr.info-attack-back").toggle(null!=s.attackb),t.find("tr.info-attack-turret").toggle(null!=s.attackt),t.find("tr.info-attack-doubleturret").toggle(null!=s.attackdt),t.find("tr.info-ship").hide(),null!=s.base?t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",s.base)):t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),t.find("tr.info-base").show(),t.find("tr.info-faction td.info-data").text([function(){for(var t=s.factions,e=[],i=0,n=t.length;i<n;i++)m=t[i],e.push(exportObj.translate("faction",m));return e}()]),t.find("tr.info-faction").hide(),t.find("p.info-restrictions").hide(),E=0,M=(G=t.find("tr.info-attack td.info-header i.xwing-miniatures-font")[0].classList).length;E<M;E++)(f=G[E]).startsWith("xwing-miniatures-font-attack")&&t.find("tr.info-attack td.info-header i.xwing-miniatures-font").removeClass(f);if(t.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(l=s.attack_icon)?l:"xwing-miniatures-font-attack"),t.find("tr.info-range").hide(),t.find("tr.info-agility td.info-data").text(s.agility),t.find("tr.info-agility").toggle(null!=s.agility),t.find("tr.info-hull td.info-data").text(s.hull),t.find("tr.info-hull").toggle(null!=s.hull),i="",null!=s.shieldrecurr)for(e=0;e<s.shieldrecurr;)i+='<sup><i class="fas fa-caret-up"></i></sup>',++e;if(t.find("tr.info-shields td.info-data").html(s.shields+i),t.find("tr.info-shields").toggle(null!=s.shields),i="",null!=s.energyrecurr)for(e=0;e<s.energyrecurr;)i+='<sup><i class="fas fa-caret-up"></i></sup>',++e;t.find("tr.info-energy td.info-data").html(s.energy+i),t.find("tr.info-energy").toggle(null!=s.energy),t.find("tr.info-force").hide(),t.find("tr.info-charge").hide(),t.find("tr.info-actions td.info-data").html(this.formatActions(s.actions,", ",null!=(l=s.keyword)?l:[])),t.find("tr.info-actions").show(),t.find("tr.info-upgrades").show(),t.find("tr.info-upgrades td.info-data").html(function(){var t=[];for(T in C)L=C[T],t.push(1===L?exportObj.translate("sloticon",T):2===L?"("+exportObj.translate("sloticon",T)+")":3===L?exportObj.translate("sloticon",T)+exportObj.translate("sloticon",T):4===L?exportObj.translate("sloticon",T)+"("+exportObj.translate("sloticon",T)+")":5===L?"("+exportObj.translate("sloticon",T)+exportObj.translate("sloticon",T)+")":6===L?exportObj.translate("sloticon",T)+exportObj.translate("sloticon",T)+exportObj.translate("sloticon",T):void 0);return t}().join(" ")||"None"),t.find("p.info-text").hide(),t.find("p.info-chassis").show(),t.find("p.info-chassis").html(null!=s.chassis?"<strong>"+(null!=(l=null!=(l=exportObj.chassis[s.chassis])?l.display_name:void 0)?l:s.chassis)+":</strong> "+exportObj.chassis[s.chassis].text:""),t.find("p.info-maneuvers").show(),t.find("p.info-maneuvers").html(this.getManeuverTableHTML(s.maneuvers,s.maneuvers)),l=function(){for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)I=t[i],e.push(exportObj.translate("sources",I));return e}().sort(),t.find(".info-sources.info-data").text(1<l.length||(o=exportObj.translate("sources","Loose Ships"),!(0<=__indexOf.call(l,o)))?0<l.length?l.join(", "):exportObj.translate("ui","unreleased"):this.uitranslation("Only available from 1st edition")),t.find(".info-sources").show();break;case"Pilot":if(t.find(".info-type").text(exportObj.translate("types",c)),t.find(".info-sources.info-data").text(function(){for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)I=t[i],e.push(exportObj.translate("sources",I));return e}().sort().join(", ")),t.find(".info-sources").show(),null!=(null!=(o=this.collection)?o.counts:void 0)?(l=null!=(o=null!=(l=this.collection.counts)&&null!=(V=l.pilot)?V[s.name]:void 0)?o:0,d=null!=(o=null!=(V=this.collection.counts.ship)?V[s.ship]:void 0)?o:0,t.find(".info-collection").text(this.uitranslation("collectionContentShipsAndPilots",d,l)),t.find(".info-collection").show()):t.find(".info-collection").hide(),null!=(null!=u?u.effectiveStats:void 0)&&(r=u.effectiveStats()),null!=s.unique)A="&middot;&nbsp;";else if(null!=s.max_per_squad){for(e=0,A="";e<s.max_per_squad;)A=A.concat("&middot;"),++e;A=A.concat("&nbsp;")}else A="";if(t.find(".info-name").html(""+A+(s.display_name||s.name)+(exportObj.isReleased(s)?"":" ("+exportObj.translate("ui","unreleased")+")")),""!==(V=this.restriction_text(s)+this.upgrade_effect(s))&&"Conversion"!==s.ship?(t.find("p.info-restrictions").html(V),t.find("p.info-restrictions").show()):t.find("p.info-restrictions").hide(),t.find("p.info-text").html(null!=(o=s.text)?o:""),t.find("p.info-text").show(),a=exportObj.ships[s.ship],""!==(d=null!=(null!=r?r.chassis:void 0)&&""!==r.chassis?r.chassis:null!=s.chassis?s.chassis:null!=a.chassis?a.chassis:"")?(t.find("p.info-chassis").html("<strong>"+(null!=(o=null!=(l=exportObj.chassis[d])?l.display_name:void 0)?o:d)+":</strong> "+exportObj.chassis[d].text),t.find("p.info-chassis").show()):t.find("p.info-chassis").hide(),t.find("tr.info-ship td.info-data").text(s.ship),t.find("tr.info-ship").show(),t.find("tr.info-faction td.info-data").text(exportObj.translate("faction",s.faction)),t.find("tr.info-faction").hide(),null!=a.base?t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",a.base)):t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),t.find("tr.info-base").show(),t.find("tr.info-skill td.info-data").text(s.skill),t.find("tr.info-skill").toggle(null!=s.skill),t.find("tr.info-points td.info-data").text(s.points),t.find("tr.info-points").show(),t.find("tr.info-loadout td.info-data").text(s.loadout),null!=s.upgrades?t.find("tr.info-loadout").hide():t.find("tr.info-loadout").show(),null!=s.engagement?(t.find("tr.info-engagement td.info-data").text(s.engagement),t.find("tr.info-engagement").show()):t.find("tr.info-engagement").hide(),t.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(l=a.attack_icon)?l:"xwing-miniatures-font-attack"),t.find("tr.info-attack td.info-data").text(statAndEffectiveStat(null!=(d=null!=(o=s.ship_override)?o.attack:void 0)?d:a.attack,r,"attack")),t.find("tr.info-attack").toggle(0<(null!=(o=null!=(l=s.ship_override)?l.attack:void 0)?o:a.attack)||null!=(null!=r?r.attack:void 0)&&0<(null!=r?r.attack:void 0)),t.find("tr.info-attack-fullfront td.info-data").text(statAndEffectiveStat(null!=(l=null!=(d=s.ship_override)?d.attackf:void 0)?l:a.attackf,r,"attackf")),t.find("tr.info-attack-fullfront").toggle(null!=a.attackf||null!=(null!=r?r.attackf:void 0)),t.find("tr.info-attack-bullseye td.info-data").text(statAndEffectiveStat(null!=(d=null!=(o=s.ship_override)?o.attackbull:void 0)?d:a.attackbull,r,"attackbull")),t.find("tr.info-attack-bullseye").toggle(null!=a.attackbull||null!=(null!=r?r.attackbull:void 0)),t.find("tr.info-attack-left td.info-data").text(statAndEffectiveStat(null!=(o=null!=(l=s.ship_override)?l.attackl:void 0)?o:a.attackl,r,"attackl")),t.find("tr.info-attack-left").toggle(null!=a.attackl||null!=(null!=r?r.attackl:void 0)),t.find("tr.info-attack-right td.info-data").text(statAndEffectiveStat(null!=(l=null!=(d=s.ship_override)?d.attackr:void 0)?l:a.attackr,r,"attackr")),t.find("tr.info-attack-right").toggle(null!=a.attackr||null!=(null!=r?r.attackr:void 0)),t.find("tr.info-attack-back td.info-data").text(statAndEffectiveStat(null!=(d=null!=(o=s.ship_override)?o.attackb:void 0)?d:a.attackb,r,"attackb")),t.find("tr.info-attack-back").toggle(null!=a.attackb||null!=(null!=r?r.attackb:void 0)),t.find("tr.info-attack-turret td.info-data").text(statAndEffectiveStat(null!=(o=null!=(l=s.ship_override)?l.attackt:void 0)?o:a.attackt,r,"attackt")),t.find("tr.info-attack-turret").toggle(null!=(null!=(d=s.ship_override)?d.attackt:void 0)||null!=a.attackt||null!=(null!=r?r.attackt:void 0)),t.find("tr.info-attack-doubleturret td.info-data").text(statAndEffectiveStat(null!=(o=null!=(l=s.ship_override)?l.attackdt:void 0)?o:a.attackdt,r,"attackdt")),t.find("tr.info-attack-doubleturret").toggle(null!=a.attackdt||null!=(null!=r?r.attackdt:void 0)),t.find("tr.info-range").hide(),t.find("td.info-rangebonus").hide(),t.find("tr.info-agility td.info-data").text(statAndEffectiveStat(null!=(l=null!=(d=s.ship_override)?d.agility:void 0)?l:a.agility,r,"agility")),t.find("tr.info-agility").toggle(null!=(null!=(o=s.ship_override)?o.agility:void 0)||null!=a.agility),t.find("tr.info-hull td.info-data").text(statAndEffectiveStat(null!=(l=null!=(d=s.ship_override)?d.hull:void 0)?l:a.hull,r,"hull")),t.find("tr.info-hull").toggle(null!=(null!=(o=s.ship_override)?o.hull:void 0)||null!=a.hull),i="",null!=a.shieldrecurr)for(e=0;e<a.shieldrecurr;)i+='<sup><i class="fas fa-caret-up"></i></sup>',++e;if(t.find("tr.info-shields td.info-data").html(statAndEffectiveStat(null!=(l=null!=(d=s.ship_override)?d.shields:void 0)?l:a.shields,r,"shields")+i),t.find("tr.info-shields").toggle(null!=(null!=(o=s.ship_override)?o.shields:void 0)||null!=a.shields),i="",null!=a.energyrecurr)for(e=0;e<a.energyrecurr;)i+='<sup><i class="fas fa-caret-up"></i></sup>',++e;if(t.find("tr.info-energy td.info-data").html(statAndEffectiveStat(null!=(l=null!=(d=s.ship_override)?d.energy:void 0)?l:a.energy,r,"energy")+i),t.find("tr.info-energy").toggle(null!=(null!=(o=s.ship_override)?o.energy:void 0)||null!=a.energy),null!=(null!=r?r.force:void 0)&&0<r.force||null!=s.force){for(i="",b=1,null!=(null!=r?r.forcerecurring:void 0)?b=r.forcerecurring:null!=s.forcerecurring&&(b=s.forcerecurring),e=0;e<b;)i+='<sup><i class="fas fa-caret-up"></i></sup>',++e;t.find("tr.info-force td.info-data").html(statAndEffectiveStat(null!=(l=null!=(d=s.ship_override)?d.force:void 0)?l:s.force,r,"force")+i),t.find("tr.info-force").show()}else t.find("tr.info-force").hide();if(null!=s.charge){if(i="",null!=s.recurring)if(0<s.recurring)for(e=0;e<s.recurring;)i+='<sup><i class="fas fa-caret-up"></i></sup>',++e;else for(e=s.recurring;e<0;)i+='<sub><i class="fas fa-caret-down"></i></sub>',++e;p=$.trim(""+s.charge+i),t.find("tr.info-charge td.info-data").html(p),t.find("tr.info-charge").show()}else t.find("tr.info-charge").hide();null!=(null!=r?r.actions:void 0)?t.find("tr.info-actions td.info-data").html(this.formatActions(null!=(d=null!=(o=s.ship_override)?o.actions:void 0)?d:r.actions,", ")):t.find("tr.info-actions td.info-data").html(this.formatActions(null!=(o=null!=(l=s.ship_override)?l.actions:void 0)?o:a.actions,", ",null!=(d=s.keyword)?d:[])),t.find("tr.info-actions").show(),this.isQuickbuild?t.find("tr.info-upgrades").hide():(t.find("tr.info-upgrades").show(),t.find("tr.info-upgrades td.info-data").html(null!=s.slots?function(){for(var t=s.slots,e=[],i=0,n=t.length;i<n;i++)T=t[i],e.push(exportObj.translate("sloticon",T));return e}().join(" "):null!=s.upgrades?this.listStandardUpgrades(s.upgrades):"None")),t.find("p.info-maneuvers").show(),t.find("p.info-maneuvers").html(this.getManeuverTableHTML(null!=(l=null!=r?r.maneuvers:void 0)?l:a.maneuvers,a.maneuvers));break;case"Quickbuild":if(t.find(".info-type").text(this.uitranslation("Quickbuild")),t.find(".info-sources").hide(),t.find(".info-collection").hide(),n=exportObj.pilots[s.pilot],a=exportObj.ships[s.ship],null!=n.unique)A="&middot;&nbsp;";else if(null!=n.max_per_squad){for(e=0,A="";e<s.max_per_squad;)A=A.concat("&middot;"),++e;A=A.concat("&nbsp;")}else A="";if(t.find(".info-name").html(""+A+(n.display_name||n.name)+(null!=s.suffix?s.suffix:"")+(exportObj.isReleased(n)?"":" ("+exportObj.translate("ui","unreleased")+")")),""!==(V=this.restriction_text(s)+this.upgrade_effect(s))?(t.find("p.info-restrictions").html(null!=V?V:""),t.find("p.info-restrictions").show()):t.find("p.info-restrictions").hide(),t.find("p.info-text").html(null!=(o=n.text)?o:""),t.find("p.info-text").show(),t.find("p.info-chassis").html(null!=n.chassis?"<strong>"+(null!=(l=null!=(d=exportObj.chassis[n.chassis])?d.display_name:void 0)?l:n.chassis)+":</strong> "+exportObj.chassis[n.chassis].text:null!=a.chassis?"<strong>"+a.chassis+":</strong> "+exportObj.chassis[a.chassis].text:""),t.find("p.info-chassis").show(),t.find("tr.info-ship td.info-data").text(s.ship),t.find("tr.info-ship").show(),t.find("tr.info-faction td.info-data").text(exportObj.translate("faction",s.faction)),t.find("tr.info-faction").hide(),null!=a.base?t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",a.base)):t.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),t.find("tr.info-base").show(),t.find("tr.info-skill td.info-data").text(n.skill),t.find("tr.info-skill").show(),t.find("tr.info-points").hide(),t.find("tr.info-loadout").hide(),t.find("tr.info-engagement td.info-data").text(n.skill),t.find("tr.info-engagement").show(),t.find("tr.info-attack td.info-data").text(null!=(d=null!=(o=n.ship_override)?o.attack:void 0)?d:a.attack),t.find("tr.info-attack").toggle(0<(null!=(o=null!=(l=n.data.ship_override)?l.attack:void 0)?o:a.attack)),t.find("tr.info-attack-fullfront td.info-data").text(a.attackf),t.find("tr.info-attack-fullfront").toggle(null!=a.attackf),t.find("tr.info-attack-bullseye td.info-data").text(a.attackbull),t.find("tr.info-attack-bullseye").toggle(null!=a.attackbull),t.find("tr.info-attack-left td.info-data").text(a.attackl),t.find("tr.info-attack-left").toggle(null!=a.attackl),t.find("tr.info-attack-right td.info-data").text(a.attackr),t.find("tr.info-attack-right").toggle(null!=a.attackr),t.find("tr.info-attack-back td.info-data").text(a.attackb),t.find("tr.info-attack-back").toggle(null!=a.attackb),t.find("tr.info-attack-turret td.info-data").text(a.attackt),t.find("tr.info-attack-turret").toggle(null!=a.attackt),t.find("tr.info-attack-doubleturret td.info-data").text(a.attackdt),t.find("tr.info-attack-doubleturret").toggle(null!=a.attackdt),t.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(d=a.attack_icon)?d:"xwing-miniatures-font-frontarc"),t.find("tr.info-energy td.info-data").text(null!=(o=null!=(l=n.ship_override)?l.energy:void 0)?o:a.energy),t.find("tr.info-energy").toggle(null!=(null!=(d=n.ship_override)?d.energy:void 0)||null!=a.energy),t.find("tr.info-range").hide(),t.find("td.info-rangebonus").hide(),t.find("tr.info-agility td.info-data").text(null!=(o=null!=(l=n.ship_override)?l.agility:void 0)?o:a.agility),t.find("tr.info-agility").show(),t.find("tr.info-hull td.info-data").text(null!=(l=null!=(d=n.ship_override)?d.hull:void 0)?l:a.hull),t.find("tr.info-hull").show(),t.find("tr.info-shields td.info-data").text(null!=(d=null!=(o=n.ship_override)?o.shields:void 0)?d:a.shields),t.find("tr.info-shields").show(),null!=(null!=r?r.force:void 0)||null!=s.force){for(i="",b=1,null!=(null!=r?r.forcerecurring:void 0)&&(b=r.forcerecurring),e=0;e<b;)i+='<sup><i class="fas fa-caret-up"></i></sup>',++e;t.find("tr.info-force td.info-data").html((null!=(o=null!=(l=n.ship_override)?l.force:void 0)?o:n.force)+i),t.find("tr.info-force").show()}else t.find("tr.info-force").hide();if(null!=s.charge){if(i="",null!=s.recurring)if(0<s.recurring)for(e=0;e<s.recurring;)i+='<sup><i class="fas fa-caret-up"></i></sup>',++e;else for(e=s.recurring;e<0;)i+='<sub><i class="fas fa-caret-down"></i></sub>',++e;p=$.trim(""+s.charge+i),t.find("tr.info-charge td.info-data").html(p),t.find("tr.info-charge").show()}else t.find("tr.info-charge").hide();t.find("tr.info-actions td.info-data").html(this.formatActions(null!=(r=null!=(d=n.ship_override)?d.actions:void 0)?r:exportObj.ships[s.ship].actions,", ",null!=(l=n.keyword)?l:[])),t.find("tr.info-actions").show(),t.find("tr.info-upgrades").show(),t.find("tr.info-upgrades td.info-data").html(function(){for(var t,e=null!=(t=s.upgrades)?t:[],i=[],n=0,a=e.length;n<a;n++)U=e[n],i.push(null!=exportObj.upgrades[U].display_name?exportObj.upgrades[U].display_name:U);return i}().join(", ")||"None"),t.find("p.info-maneuvers").show(),t.find("p.info-maneuvers").html(this.getManeuverTableHTML(a.maneuvers,a.maneuvers));break;case"Addon":if(t.find(".info-type").text(exportObj.translate("slot",u.addon_type)),null!=s.standard?(k=this.getPilotsMatchingUpgrade(s.name,!1),t.find(".info-sources.info-data").text(function(){for(var t=[],e=0,i=k.length;e<i;e++)n=k[e],t.push(n.display_name);return t}().sort().join(", "))):t.find(".info-sources.info-data").text(function(){for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)I=t[i],e.push(exportObj.translate("sources",I));return e}().sort().join(", ")),t.find(".info-sources").show(),null!=s.unique)A="&middot;&nbsp;";else if(null!=s.max_per_squad){for(e=0,A="";e<s.max_per_squad;)A=A.concat("&middot;"),++e;A=A.concat("&nbsp;")}else A="";if(null!=(null!=(o=this.collection)?o.counts:void 0)&&null==s.standard?(H=null!=(r=null!=(d=this.collection.counts)&&null!=(H=d.upgrade)?H[s.name]:void 0)?r:0,t.find(".info-collection").text(this.uitranslation("collectionContentUpgrades",H)),t.find(".info-collection").show()):t.find(".info-collection").hide(),t.find(".info-name").html(""+A+(s.display_name||s.name)+(exportObj.isReleased(s)||null!=s.standard?"":" ("+this.uitranslation("unreleased")+")")+(null!=s.standard?" (S)":"")),null!=s.variablepoints){switch(q="<i>"+this.uitranslation("varPointCostsPoints",s.points),s.variablepoints){case"Agility":q+=this.uitranslation("varPointCostsConditionAgility",function(){Y=[];for(var t=0,e=s.points.length-1;0<=e?t<=e:e<=t;0<=e?t++:t--)Y.push(t);return Y}.apply(this));break;case"Initiative":q+=this.uitranslation("varPointCostsConditionIni",function(){Z=[];for(var t=0,e=s.points.length-1;0<=e?t<=e:e<=t;0<=e?t++:t--)Z.push(t);return Z}.apply(this));break;case"Base":q+=this.uitranslation("varPointCostsConditionBase");break;case"Faction":q+=this.uitranslation("varPointCostsConditionFaction",s.faction)}q+="</i>"}if(V=this.restriction_text(s)+this.upgrade_effect(s),null!=q||""!==V?(null!=q&&""!==V&&(q+="<br/>"),t.find("p.info-restrictions").html((null!=q?q:"")+V),t.find("p.info-restrictions").show()):t.find("p.info-restrictions").hide(),t.find("p.info-text").html(null!=(l=s.text)?l:""),t.find("p.info-text").show(),t.find("p.info-chassis").hide(),t.find("tr.info-ship").hide(),t.find("tr.info-faction").hide(),t.find("tr.info-base").hide(),t.find("tr.info-skill").hide(),t.find("tr.info-points").hide(),t.find("tr.info-loadout").hide(),t.find("tr.info-engagement").hide(),null!=s.energy?(t.find("tr.info-energy td.info-data").text(s.energy),t.find("tr.info-energy").show()):t.find("tr.info-energy").hide(),null!=s.attack?(t.find("tr.info-attack td.info-data").text(s.attack),t.find("tr.info-attack").show()):t.find("tr.info-attack").hide(),null!=s.attackb?(t.find("tr.info-attack-back td.info-data").text(s.attackb),t.find("tr.info-attack-back").show()):t.find("tr.info-attack-back").hide(),null!=s.attackt?(t.find("tr.info-attack-turret td.info-data").text(s.attackt),t.find("tr.info-attack-turret").show()):t.find("tr.info-attack-turret").hide(),null!=s.attackr?(t.find("tr.info-attack-right td.info-data").text(s.attackr),t.find("tr.info-attack-right").show()):t.find("tr.info-attack-right").hide(),null!=s.attackl?(t.find("tr.info-attack-left td.info-data").text(s.attackl),t.find("tr.info-attack-left").show()):t.find("tr.info-attack-left").hide(),null!=s.attackdt?(t.find("tr.info-attack-doubleturret td.info-data").text(s.attackdt),t.find("tr.info-attack-doubleturret").show()):t.find("tr.info-attack-doubleturret").hide(),null!=s.attackbull?(t.find("tr.info-attack-bullseye td.info-data").text(s.attackbull),t.find("tr.info-attack-bullseye").show()):t.find("tr.info-attack-bullseye").hide(),null!=s.attackf?(t.find("tr.info-attack-fullfront td.info-data").text(s.attackf),t.find("tr.info-attack-fullfront").show()):t.find("tr.info-attack-fullfront").hide(),null!=s.charge){if(i="",null!=s.recurring)if(0<s.recurring)for(e=0;e<s.recurring;)i+='<sup><i class="fas fa-caret-up"></i></sup>',++e;else for(e=s.recurring;e<0;)i+='<sub><i class="fas fa-caret-down"></i></sub>',++e;p=$.trim(""+s.charge+i),t.find("tr.info-charge td.info-data").html(p)}if(t.find("tr.info-charge").toggle(null!=s.charge),null!=s.range?(t.find("tr.info-range td.info-data").text(s.range),t.find("tr.info-range").show()):t.find("tr.info-range").hide(),null!=s.rangebonus?t.find("td.info-rangebonus").show():t.find("td.info-rangebonus").hide(),null!=s.force){for(i="",b=1,null!=s.forcerecurring&&(b=s.forcerecurring),e=0;e<b;)i+='<sup><i class="fas fa-caret-up"></i></sup>',++e;t.find("tr.info-force td.info-data").html(s.force+i)}t.find("tr.info-force").toggle(null!=s.force),t.find("tr.info-agility").hide(),t.find("tr.info-hull").hide(),t.find("tr.info-shields").hide(),t.find("tr.info-actions").hide(),t.find("tr.info-upgrades").hide(),t.find("p.info-maneuvers").hide();break;case"Rules":t.find(".info-type").hide(),t.find(".info-sources").hide(),t.find(".info-collection").hide(),t.find(".info-name").html(s.name),t.find(".info-name").show(),t.find("p.info-restrictions").hide(),t.find("p.info-text").html(s.text),t.find("p.info-text").show(),t.find("tr.info-ship").hide(),t.find("tr.info-faction").hide(),t.find("tr.info-base").hide(),t.find("tr.info-skill").hide(),t.find("tr.info-points").hide(),t.find("tr.info-loadout").hide(),t.find("tr.info-agility").hide(),t.find("tr.info-hull").hide(),t.find("tr.info-shields").hide(),t.find("tr.info-actions").hide(),t.find("tr.info-upgrades").hide(),t.find("p.info-maneuvers").hide(),t.find("tr.info-energy").hide(),t.find("tr.info-attack").hide(),t.find("tr.info-attack-turret").hide(),t.find("tr.info-attack-bullseye").hide(),t.find("tr.info-attack-fullfront").hide(),t.find("tr.info-attack-back").hide(),t.find("tr.info-attack-doubleturret").hide(),t.find("tr.info-charge").hide(),t.find("td.info-rangebonus").hide(),t.find("tr.info-range").hide(),t.find("tr.info-force").hide();break;case"MissingStuff":for(t.find(".info-type").text(this.uitranslation("List of Missing items")),t.find(".info-sources").hide(),t.find(".info-collection").hide(),t.find(".info-name").html(this.uitranslation("Missing items")),t.find(".info-name").show(),y=this.uitranslation("Missing Item List:")+"<ul>",N=0,B=s.length;N<B;N++){for(y+="<li><strong>"+(null!=(x=s[N]).display_name?x.display_name:x.name)+"</strong> (",_=!0,R=0,z=(X=x.sources).length;R<z;R++)_||(y+=", "),y+=I=X[R],_=!1;y+=")</li>"}y+="</ul>",t.find("p.info-restrictions").hide(),t.find("p.info-text").html(y),t.find("p.info-text").show(),t.find("tr.info-ship").hide(),t.find("tr.info-faction").hide(),t.find("tr.info-base").hide(),t.find("tr.info-skill").hide(),t.find("tr.info-points").hide(),t.find("tr.info-loadout").hide(),t.find("tr.info-agility").hide(),t.find("tr.info-hull").hide(),t.find("tr.info-shields").hide(),t.find("tr.info-actions").hide(),t.find("tr.info-upgrades").hide(),t.find("p.info-maneuvers").hide(),t.find("tr.info-energy").hide(),t.find("tr.info-attack").hide(),t.find("tr.info-attack-turret").hide(),t.find("tr.info-attack-bullseye").hide(),t.find("tr.info-attack-fullfront").hide(),t.find("tr.info-attack-back").hide(),t.find("tr.info-attack-doubleturret").hide(),t.find("tr.info-charge").hide(),t.find("td.info-rangebonus").hide(),t.find("tr.info-range").hide(),t.find("tr.info-force").hide();break;case"Damage":t.find(".info-type").text(exportObj.translate("types",s.type)),t.find(".info-sources.info-data").text(function(){for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)I=t[i],e.push(exportObj.translate("sources",I));return e}().sort().join(", ")),t.find(".info-sources").show(),null!=(null!=(o=this.collection)?o.counts:void 0)?(H=null!=(r=null!=(d=this.collection.counts)&&null!=(Q=d.damage)?Q[s.name]:void 0)?r:0,t.find(".info-collection").text(this.uitranslation("collectionContentUpgrades",H)),t.find(".info-collection").show()):t.find(".info-collection").hide(),t.find(".info-name").html((s.display_name||s.name)+" ("+s.quantity+"x)"),t.find("p.info-restrictions").hide(),t.find("p.info-text").html(null!=(V=s.text)?V:""),t.find("p.info-text").show(),t.find("p.info-chassis").hide(),t.find("tr.info-ship").hide(),t.find("tr.info-faction").hide(),t.find("tr.info-base").hide(),t.find("tr.info-skill").hide(),t.find("tr.info-points").hide(),t.find("tr.info-loadout").hide(),t.find("tr.info-engagement").hide(),t.find("tr.info-energy").hide(),t.find("tr.info-attack").hide(),t.find("tr.info-attack-back").hide(),t.find("tr.info-attack-turret").hide(),t.find("tr.info-attack-right").hide(),t.find("tr.info-attack-left").hide(),t.find("tr.info-attack-doubleturret").hide(),t.find("tr.info-attack-bullseye").hide(),t.find("tr.info-attack-fullfront").hide(),t.find("tr.info-charge").hide(),t.find("tr.info-range").hide(),t.find("td.info-rangebonus").hide(),t.find("tr.info-force").hide(),t.find("tr.info-agility").hide(),t.find("tr.info-hull").hide(),t.find("tr.info-shields").hide(),t.find("tr.info-actions").hide(),t.find("tr.info-upgrades").hide(),t.find("p.info-maneuvers").hide()}if(t!==this.mobile_tooltip_modal&&(t.find(".info-well").show(),t.find(".intro").hide()),this.tooltip_currently_displaying=s,768<=$(window).width())return h=t.find(".info-well"),$.isElementInView(h,!0)?h.css("position","fixed"):h.css("position","static")}},t.prototype._randomizerLoopBody=function(a){var s,t,c,l,e,i,o,n,r,d,u,h,p,f,m,_,b,g,v,x,k,y;if(a.keep_running){if(this.total_points===a.max_points){if(a.keep_running=!1,this.isQuickbuild)return void(a.keep_running=!1);for(n=0,h=(g=this.ships).length;n<h;n++)if(c=[],null!=(l=g[n]).pilot.loadout&&null==l.pilot.upgrades)for(;l.upgrade_points_total<l.pilot.loadout;){for(i=[],r=0,p=(v=l.upgrades).length;r<p;r++)null!=(o=v[r]).data||null!=o.occupied_by&&null!==o.occupied_by||0<=__indexOf.call(c,o)||i.push(o);if(0===i.length)break;s=i[$.randomInt(i.length)],0<(t=function(){for(var t=this.getAvailableUpgradesIncluding(s.slot,null,l,s,"",this.dfl_filter_func,!1),e=[],i=0,n=t.length;i<n;i++)o=t[i],!exportObj.upgradesById[o.id].sources.intersects(a.allowed_sources)||a.collection_only&&!this.collection.checkShelf("upgrade",o.name)||o.disabled||e.push(o);return e}.call(this)).length?(o=t[$.randomInt(t.length)],s.setById(o.id)):c.push(s)}}else if(this.total_points<a.max_points){if(0<(e=0===(e=this.getAvailableShipsMatchingAndCheapEnough(a.max_points-this.total_points,"",!1,a.collection_only)).length?this.getAvailableShipsMatching("",!1,a.collection_only):e).length&&(this.ships.length<a.ship_limit||0===a.ship_limit)){if(e=e[$.randomInt(e.length)].name,0===(e=this.getAvailablePilotsForShipIncluding(e)).length)return;(e=e[$.randomInt(e.length)]).disabled||!(this.isQuickbuild?exportObj.pilots[exportObj.quickbuildsById[e.id].pilot]:exportObj.pilotsById[e.id]).sources.intersects(a.allowed_sources)||a.collection_only&&!this.collection.checkShelf("pilot",this.isQuickbuild?exportObj.quickbuildsById[e.id]:e.name)||this.addShip().setPilotById(e.id)}}else this.removeShip(this.ships[$.randomInt(this.ships.length)]);return window.setTimeout(this._makeRandomizerLoopFunc(a),0)}for(;this.total_points>a.max_points;)this.removeShip(this.ships[$.randomInt(this.ships.length)]);if(a.fill_zero_pts)for(d=0,f=(x=this.ships).length;d<f;d++)for(u=0,m=(k=(l=x[d]).upgrades).length;u<m;u++)null!=(s=k[u]).data||null!=s.occupied_by&&null!==s.occupied_by||(o=0<(t=function(){for(var t=this.getAvailableUpgradesIncluding(s.slot,null,s.ship,s,"",this.dfl_filter_func,!1),e=[],i=0,n=t.length;i<n;i++)o=t[i],exportObj.upgradesById[o.id].sources.intersects(a.allowed_sources)&&o.points<1&&(!a.collection_only||this.collection.checkShelf("upgrade",o.name))&&e.push(o);return e}.call(this)).length?t[$.randomInt(t.length)]:void 0)&&!o.disabled&&s.setById(o.id);for(window.clearTimeout(a.timer),b=0,_=(y=this.ships).length;b<_;b++)(l=y[b]).updateSelections();return this.suppress_automatic_new_ship=!1,this.addShip()},t.prototype._makeRandomizerLoopFunc=function(t){return e=this,function(){return e._randomizerLoopBody(t)};var e},t.prototype.randomSquad=function(t,e,i,n,a,s){var l;for(null==t&&(t=200),null==e&&(e=null),null==i&&(i=1e3),null==n&&(n=0),null==a&&(a=!0),null==s&&(s=!1),this.backend_status.fadeOut("slow"),this.suppress_automatic_new_ship=!0,e.length<1&&(e=null);0<this.ships.length;)this.removeShip(this.ships[0]);if(0<this.ships.length)throw new Error("Ships not emptied");return(l={max_points:t,ship_limit:n,keep_running:!0,allowed_sources:null!=e?e:exportObj.expansions,collection_only:null!=this.collection&&"true"===this.collection.checks.collectioncheck&&a,fill_zero_pts:s}).timer=window.setTimeout(function(){return l.keep_running=!1},i),window.setTimeout(this._makeRandomizerLoopFunc(l),0),this.resetCurrentSquad(),this.current_squad.name=this.uitranslation("Random Squad"),this.container.trigger("xwing-backend:squadNameChanged")},t.prototype.setBackend=function(t){var e,i,n,a,s;if(this.backend=t,null!=this.waiting_for_backend){for(s=[],i=0,n=(a=this.waiting_for_backend).length;i<n;i++)e=a[i],s.push(e());return s}},t.prototype.upgrade_effect=function(t){var e,i,n,a,s,l,o,r,c,u,d=a=i="";if(t.modifier_func&&(t.modifier_func(n={attack:0,attackf:0,attackbull:0,attackb:0,attackt:0,attackl:0,attackr:0,attackdt:0,energy:0,agility:0,hull:0,shields:0,force:0,actions:[],maneuvers:[0,0]}),0!==n.attack&&(a+=i+"%FRONTARC% ("+n.attack+")",i=", "),0!==n.attackf&&(a+=i+"%FULLFRONTARC% ("+n.attackf+")",i=", "),0!==n.attackbull&&(a+=i+"%BULLSEYEARC% ("+n.attackbull+")",i=", "),0!==n.attackb&&(a+=i+"%REARARC% ("+n.attackb+")",i=", "),0!==n.attackt&&(a+=i+"%SINGLETURRETARC% ("+n.attackt+")",i=", "),0!==n.attackl&&(a+=i+"%LEFTARC% ("+n.attackl+")",i=", "),0!==n.attackr&&(a+=i+"%RIGHTARC% ("+n.attackr+")",i=", "),0!==n.attackdt&&(a+=i+"%DOUBLETURRETARC% ("+n.attackdt+")",i=", "),0!==n.energy&&(a+=i+"%ENERGY% ("+n.energy+")",i=", "),0!==n.agility&&(a+=i+"%AGILITY% ("+n.agility+")",i=", "),0!==n.hull&&(a+=i+"%HULL% ("+n.hull+")",i=", "),0!==n.shields&&(a+=i+"%SHIELD% ("+n.shields+")",i=", "),0<n.actions.length&&(a+=i+this.formatActions(n.actions,", "),i=", ")),t.confersAddons)for(s=0,o=(c=t.confersAddons).length;s<o;s++)"Force"===(e=c[s]).slot?a+=i+"%FORCEPOWER%":a+=i+("%"+e.slot.toUpperCase().replace(/[^a-z0-9]/gi,""))+"%",i=", ";if(t.unequips_upgrades)for(i="",l=0,r=(u=t.unequips_upgrades).length;l<r;l++)d+=i+("%"+u[l].toUpperCase().replace(/[^a-z0-9]/gi,""))+"%",i=", ";return""!==a?(n={text:"</br><b>"+this.uitranslation("adds",a)+"</b>"},""!==d&&(n.text+="</br><b>"+this.uitranslation("removes",d)+"</b>"),exportObj.fixIcons(n)):""},t.prototype.restriction_text=function(t){var c,u,e,h,i,n,a,s,l,o,r,d,p,f,m,_,b,g,v,x=e=n=s="",k=!1;if(t.restrictions)for(l=0,p=(b=t.restrictions).length;l<p;l++){switch((a=b[l])[0]){case"FactionOrUnique":n+=e+exportObj.translate("faction",""+a[2]),x=exportObj.translate("restrictions"," or Squad Including")+(" "+a[1]);break;case"Base":for(i=o=0,f=a.length;o<f;i=++o)"Base"!==(u=a[i])?(s+=u+" ",i<a.length-1?s+="or ":s+=exportObj.translate("restrictions","Ship")):s+=e;break;case"Action":c=[a[1]],s+=e+this.formatActions(c,"",[]);break;case"Equipped":s+=e+("%"+a[1].toUpperCase().replace(/[^a-z0-9]/gi,""))+"% Equipped";break;case"Slot":s+=e+exportObj.translate("restrictions","Extra")+(" %"+a[1].toUpperCase().replace(/[^a-z0-9]/gi,""))+"%";break;case"Keyword":s+=e+exportObj.translate("restrictions",""+a[1]),k=!0;break;case"AttackArc":s+=e+"%REARARC%";break;case"ShieldsGreaterThan":s+=e+("%SHIELD% > "+a[1]);break;case"EnergyGreatterThan":s+=e+("%ENERGY% > "+a[1]);break;case"InitiativeGreaterThan":s+=e+exportObj.translate("restrictions","Initiative")+(" > "+a[1]);break;case"InitiativeLessThan":s+=e+exportObj.translate("restrictions","Initiative")+(" < "+a[1]);break;case"HasForce":s+=e+(a[1]?"":"No ")+"%FORCE%";break;case"AgilityEquals":s+=e+exportObj.translate("restrictions","Agility")+(" = "+a[1]);break;case"isUnique":!0===a[1]?s+=e+exportObj.translate("restrictions","Limited"):s+=e+exportObj.translate("restrictions","Non-Limited");break;case"Format":s+=e+exportObj.translate("restrictions",a[1]+" Ship");break;case"Faction":n+=e+exportObj.translate("faction",""+a[1])}e=", "}if(!t.skill){if(""===n&&t.faction){if(t.faction instanceof Array)for(r=0,m=(g=t.faction).length;r<m;r++)h=g[r],n+=e+exportObj.translate("faction",""+h),e=" or ";else n+=e+exportObj.translate("faction",""+t.faction);e=", "}if(t.ship&&!1===k){if(t.ship instanceof Array)for(d=0,_=(v=t.ship).length;d<_;d++)n+=e+v[d],e=" or ";else n+=e+t.ship;e=", "}t.solitary&&(n+=e+exportObj.translate("gameterms","Solitary"),e=", "),t.standardized&&(n+=e+exportObj.translate("gameterms","Standardized"),e=", ")}return""!==(s+=n+x)?(t={text:"<i><b>"+exportObj.translate("restrictions","Restrictions")+":</b> "+s+"</i>"},exportObj.fixIcons(t)):""},t.prototype.describeSquad=function(){var a;return""===this.getNotes().trim()?function(){for(var t=this.ships,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).pilot&&e.push(a.pilot.name);return e}.call(this).join(", "):this.getNotes()},t.prototype.listCards=function(){for(var t,e,i,n,a,s={},l=this.ships,o=0,r=l.length;o<r;o++)if(null!=(t=l[o]).pilot)for(s[t.pilot.name]=null,i=0,n=(a=t.upgrades).length;i<n;i++)null!=(e=a[i]).data&&(s[e.data.name]=null);return Object.keys(s).sort()},t.prototype.getNotes=function(){return this.notes.val()},t.prototype.getTag=function(){return this.tag.val()},t.prototype.getObstacles=function(){return this.current_obstacles},t.prototype.isSquadPossibleWithCollection=function(){var t,e,i,n,a,s,l,o,r,c,u,d,h,p;if(0===Object.keys(null!=(d=null!=(d=this.collection)?d.expansions:void 0)?d:{}).length)return[!0,[]];if("true"!==(null!=(d=this.collection)?d.checks.collectioncheck:void 0))return[!0,[]];for(this.collection.reset(),l=!0,t=[],o=0,c=(h=this.ships).length;o<c;o++)if(null!=(i=h[o]).pilot&&(n=this.collection.use("ship",i.pilot.ship),e=this.collection.use("pilot",i.pilot.name),n&&e||(l=!1),n||t.push(i.data),e||t.push(i.pilot),null==i.pilot.upgrades))for(r=0,u=(p=i.upgrades).length;r<u;r++)null!=(a=p[r]).data&&((s=this.collection.use("upgrade",a.data.name))||null!=a.data.standard||(l=!1),s||null!=a.data.standard||t.push(a.data));return[l,t]},t.prototype.checkCollection=function(){var e,t,i,n;if(null!=this.collection)return t=(i=this.isSquadPossibleWithCollection())[0],e=i[1],this.collection_invalid_container.toggleClass("d-none",t),this.collection_invalid_container.on("mouseover",(n=this,function(t){return n.showTooltip("MissingStuff",e)}))},t.prototype.toXWS=function(){for(var t,c,u,e,i,h,a,p,n,s,l,o,f,m,_,b,g,v,r,x,k,d={description:this.getNotes(),faction:exportObj.toXWSFaction[this.faction],name:this.current_squad.name,pilots:[],points:this.total_points,vendor:{yasb:{builder:"YASB - X-Wing 2.5",builder_url:window.location.href.split("?")[0],link:this.getPermaLink()}},version:"02/23/2024"},y=this.ships,w=0,q=y.length;w<q;w++)null!=(p=y[w]).pilot&&d.pilots.push(p.toXWS());for(i={},c=0,n=function(){for(var t=d.pilots,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).multisection&&e.push(a);return e}(),l=0,r=Math.pow(n.length,2);(0<=r?l<r:r<l)&&0!==n.length&&(null==(s=n.shift()).multisection_id&&(s.multisection_id=c++),null==i[v=s.multisection_id]&&(i[v]=[s]),0!==n.length);0<=r?++l:--l){for(e=[],o=0,m=n.length;o<m&&(t=n[o],x=s.name,!(0<=__indexOf.call(t.multisection,x)&&(e.push(t),s.multisection.removeItem(t.name),t.multisection.removeItem(s.name),t.multisection_id=s.multisection_id,i[t.multisection_id].push(t),0===s.multisection.length)));o++);for(f=0,_=e.length;f<_;f++)0===(u=e[f]).multisection.length&&n.removeItem(u)}for(g=0,b=(k=d.pilots).length;g<b;g++)null!=(a=k[g]).multisection&&delete a.multisection;return null!=(h=this.getObstacles())&&0<h.length&&(d.obstacles=h),d},t.prototype.toMinimalXWS=function(){var t,e,i=this.toXWS();for(t in i)__hasProp.call(i,t)&&(i[t],"faction"!==t&&"pilots"!==t&&"version"!==t&&delete i[t]);for(t in e=i.pilots)__hasProp.call(e,t)&&(e[t],"id"!==t&&"upgrades"!==t&&"multisection_id"!==t&&delete i[t]);return i},t.prototype.loadFromXWS=function(a,c){var t,u,e,i,h,n,s,p,l,f,m,o,_,b,g,v,x,k,y,w,r,q,d,O=null,S=null,$=null!=a.version?function(){for(var t=a.version.split("."),e=[],i=0,n=t.length;i<n;i++)f=t[i],e.push(parseInt(f));return e}():[0,2];if(!1==!([0,1]<$)){if(m=exportObj.fromXWSFaction[a.faction],this.faction!==m)throw new Error("Attempted to load XWS for "+a.faction+" but builder is "+this.faction);for(null!=a.name&&(this.current_squad.name=a.name),null!=a.description&&this.notes.val(a.description),null!=a.obstacles&&(this.current_squad.additional_data.obstacles=a.obstacles),this.suppress_automatic_new_ship=!0,this.removeAllShips(),O=!0,t=this.isStandard?"h":"s",n=S="",_=0,v=(y=a.pilots).length;_<v;_++){if(r=y[_],this.addShip(),r.id)e=r.id;else{if(!r.name){O=!1,S="Pilot without identifier";break}e=r.name}if(null!=exportObj.pilotsByFactionXWS[m][e])n+=exportObj.pilotsByFactionXWS[m][e][0].id;else if(exportObj.pilotsByUniqueName[e]&&1===exportObj.pilotsByUniqueName[e].length)n+=exportObj.pilotsByUniqueName[e][0].id;else for(u in w=exportObj.pilotsByUniqueName)for(b=0,x=(h=w[u]).length;b<x;b++)if((i=h[b]).xws&&i.xws===e||!i.xws&&u===e){n+=i.id;break}for(l in exportObj.standardCheck(r,!0)||"h"!==t||(t="s"),n+="X",q=null!=(r=r.upgrades)?r:{})for(g=0,k=(p=q[l]).length;g<k;g++)s=p[g],d=null!=(d=exportObj.fromXWSUpgrade[l])?d:l.capitalize(),null!=s&&(null!=(o=null!=(o=exportObj.upgradesBySlotXWSName[d])[s]?o[s]:o[s]=exportObj.upgradesBySlotCanonicalName[d][s])?(n=n+o.id+"W",exportObj.standardCheck(o,!0)||"h"!==t||(t="s")):(console.log("Failed to load xws upgrade: "+s),S+="Skipped upgrade "+s,O=!1));n+="XY"}this.loadFromSerialized(n="v9Z"+t+"Z20Z"+n),this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")}return c({success:O,error:S})},t}(),Ship=function(){function t(t){this.builder=t.builder,this.container=t.container,this.pilot=null,this.data=null,this.quickbuildId=-1,this.linkedShip=null,this.primary=!0,this.upgrades=[],this.upgrade_points_total=0,this.wingmates=[],this.destroystate=0,this.uitranslation=this.builder.uitranslation,this.setupUI()}return t.prototype.destroy=function(t){__iced_k_noop;var e,i,n=iced.findDeferral(arguments);if(this.resetPilot(),this.resetAddons(),this.teardownUI(),(a=this.builder.ships.indexOf(this))<0)throw new Error("Ship not registered with builder");this.builder.ships.splice(a,1),0<this.wingmates.length&&this.setWingmates(0);var a=function(){return t()};null!==(e=this).linkedShip?(a=a,0<(null!=(i=e.linkedShip.wingmates)?i.length:void 0)&&0<=__indexOf.call(e.linkedShip.wingmates,e)?a(e.linkedShip.removeFromWing(e)):(e.linkedShip.linkedShip=null,i=new iced.Deferrals(a,{parent:n,funcname:"Ship.destroy"}),e.builder.removeShip(e.linkedShip,i.defer({lineno:6061})),i._fulfill())):a()},t.prototype.copyFrom=function(a){var t,e,c,u,i,n,s,l,o,r,h,p,f,m,_,b,g,v,d,x,k,y,w,q;if(a===this)throw new Error("Cannot copy from self");if(null!=a.pilot&&null!=a.data){if(this.builder.isQuickbuild){if(u=!(a.pilot.unique||null!=a.pilot.max_per_squad&&this.builder.countPilots(a.pilot.canonical_name)>=a.pilot.max_per_squad))for(o=0,f=(v=a.upgrades).length;o<f;o++)(null!=(null!=(d=(l=v[o]).data)?d.unique:void 0)&&l.data.unique||null!=(null!=(d=l.data)?d.max_per_squad:void 0)&&this.builder.countUpgrades(l.data.canonical_name)>=l.data.max_per_squad||null!=(null!=(d=l.data)?d.solitary:void 0))&&(u=!1);if(u)this.setPilotById(a.quickbuildId);else{if(!(0<(t=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(a.data.name),e=[],i=0,n=t.length;i<n;i++)(s=t[i]).disabled||e.push(s);return e}.call(this)).length))return;this.setPilotById(t[0].id,!0)}}else{if(a.pilot.unique||null!=a.pilot.max_per_squad&&this.builder.countPilots(a.pilot.canonical_name)>=a.pilot.max_per_squad){if(!(0<(t=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(a.data.name),e=[],i=0,n=t.length;i<n;i++)(s=t[i]).disabled||e.push(s);return e}.call(this)).length))return;this.setPilotById(t[0].id,!0)}else this.setPilotById(a.pilot.id,!0);for(n={},r=0,m=(x=a.upgrades).length;r<m;r++)null!=(null!=(l=x[r])?l.data:void 0)&&null==l.data.standardized&&null==l.data.standard&&!l.data.unique&&(null==l.data.max_per_squad||this.builder.countUpgrades(l.data.canonical_name)<l.data.max_per_squad)&&(null==n[g=l.slot]&&(n[g]=[]),n[l.slot].push(l));for(e={},h=0,_=(k=this.upgrades).length;h<_;h++)(l=k[h]).isOccupied()||null!=(i=(null!=(y=n[l.slot])?y:[]).shift())&&(l.setById(i.data.id),l.lastSetValid||(e[i.data.id]=l));for(c in e)(l=e[c]).setById(c);for(p=0,b=(w=this.upgrades).length;p<b;p++)(l=w[p]).isOccupied()||null!=(i=(null!=(q=n[l.slot])?q:[]).shift())&&l.setById(i.data.id);this.addStandardizedUpgrades()}return this.updateSelections(),this.builder.container.trigger("xwing:pointsUpdated"),this.builder.current_squad.dirty=!0,this.builder.container.trigger("xwing-backend:squadDirtinessChanged")}},t.prototype.setShipType=function(s){var t,l,e,i,n,a;for(this.pilot_selector.data("select2").container.show(),s!==(null!=(n=this.pilot)?n.ship:void 0)&&(this.builder.isQuickbuild?(n=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(s),e=[],i=0,n=t.length;i<n;i++)(l=t[i]).disabled||e.push(l.id);return e}.call(this)[0],this.setPilotById(n)):this.setPilot(function(){for(var t,e=this.builder.getAvailablePilotsForShipIncluding(s),i=[],n=0,a=e.length;n<a;n++)l=e[n],null!=exportObj.pilotsById[l.id].restriction_func&&!exportObj.pilotsById[l.id].restriction_func(this)||(t=exportObj.pilotsById[l.id],0<=__indexOf.call(this.builder.uniques_in_use.Pilot,t))||i.push(exportObj.pilotsById[l.id]);return i}.call(this)[0])),this.checkPilotSelectorQueryModal(),e=0,i=(a=this.row.attr("class").split(/\s+/)).length;e<i;e++)0===(t=a[e]).indexOf("ship-")&&this.row.removeClass(t);return this.remove_button.fadeIn("fast"),this.copy_button.fadeIn("fast"),!0===this.builder.show_points_destroyed&&this.points_destroyed_button.fadeIn("fast"),this.builder.container.trigger("xwing:shipUpdated")},t.prototype.setPilotById=function(t,e){var o,r,d,c,i=__iced_k_noop,u=iced.findDeferral(arguments);if(null==e&&(e=!1),!this.builder.isQuickbuild)return i(this.setPilot(exportObj.pilotsById[parseInt(t)],e));var h,p,n=i;t!==(p=this).quickbuildId?(p.wingmate_selector.parent().hide(),null!=p.wingmates&&0<p.wingmates.length&&p.setWingmates(0),p.quickbuildId=t,p.builder.current_squad.dirty=!0,p.resetPilot(),p.resetAddons(),h=function(){return p.row.removeClass("unsortable"),p.builder.container.trigger("xwing:pointsUpdated"),n(p.builder.container.trigger("xwing-backend:squadDirtinessChanged"))},null!=t&&-1<t?(r=exportObj.quickbuildsById[parseInt(t)],o=exportObj.pilots[r.pilot],p.data=exportObj.ships[r.ship],p.builder.isUpdatingPoints=!0,i=function(){var t,e,i,n,a,s,l;if(p.pilot=o,null!=p.pilot&&p.setupAddons(),p.copy_button.show(),p.setShipType(p.pilot.ship),null!=r.wingmate&&null==p.linkedShip)for(t=0,e=(i=p.builder.ships).length;t<e;t++)if((d=i[t]).quickbuildId===r.linkedId)return d.joinWing(p),p.linkedShip=d,p.primary=!1,p.builder.isUpdatingPoints=!1,p.builder.container.trigger("xwing:pointsUpdated"),void p.builder.container.trigger("xwing-backend:squadDirtinessChanged");n=function(){return p.primary=null==r.wingmate,null!=(null!=r?r.wingleader:void 0)&&(p.wingmate_selector.parent().show(),p.wingmate_selector.val(r.wingmates[0]),p.wingmate_selector.attr("min",r.wingmates[0]),p.wingmate_selector.attr("max",r.wingmates[r.wingmates.length-1]),p.setWingmates(r.wingmates[0])),p.builder.isUpdatingPoints=!1,h(p.builder.container.trigger("xwing:pointsUpdated"))},p.linkedShip?(a=n,null!=r.linkedId?(p.linkedShip.setPilotById(r.linkedId),a(null==r.wingmate?p.linkedShip.primary=!1:void 0)):(s=function(){return a(p.linkedShip=null)},0<(null!=(l=p.linkedShip.wingmates)?l.length:void 0)?s(p.linkedShip.removeFromWing(p)):(p.linkedShip.linkedShip=null,c=new iced.Deferrals(s,{parent:u,funcname:"Ship.setPilotById"}),p.builder.removeShip(p.linkedShip,c.defer({lineno:6211})),c._fulfill()))):n(null!=r.linkedId&&(p.linkedShip=p.builder.ships.slice(-1)[0],null!==p.linkedShip.data?p.linkedShip=p.builder.addShip():p.builder.addShip(),(p.linkedShip.linkedShip=p).linkedShip.setPilotById(r.linkedId),null==r.wingmate&&(p.linkedShip.primary=!1)))},null==(null!=o?o.unique:void 0)?i():(c=new iced.Deferrals(i,{parent:u,funcname:"Ship.setPilotById"}),p.builder.container.trigger("xwing:claimUnique",[o,"Pilot",c.defer({lineno:6178})]),c._fulfill())):h(p.copy_button.hide())):n()},t.prototype.addStandardizedUpgrades=function(){var t,e,i,n,a,s,l,o,r,d,c,u;if(!this.hasFixedUpgrades&&-1<(t=this.builder.standard_list.Ship.indexOf(null!=(r=this.data)?r.name:void 0))){for(e=(n=this.builder.standard_list.Upgrade[t]).restrictions||void 0,a=0,l=(d=this.upgrades).length;a<l;a++)if((null!=(c=(i=d[a]).data)?c.name:void 0)===n.name)return;for(s=0,o=(u=this.upgrades).length;s<o;s++)if(i=u[s],exportObj.slotsMatching(i.slot,this.builder.standard_list.Upgrade[t].slot)&&this.restriction_check(e,i)&&null==i.data)return void i.setData(n)}},t.prototype.addToStandardizedList=function(t){var e=this.builder.standard_list.Ship.indexOf(this.data.name);if(!(-1<e&&(null!=(e=this.builder.standard_list.Upgrade[e])?e.name:void 0)===t.name))return this.builder.standard_list.Upgrade.push(t),this.builder.standard_list.Ship.push(this.data.name)},t.prototype.removeStandardizedList=function(s){var l,o,t,e,i,n,a,r,d=this.builder.standard_list.Ship.indexOf(this.data.name);if(-1<d&&(null!=(i=this.builder.standard_list.Upgrade[d])?i.name:void 0)===s.name){for(this.builder.standard_list.Upgrade.splice(d,1),this.builder.standard_list.Ship.splice(d,1),r=[],t=0,e=(n=this.builder.ships).length;t<e;t++)(null!=(a=(l=n[t]).data)?a.name:void 0)===this.data.name&&l!==this?r.push(function(){for(var t,e=l.upgrades,i=[],n=0,a=e.length;n<a;n++){if((null!=(t=(o=e[n]).data)?t.name:void 0)===s.name){o.setData(null);break}i.push(void 0)}return i}()):r.push(void 0);return r}},t.prototype.checkStandardizedList=function(t){var e,t=this.builder.standard_list.Ship.indexOf(t);if(-1<t&&null!=(null!=(e=this.builder.standard_list.Upgrade[t])?e.name:void 0))return this.builder.standard_list.Upgrade[t]},t.prototype.setPilot=function(m,y){var w,q,_,O,S,b,g,$,v,x,j,t,n,a,s,l=__iced_k_noop,o=iced.findDeferral(arguments);if(null==y&&(y=!1),m===this.pilot)return l();if(this.builder.current_squad.dirty=!0,g=null!=this.pilot&&(null!=m?m.ship:void 0)===this.pilot.ship,b={},g&&null==this.pilot.upgrades)for(t=0,n=(s=this.upgrades).length;t<n;t++)null!=(null!=(x=s[t])?x.data:void 0)&&(null==b[a=x.slot]&&(b[a]=[]),b[x.slot].push(x.data.id));this.resetPilot(),this.resetAddons();i=k=this;var e,i,k,T=function(){return i.row.removeClass("unsortable"),i.builder.container.trigger("xwing:pointsUpdated"),l(i.builder.container.trigger("xwing-backend:squadDirtinessChanged"))};null!=m?(k.data=exportObj.ships[null!=m?m.ship:void 0],e=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p,f;if(k.pilot=m,null!=k.pilot&&k.setupAddons(),k.copy_button.show(),k.setShipType(k.pilot.ship),(null!=k.pilot.autoequip||null!=exportObj.ships[k.pilot.ship].autoequip&&!g)&&!y)for(t=0,n=(q=(null!=(d=k.pilot.autoequip)?d:[]).concat(null!=(d=exportObj.ships[k.pilot.ship].autoequip)?d:[])).length;t<n;t++)for(j=q[t],w=exportObj.upgrades[j],e=0,a=(c=k.upgrades).length;e<a;e++)x=c[e],exportObj.slotsMatching(x.slot,w.slot)&&x.setData(w);if(g&&null==k.pilot.upgrades){for(i=1;i<=2;++i){for(_={},o=0,s=(u=k.upgrades).length;o<s;o++)x=u[o],null!=(S=(null!=(h=b[x.slot])?h:[]).shift())&&(x.setById(S),x.lastSetValid||(_[S]=x));for(O in _)(x=_[O]).setById(O)}for(v=k.checkStandardizedList(k.pilot.ship),$=!1,r=0,l=(p=k.upgrades).length;r<l;r++)x=p[r],null!=v&&null!=(null!=x&&null!=(f=x.data)?f.name:void 0)&&x.data.name===v.name&&($=!0);null!=v&&!1===$&&k.removeStandardizedList(v)}return T()},null==(null!=m?m.unique:void 0)?e():(e=new iced.Deferrals(e,{parent:o,funcname:"Ship.setPilot"}),k.builder.container.trigger("xwing:claimUnique",[m,"Pilot",e.defer({lineno:6312})]),e._fulfill())):T(k.copy_button.hide())},t.prototype.resetPilot=function(){__iced_k_noop;var t,e,i,n=iced.findDeferral(arguments),a=(t=e=this,function(){return t.pilot=null});null!=(null!=(i=e.pilot)?i.unique:void 0)?(i=new iced.Deferrals(a,{parent:n,funcname:"Ship.resetPilot"}),e.builder.container.trigger("xwing:releaseUnique",[e.pilot,"Pilot",i.defer({lineno:6357})]),i._fulfill()):a()},t.prototype.setupAddons=function(){var c,t,e,i,n,a,s,u,h,p,f,m,l,_,o,r,d;if(this.builder.isQuickbuild){for(d=[],s=0,p=(_=null!=(l=exportObj.quickbuildsById[this.quickbuildId].upgrades)?l:[]).length;s<p;s++)i=_[s],null!=(e=exportObj.upgrades[i])?((t=new exportObj.QuickbuildUpgrade({ship:this,container:this.addon_container,slot:e.slot,upgrade:e})).setData(e),d.push(this.upgrades.push(t))):console.log("Unknown Upgrade: "+i);return d}if(null!=this.pilot.upgrades){for(this.hasFixedUpgrades=!0,o=[],n=0,u=(f=null!=(l=this.pilot.upgrades)?l:[]).length;n<u;n++)i=f[n],null!=(e=exportObj.upgrades[i])?((t=new exportObj.QuickbuildUpgrade({ship:this,container:this.addon_container,slot:e.slot,upgrade:e})).setData(e),o.push(this.upgrades.push(t))):console.log("Unknown Upgrade: "+i);return o}for(this.hasFixedUpgrades=!1,r=[],a=0,h=(m=null!=(l=this.pilot.slots)?l:[]).length;a<h;a++)c=m[a],r.push(this.upgrades.push(new exportObj.Upgrade({ship:this,container:this.addon_container,slot:c})));return r},t.prototype.resetAddons=function(){__iced_k_noop;var t,e,i,n,a,s,l,o=iced.findDeferral(arguments),r=(s=l=this,function(){return s.upgrades=[]});for(e=new iced.Deferrals(r,{parent:o,funcname:"Ship.resetAddons"}),i=0,n=(a=l.upgrades).length;i<n;i++)null!=(t=a[i])&&t.destroy(e.defer({lineno:6401}));e._fulfill()},t.prototype.getPoints=function(){var t,e,i;return this.builder.isQuickbuild?(e=exportObj.quickbuildsById[this.quickbuildId],i=this.primary&&null!=(i=null!=e?e.threat:void 0)?i:0,null!=(null!=e?e.wingleader:void 0)&&(i=e.threat[e.wingmates.indexOf(this.wingmates.length)]),this.points_container.find("span").text(i),0<i?this.points_container.fadeTo("fast",1):this.points_container.fadeTo(0,0),i):(i=null!=this.pilot?(t=null!=(e=this.effectiveStats())?e.points:void 0,null!=e?e.loadout:void 0):(t=null!=(e=null!=(i=this.pilot)?i.points:void 0)?e:0,null!=(e=null!=(i=this.pilot)?i.loadout:void 0)?e:0),this.points_container.find("div").text(""+t),this.points_container.find(".upgrade-points").text(null!=(null!=(e=this.pilot)?e.loadout:void 0)&&0<this.pilot.loadout?"("+this.upgrade_points_total+"/"+i+")":""),0<t?this.points_container.fadeTo("fast",1):this.points_container.fadeTo(0,0),t)},t.prototype.setWingmates=function(n){__iced_k_noop;var a,t,e,s,d=iced.findDeferral(arguments);if((null!=(o=this.wingmates)?o.length:void 0)!==n){for(null!=this.wingmates&&0!==this.wingmates.length||(this.wingmates=[]),e=exportObj.quickbuildsById[this.quickbuildId];this.wingmates.length<n;)null!==(t=this.builder.ships.slice(-1)[0]).data?t=this.builder.addShip():this.builder.addShip(),(t.linkedShip=this).wingmates.push(t),t.setPilotById(e.wingmateId),t.primary=!1,this.primary=!0;i=l=this;var i,l,o=function(){return i.wingmate_selector.val(n)},r=function(t){var e=t,i=function(){return iced.trampoline(function(){return r(t)})};if(!(l.wingmates.length>n))return e();(a=l.wingmates.pop()).linkedShip=null,s=new iced.Deferrals(i,{parent:d,funcname:"Ship.setWingmates"}),l.builder.removeShip(a,s.defer({lineno:6463})),s._fulfill()};r(o)}},t.prototype.removeFromWing=function(t){var e;return this.wingmates.removeItem(t),t=exportObj.quickbuildsById[this.quickbuildId],e=this.wingmates.length,0<=__indexOf.call(t.wingmates,e)||this.destroy($.noop),this.wingmate_selector.val(this.wingmates.length)},t.prototype.joinWing=function(t){var e,i;return this.wingmates.push(t),e=exportObj.quickbuildsById[this.quickbuildId],i=this.wingmates.length,0<=__indexOf.call(e.wingmates,i)||(t.destroy($.noop),this.removeFromWing(t)),this.wingmate_selector.val(this.wingmates.length)},t.prototype.updateSelections=function(){var t,e,i,n,a,s,l;if(null==this.pilot)return this.pilot_selector.select2("data",null);for(this.ship_selector.select2("data",{id:this.pilot.ship,text:exportObj.ships[this.pilot.ship].display_name||this.pilot.ship,chassis:exportObj.ships[this.pilot.ship].chassis||"",xws:exportObj.ships[this.pilot.ship].name.canonicalize(),icon:exportObj.ships[this.pilot.ship].icon||exportObj.ships[this.pilot.ship].name.canonicalize()}),this.pilot_selector.select2("data",{id:this.pilot.id,text:(null!=(null!=(a=exportObj.settings)?a.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?this.pilot.skill+" - ":"")+(this.pilot.display_name||this.pilot.name)+(-1!==this.quickbuildId?exportObj.quickbuildsById[this.quickbuildId].suffix:"")+" ("+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+(-1!==this.quickbuildId||null==this.pilot.loadout?"":"/"+this.pilot.loadout)+")",chassis:null!=this.pilot.chassis?this.pilot.chassis:""}),this.pilot_selector.data("select2").container.show(),l=[],i=0,n=(s=this.upgrades).length;i<n;i++)t=(e=s[i]).getPoints(),l.push(e.updateSelection(t));return l},t.prototype.checkPilotSelectorQueryModal=function(){return 768<=$(window).width()?this.pilot_query_modal.hide():this.pilot?this.pilot_query_modal.show():void 0},t.prototype.setupUI=function(){var t,e,i,n,u,h,p,f,a,s,l,o,r,d,m,_,c;return this.row=$(document.createElement("DIV")),this.row.addClass("row ship mb-5 mb-sm-0 unsortable"),this.row.insertBefore(this.builder.notes_container),this.row.append($.trim('<div class="col-md-3">\n    <div class="form-group d-flex">\n        <input class="ship-selector-container" type="hidden"></input>\n        <div class="d-block d-md-none input-group-append">\n            <button class="btn btn-secondary ship-query-modal"><i class="fas fa-question"></i></button>\n        </div>\n    <br />\n    </div>\n    <div class="form-group d-flex">\n        <input type="hidden" class="pilot-selector-container"></input>\n        <div class="d-block d-md-none input-group-append">\n            <button class="btn btn-secondary pilot-query-modal"><i class="fas fa-question"></i></button>\n        <br />\n        </div>\n    </div>\n    <label class="wingmate-label">\n    '+this.uitranslation("Wingmates")+': \n        <input type="number" class="wingmate-selector"></input>\n    </label>\n</div>\n<div class="col-md-1 points-display-container">\n     <div></div>\n     <div class="upgrade-points"></div>\n</div>\n<div class="col-md-6 addon-container">  </div>\n<div class="col-md-2 button-container">\n    <button class="btn btn-danger remove-pilot side-button"><span class="d-none d-sm-block" data-toggle="tooltip" title="'+this.uitranslation("Remove Pilot")+'"><i class="fa fa-times"></i></span><span class="d-block d-sm-none"> '+this.uitranslation("Remove Pilot")+'</span></button>\n    <button class="btn btn-light copy-pilot side-button"><span class="d-none d-sm-block" data-toggle="tooltip" title="'+this.uitranslation("Clone Pilot")+'"><i class="far fa-copy"></i></span><span class="d-block d-sm-none"> '+this.uitranslation("Clone Pilot")+'</span></button>\n    <button class="btn btn-light points-destroyed side-button" points-state"><span class="d-none d-sm-block destroyed-type" data-toggle="tooltip" title="'+this.uitranslation("Points Destroyed")+'"><i class="fas fa-circle"></i></i></span><span class="d-block d-sm-none destroyed-type-mobile"> '+this.uitranslation("Undamaged")+"</span></button>\n</div>")),this.row.find(".button-container span").tooltip(),this.ship_selector=$(this.row.find("input.ship-selector-container")),this.pilot_selector=$(this.row.find("input.pilot-selector-container")),this.wingmate_selector=$(this.row.find("input.wingmate-selector")),this.ship_query_modal=$(this.row.find("button.ship-query-modal")),this.pilot_query_modal=$(this.row.find("button.pilot-query-modal")),this.ship_query_modal.click((e=this,function(t){if(e.pilot)return e.builder.showTooltip("Ship",exportObj.ships[e.pilot.ship],null,e.builder.mobile_tooltip_modal,!0),e.builder.mobile_tooltip_modal.modal("show")})),this.pilot_query_modal.click((i=this,function(t){if(i.pilot)return i.builder.showTooltip("Pilot",i.pilot,i.pilot?i:void 0,i.builder.mobile_tooltip_modal,!0),i.builder.mobile_tooltip_modal.modal("show")})),t=function(t,e,i){return'<i class="xwing-miniatures-ship xwing-miniatures-ship-'+t.icon+'"></i> '+t.text},this.ship_selector.select2({width:"100%",placeholder:exportObj.translate("ui","shipSelectorPlaceholder"),query:(u=this,function(t){var e={results:[]};return e.results=u.builder.getAvailableShipsMatching(t.term),t.callback(e)}),minimumResultsForSearch:$.isMobile()?-1:0,formatResultCssClass:(n=this,function(t){var e;return null!=n.builder.collection&&"true"===n.builder.collection.checks.collectioncheck?(e=!1,null!=n.pilot&&t.id===exportObj.ships[n.pilot.ship].id?n.builder.collection.checkShelf("ship",t.name)||n.builder.collection.checkTable("pilot",t.name)||(e=!0):e=!n.builder.collection.checkShelf("ship",t.name),e?"select2-result-not-in-collection":""):""}),formatResult:t,formatSelection:t}),this.ship_selector.on("select2-focus",function(t){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.ship_selector.on("change",(h=this,function(t){return h.setShipType(h.ship_selector.val())})),this.ship_selector.data("select2").results.on("mousemove-filtered",(p=this,function(t){t=$(t.target).closest(".select2-result").data("select2-data");if(null!=(null!=t?t.id:void 0))return p.builder.showTooltip("Ship",exportObj.ships[t.id])})),this.ship_selector.data("select2").container.on("mouseover",(f=this,function(t){if(f.pilot)return f.builder.showTooltip("Ship",exportObj.ships[f.pilot.ship])})),this.pilot_selector.select2({width:"100%",placeholder:exportObj.translate("ui","pilotSelectorPlaceholder"),query:(s=this,function(t){var e={results:[]};return e.results=s.builder.getAvailablePilotsForShipIncluding(s.ship_selector.val(),s.builder.isQuickbuild?s.quickbuildId:s.pilot,t.term,!0,s),t.callback(e)}),minimumResultsForSearch:$.isMobile()?-1:0,formatResultCssClass:(a=this,function(t){var e,i,n;return null!=a.builder.collection&&"true"===a.builder.collection.checks.collectioncheck?(i=!1,e="",e=a.builder.isQuickbuild?null!=(n=null!=(n=exportObj.quickbuildsById[t.id])?n.pilot:void 0)?n:"unknown pilot":t.name,t.id===(null!=(n=a.pilot)?n.id:void 0)?a.builder.collection.checkShelf("pilot",e)||a.builder.collection.checkTable("pilot",e)||(i=!0):i=!a.builder.collection.checkShelf("pilot",e),i?"select2-result-not-in-collection":""):""})}),this.pilot_selector.on("select2-focus",function(t){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.pilot_selector.on("change",(l=this,function(t){return l.setPilotById(l.pilot_selector.select2("val")),l.builder.current_squad.dirty=!0,l.builder.container.trigger("xwing-backend:squadDirtinessChanged"),l.builder.backend_status.fadeOut("slow")})),this.pilot_selector.data("select2").results.on("mousemove-filtered",(o=this,function(t){var e,t=$(t.target).closest(".select2-result").data("select2-data");if(o.builder.isQuickbuild){if(null!=(null!=t?t.id:void 0))return o.builder.showTooltip("Quickbuild",exportObj.quickbuildsById[t.id],{ship:null!=(e=o.data)?e.name:void 0})}else if(null!=(null!=t?t.id:void 0))return o.builder.showTooltip("Pilot",exportObj.pilotsById[t.id])})),this.pilot_selector.data("select2").container.on("mouseover",(r=this,function(t){if(r.pilot)return r.builder.showTooltip("Pilot",r.pilot,r)})),this.pilot_selector.data("select2").container.hide(),this.builder.isQuickbuild&&(this.wingmate_selector.on("change",(d=this,function(t){return d.setWingmates(parseInt(d.wingmate_selector.val())),d.builder.current_squad.dirty=!0,d.builder.container.trigger("xwing-backend:squadDirtinessChanged"),d.builder.backend_status.fadeOut("slow")})),this.wingmate_selector.on("mousemove-filtered",function(t){})),this.wingmate_selector.parent().hide(),this.points_container=$(this.row.find(".points-display-container")),this.points_container.fadeTo(0,0),this.addon_container=$(this.row.find("div.addon-container")),this.remove_button=$(this.row.find("button.remove-pilot")),this.remove_button.click((m=this,function(t){return t.preventDefault(),m.row.slideUp("fast",function(){var t;return m.builder.removeShip(m),null!=(t=m.backend_status)?t.fadeOut("slow"):void 0})})),this.remove_button.hide(),this.copy_button=$(this.row.find("button.copy-pilot")),this.copy_button.click((_=this,function(t){for(var e,i=_.builder.ships,n=[],a=0,s=i.length;a<s;a++){if((e=i[a]).row.hasClass("unsortable")){e.copyFrom(_);break}n.push(void 0)}return n})),this.copy_button.hide(),this.checkPilotSelectorQueryModal(),this.points_destroyed_button_span=$(this.row.find(".destroyed-type")),this.points_destroyed_button_span_mobile=$(this.row.find(".destroyed-type-mobile")),this.points_destroyed_button=$(this.row.find("button.points-destroyed")),this.points_destroyed_button.click((c=this,function(t){switch(c.destroystate){case 0:c.destroystate++,c.points_destroyed_button.addClass("btn-warning"),c.points_destroyed_button.removeClass("btn-light"),c.points_destroyed_button_span_mobile.text(c.uitranslation("Half Damaged")),c.points_destroyed_button_span.html('<i class="fas fa-adjust"></i>');break;case 1:c.destroystate++,c.points_destroyed_button.addClass("btn-danger"),c.points_destroyed_button.removeClass("btn-warning"),c.points_destroyed_button_span_mobile.text(c.uitranslation("Fully Destroyed")),c.points_destroyed_button_span.html('<i class="far fa-circle"></i>');break;case 2:c.destroystate=0,c.points_destroyed_button.addClass("btn-light"),c.points_destroyed_button.removeClass("btn-danger"),c.points_destroyed_button_span_mobile.text(c.uitranslation("Undamaged")),c.points_destroyed_button_span.html('<i class="fas fa-circle"></i>')}return c.builder.onPointsUpdated()})),this.points_destroyed_button.hide()},t.prototype.teardownUI=function(){return this.row.text(""),this.row.remove()},t.prototype.toString=function(){return null!=this.pilot?this.uitranslation("PilotFlyingShip",this.pilot.display_name||this.pilot.name,this.data.display_name||this.data.name):this.data.display_name||this.data.name},t.prototype.toHTML=function(){var t,e,c,u,h,p,f,m,_,b,g,v,i,n,a,s=this.effectiveStats(),x=this.builder.formatActions(s.actions,"&nbsp;&nbsp;",null!=(x=this.pilot.keyword)?x:[]),l=null!=(l=this.data.attack_icon)?l:"xwing-miniatures-font-frontarc",k=null!=this.pilot.engagement?$.trim('<span class="info-data info-skill">ENG '+this.pilot.engagement+"</span>"):"",l=null!=s.attack?$.trim('<i class="xwing-miniatures-font header-attack '+l+'"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(l=null!=(l=this.pilot.ship_override)?l.attack:void 0)?l:this.data.attack,s,"attack")+"</span>"):"",o=null!=s.attackbull?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-bullseyearc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(o=null!=(o=this.pilot.ship_override)?o.attackbull:void 0)?o:this.data.attackbull,s,"attackbull")+"</span>"):"",y=null!=s.attackb?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-reararc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(y=null!=(y=this.pilot.ship_override)?y.attackb:void 0)?y:this.data.attackb,s,"attackb")+"</span>"):"",w=null!=s.attackf?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-fullfrontarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(w=null!=(w=this.pilot.ship_override)?w.attackf:void 0)?w:this.data.attackf,s,"attackf")+"</span>"):"",q=null!=s.attackt?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-singleturretarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(q=null!=(q=this.pilot.ship_override)?q.attackt:void 0)?q:this.data.attackt,s,"attackt")+"</span>"):"",r=null!=s.attackl?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-leftarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(r=null!=(r=this.pilot.ship_override)?r.attackl:void 0)?r:this.data.attackl,s,"attackl")+"</span>"):"",O=null!=s.attackr?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-rightarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(O=null!=(O=this.pilot.ship_override)?O.attackr:void 0)?O:this.data.attackr,s,"attackr")+"</span>"):"",S=null!=s.attackdt?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-doubleturretarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(S=null!=(S=this.pilot.ship_override)?S.attackdt:void 0)?S:this.data.attackdt,s,"attackdt")+"</span>"):"",d="";if(null!=this.data.energyrecurr)for(t=0;t<this.data.energyrecurr;)d+='<sup><i class="fas fa-caret-up"></i></sup>',++t;if(i=null!=(null!=(i=this.pilot.ship_override)?i.energy:void 0)||null!=this.data.energy?$.trim('<i class="xwing-miniatures-font header-energy xwing-miniatures-font-energy"></i>\n<span class="info-data info-energy">'+statAndEffectiveStat(null!=(i=null!=(i=this.pilot.ship_override)?i.energy:void 0)?i:this.data.energy,s,"energy")+d+"</span>"):"",null!=s.force)if(d="",null!=s.forcerecurring)for(t=0;t<s.forcerecurring;)d+='<sup><i class="fas fa-caret-up"></i></sup>',++t;else d+='<sup><i class="fas fa-caret-up"></i></sup>';if(n=null!=s.force&&0<s.force?$.trim('<i class="xwing-miniatures-font header-force xwing-miniatures-font-forcecharge"></i>\n<span class="info-data info-force">'+statAndEffectiveStat(null!=(n=null!=(n=null!=(n=this.pilot.ship_override)?n.force:void 0)?n:this.pilot.force)?n:0,s,"force")+d+"</span>"):"",null!=this.pilot.charge){if(d="",null!=this.pilot.recurring)if(0<this.pilot.recurring)for(t=0;t<this.pilot.recurring;)d+='<sup><i class="fas fa-caret-up"></i></sup>',++t;else for(t=this.pilot.recurring;t<0;)d+='<sub><i class="fas fa-caret-down"></i></sub>',++t;a=$.trim('<i class="xwing-miniatures-font header-charge xwing-miniatures-font-charge"></i><span class="info-data info-charge">'+statAndEffectiveStat(null!=(a=null!=(a=this.pilot.ship_override)?a.charge:void 0)?a:this.pilot.charge,s,"charge")+d+"</span>")}else a="";if(p="",null!=this.data.shieldrecurr)for(t=0;t<this.data.shieldrecurr;)p+='<sup><i class="fas fa-caret-up"></i></sup>',++t;if(h="",s.shields){for(_=s.shields;2<=_;_+=-1)h+='<i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield expanded-hull-or-shield"></i>';h+='<i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield"></i>'}if(c="",s.hull){for(b=s.hull;2<=b;b+=-1)c+='<i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull expanded-hull-or-shield"></i>';c+='<i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull"></i>'}if(e=$.trim('<div class="fancy-pilot-header">\n    <div class="pilot-header-text">'+(this.pilot.display_name||this.pilot.name)+' <i class="xwing-miniatures-ship xwing-miniatures-ship-'+this.data.name.canonicalize()+'"></i><span class="fancy-ship-type"> '+(this.data.display_name||this.data.name)+'</span></div>\n    <div class="mask">\n        <div class="outer-circle">\n            <div class="inner-circle pilot-points">'+(-1!==this.quickbuildId?this.primary?this.getPoints():"*":this.pilot.points)+'</div>\n        </div>\n    </div>\n</div>\n<div class="fancy-pilot-stats">\n    <div class="pilot-stats-content">\n        <span class="info-data info-skill">INI '+statAndEffectiveStat(this.pilot.skill,s,"skill")+"</span>\n        "+k+"\n        "+o+"\n        "+l+"\n        "+y+"\n        "+w+"\n        "+q+"\n        "+r+"\n        "+O+"\n        "+S+'\n        <i class="xwing-miniatures-font header-agility xwing-miniatures-font-agility"></i>\n        <span class="info-data info-agility">'+statAndEffectiveStat(null!=(o=null!=(k=this.pilot.ship_override)?k.agility:void 0)?o:this.data.agility,s,"agility")+"</span>                    \n        "+c+'\n        <span class="info-data info-hull">'+statAndEffectiveStat(null!=(y=null!=(l=this.pilot.ship_override)?l.hull:void 0)?y:this.data.hull,s,"hull")+"</span>\n        "+h+'\n        <span class="info-data info-shields">'+statAndEffectiveStat(null!=(q=null!=(w=this.pilot.ship_override)?w.shields:void 0)?q:this.data.shields,s,"shields")+p+"</span>\n        "+i+"\n        "+n+"\n        "+a+"\n        <br />\n        "+x+"\n    </div>\n</div>"),this.pilot.text&&(e+=$.trim('<div class="fancy-pilot-text">'+this.pilot.text+"</div>")),""!==(r=null!=(null!=s?s.chassis:void 0)&&""!==s.chassis?s.chassis:null!=this.data.chassis?this.data.chassis:"")&&(e+=$.trim('<div class="fancy-pilot-chassis"><strong>'+(null!=(S=null!=(O=exportObj.chassis[r])?O.display_name:void 0)?S:r)+":</strong> "+exportObj.chassis[r].text+"</div>")),0<(f=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(m=t[i]).data&&e.push(m);return e}.call(this)).length){for(e+=$.trim('<div class="fancy-upgrade-container">'),g=0,v=f.length;g<v;g++)u=(m=f[g]).getPoints(),e+=m.toHTML(u);e+=$.trim("</div>")}return k=Math.floor(this.getPoints()/2),o=Math.floor((s.hull+s.shields)/2),'<div class="fancy-ship">'+(e+=$.trim('<div class="ship-points-total">\n    <strong>'+this.uitranslation("Ship Cost")+": "+this.getPoints()+", "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+"), "+this.uitranslation("Half Points")+": "+k+", "+this.uitranslation("Damage Threshold")+": "+o+"</strong> \n</div>"))+"</div>"},t.prototype.toTableRow=function(){var t,e,i,a,n,s,l=$.trim('<tr class="simple-pilot">\n    <td class="name">'+(this.pilot.display_name||this.pilot.name)+" &mdash; "+(this.data.display_name||this.data.name)+'</td>\n    <td class="points">'+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+"</td>\n</tr>"),o=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<o.length)for(n=0,s=o.length;n<s;n++)e=(a=o[n]).getPoints(),l+=a.toTableRow(e);return l+='<tr class="simple-ship-total"><td colspan="2">'+this.uitranslation("Ship Cost")+": "+this.getPoints()+"</td></tr>",t=Math.floor(this.getPoints()/2),i=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),l=l+('<tr class="simple-ship-half-points"><td colspan="2">'+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+") "+this.uitranslation("Half Points")+": "+t+" "+this.uitranslation("Damage Threshold")+": "+i+"</td></tr>")+"<tr><td>&nbsp;</td><td></td></tr>"},t.prototype.toSimpleCopy=function(){var t,e,i,a,n,s,l,o=this.pilot.name+" ("+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+")    \n",r=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<r.length){for(o+="    ",e=[],s=0,l=r.length;s<l;s++)n=(a=r[s]).getPoints(),null!=(n=a.toSimpleCopy(n))&&e.push(n);o=o+e.join("    ")+"    \n"}return t=Math.floor(this.getPoints()/2),i=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),o+=this.uitranslation("Ship Cost")+": "+this.getPoints()+"  "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+")  "+this.uitranslation("Half Points")+": "+t+"  "+this.uitranslation("Damage Threshold")+": "+i+"    \n    \n"},t.prototype.toRedditText=function(){var t,e,i,a,n,s,l,o="**"+this.pilot.name+" ("+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+")**    \n",r=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<r.length){for(t=Math.floor(this.getPoints()/2),i=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),o+="    ",e=[],s=0,l=r.length;s<l;s++)n=(a=r[s]).getPoints(),null!=(n=a.toRedditText(n))&&e.push(n);o=(o+=e.join("    "))+("&nbsp;*"+this.uitranslation("Ship Cost")+": "+this.getPoints()+"  "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+")  "+this.uitranslation("Half Points")+": "+t+"  "+this.uitranslation("Damage Threshold")+": "+i+"*    \n")}return o},t.prototype.toTTSText=function(){var a,t,e,i,n=""+exportObj.toTTS(this.pilot.name),s=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<s.length&&null==this.pilot.upgrades)for(e=0,i=s.length;e<i;e++)null!=(t=(a=s[e]).toTTSText())&&(n+=" + "+t);return n+" / "},t.prototype.toSerialized=function(){var l,o,t;return this.builder.isQuickbuild?null==this.wingmates||0===this.wingmates.length?this.quickbuildId+"X":this.quickbuildId+"X"+this.wingmates.length:(t=(""+function(){var t,e,i,n,a=this.upgrades,s=[];for(l=t=0,e=a.length;t<e;l=++t)o=a[l],s.push(null!=(i=null!=o&&null!=(n=o.data)?n.id:void 0)?i:"");return s}.call(this)).replace(/,/g,"W"),[this.pilot.id,t].join("X"))},t.prototype.fromSerialized=function(c,u){var t,h,e,i,n,a,s,l,o,r,p,f,d,m,_,b,g,v=!0;switch(c){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:console.log("Incorrect Version!"),this.old_version_container.toggleClass("d-none",!1);break;case 9:if(h=(d=u.split("X"))[0],n=d[1],d[2],n=n.split("W"),this.setPilotById(parseInt(h),!0),!this.validate)return!1;if(this.builder.isQuickbuild)0<n.length&&0<this.wingmates.length&&this.setWingmates(n[0]);else for(s=1;s<3;++s)t:for(t=l=m=n.length-1;m<=-1?l<-1:-1<l;t=m<=-1?++l:--l)if(i=n[t],null!=(e=exportObj.upgradesById[i])){for(o=0,p=(_=this.upgrades).length;o<p;o++)if((null!=(a=_[o])&&null!=(b=a.data)?b.name:void 0)===e.name){n.splice(t,1);continue t}for(r=0,f=(g=this.upgrades).length;r<f;r++)if(a=g[r],exportObj.slotsMatching(e.slot,a.slot)&&!a.isOccupied()){a.setById(i),a.lastSetValid&&n.splice(t,1);break}}else n.splice(t,1),""!==i&&(console.log("Unknown upgrade id "+i+" could not be added. Please report that error"),v=!1);v&=0===n.length}return this.updateSelections(),v},t.prototype.effectiveStats=function(){for(var t,e,i,n,a,s,c,u,h,p,f,m,l,o={attack:null!=(l=null!=(l=this.pilot.ship_override)?l.attack:void 0)?l:this.data.attack,attackf:null!=(l=null!=(l=this.pilot.ship_override)?l.attackf:void 0)?l:this.data.attackf,attackbull:null!=(l=null!=(l=this.pilot.ship_override)?l.attackbull:void 0)?l:this.data.attackbull,attackb:null!=(l=null!=(l=this.pilot.ship_override)?l.attackb:void 0)?l:this.data.attackb,attackt:null!=(l=null!=(l=this.pilot.ship_override)?l.attackt:void 0)?l:this.data.attackt,attackl:null!=(l=null!=(l=this.pilot.ship_override)?l.attackl:void 0)?l:this.data.attackl,attackr:null!=(l=null!=(l=this.pilot.ship_override)?l.attackr:void 0)?l:this.data.attackr,attackdt:null!=(l=null!=(l=this.pilot.ship_override)?l.attackdt:void 0)?l:this.data.attackdt,energy:null!=(l=null!=(l=this.pilot.ship_override)?l.energy:void 0)?l:this.data.energy,agility:null!=(l=null!=(l=this.pilot.ship_override)?l.agility:void 0)?l:this.data.agility,hull:null!=(l=null!=(l=this.pilot.ship_override)?l.hull:void 0)?l:this.data.hull,shields:null!=(l=null!=(l=this.pilot.ship_override)?l.shields:void 0)?l:this.data.shields,force:null!=(l=null!=(l=null!=(l=this.pilot.ship_override)?l.force:void 0)?l:this.pilot.force)?l:0,forcerecurring:null!=(l=this.pilot.forcerecurring)?l:1,charge:null!=(l=null!=(l=this.pilot.ship_override)?l.charge:void 0)?l:this.pilot.charge,actions:(null!=(l=null!=(l=this.pilot.ship_override)?l.actions:void 0)?l:this.data.actions).slice(0),chassis:null!=(l=null!=(l=this.pilot.chassis)?l:this.data.chassis)?l:"",points:null!=(l=this.pilot.points)?l:0,loadout:null!=(l=this.pilot.loadout)?l:0,skill:null!=(l=this.pilot.skill)?l:0,maneuvers:[]},r=n=0,d=(null!=(l=this.data.maneuvers)?l:[]).length;0<=d?n<d:d<n;r=0<=d?++n:--n)o.maneuvers[r]=this.data.maneuvers[r].slice(0);if(null!=this.pilot.keyword&&0<=__indexOf.call(this.pilot.keyword,"Droid")&&null!=o.actions){for(t=[],a=0,c=(h=o.actions).length;a<c;a++)e=h[a],t.push(e.replace("Focus","Calculate"));o.actions=t}for(s=0,u=(p=this.upgrades).length;s<u;s++)null!=(null!=(i=p[s])&&null!=(f=i.data)?f.chassis:void 0)&&(o.chassis=i.data.chassis),null!=(null!=i&&null!=(m=i.data)?m.modifier_func:void 0)&&i.data.modifier_func(o);return null!=(null!=(l=this.pilot)?l.modifier_func:void 0)&&this.pilot.modifier_func(o),null!=exportObj.chassis[o.chassis]&&null!=exportObj.chassis[o.chassis].modifier_func&&exportObj.chassis[o.chassis].modifier_func(o),o},t.prototype.validate=function(){var t,e,i,c,u,n,h,a,s,p,l,f,m,_,b,g,v,o,r,x,d,k,y;if(null==this.pilot)return!0;if(u=!0,this.builder.isEpic){if(null!=this.pilot.slots&&!(0<=__indexOf.call(this.pilot.slots,"Command"))){for(t=!0,a=0,f=(_=this.upgrades).length;a<f;a++)"Command"===(n=_[a]).slot&&this===n.ship&&(t=!1);!0===t&&this.upgrades.push(new exportObj.Upgrade({ship:this,container:this.addon_container,slot:"Command"}))}}else if(!this.builder.isQuickbuild)for(i=s=b=this.upgrades.length-1;b<=-1?s<-1:-1<s;i=b<=-1?++s:--s)"Command"===(n=this.upgrades[i]).slot&&(n.destroy($.noop),this.upgrades.splice(i,1));for(i=p=0;p<32;i=++p){if(h=!0,r=null!=(r=null!=(r=null!=(r=this.pilot)?r.validation_func:void 0)?r:null!=(r=this.pilot)?r.restriction_func:void 0)?r:void 0,c=null!=this.pilot.upgrades,null!=r&&!r(this,this.pilot)||!this.builder.isItemAvailable(this.pilot,!0))return this.builder.removeShip(this),!1;for(e=[],l=this.upgrade_points_total=0,m=(x=this.upgrades).length;l<m;l++){if(n=x[l],o=!0,c||(null!=(null!=(d=null!=n&&null!=(k=n.data)?k.validation_func:void 0)?d:void 0)&&(o=o&&(null!=n&&null!=(y=n.data)?y.validation_func(this,n):void 0)),d=null!=(d=null!=n&&null!=(g=n.data)?g.restrictions:void 0)?d:void 0,o=o&&this.restriction_check(d,n,n.getPoints(),this.upgrade_points_total)),(!o||null!=(null!=n?n.data:void 0)&&(d=n.data,0<=__indexOf.call(e,d)||null!=n.data.faction&&!this.builder.isOurFaction(n.data.faction,this.pilot.faction)||!this.builder.isItemAvailable(n.data)))&&!c&&!this.builder.isQuickbuild){console.log("Invalid upgrade: "+(null!=n&&null!=(v=n.data)?v.name:void 0)+", check "+(null!=(o=this.pilot)?o.upgrades:void 0)+" on pilot "+(null!=(o=this.pilot)?o.name:void 0)),n.setById(null),u=h=!1;break}null!=(null!=n?n.data:void 0)&&n.data&&e.push(null!=n?n.data:void 0),this.upgrade_points_total+=n.getPoints()}if(h)break}return this.updateSelections(),u},t.prototype.checkUnreleasedContent=function(){var t,e,i,n;if(null!=this.pilot&&!exportObj.isReleased(this.pilot))return!0;for(e=0,i=(n=this.upgrades).length;e<i;e++)if(null!=(null!=(t=n[e])?t.data:void 0)&&!exportObj.isReleased(t.data)&&null==t.data.standard)return!0;return!1},t.prototype.hasAnotherUnoccupiedSlotLike=function(t,e){for(var i,n=this.upgrades,a=0,s=n.length;a<s;a++)if((i=n[a])!==t&&exportObj.slotsMatching(i.slot,e)&&"HardpointShip"!==i.slot&&"VersatileShip"!==i.slot&&!i.isOccupied())return!0;return!1},t.prototype.hasFilledSlotLike=function(t,e){for(var i,n=this.upgrades,a=0,s=n.length;a<s;a++)if((i=n[a])!==t&&exportObj.slotsMatching(i.slot,e)&&i.isOccupied())return!0;return!1},t.prototype.restriction_check=function(t,e,c,u,h){var p,i,f,n,a,s,m,l,o,r,_,b,g,v,d;if(null==c&&(c=0),null==u&&(u=0),null==h&&(h=void 0),a=this.effectiveStats(),null!=this.pilot.loadout&&(0<a.loadout?a:this.pilot).loadout<c+u)return!1;if(null!=t)for(l=0,_=t.length;l<_;l++)switch((s=t[l])[0]){case"FactionOrUnique":if(this.pilot.faction!==s[2]&&!this.checkListForUnique(s[1].toLowerCase().replace(/[^0-9a-z]/gi,"").replace(/\s+/g,"-")))return!1;break;case"Base":for(n=!1,o=0,b=s.length;o<b;o++)if("Base"!==(i=s[o])){switch(f=i.startsWith("Non-")?i.substring(4):i){case"Small":null==this.data.base&&(n=!0);break;case"Standard":null!=this.data.base&&"Huge"===this.data.base||(n=!0);break;default:null!=this.data.base&&this.data.base===f&&(n=!0)}if(!0===(n=i!==f?!n:n))break}return n;case"Action":if(s[1].startsWith("W-")){if(m=s[1].substring(2),__indexOf.call(a.actions,m)<0)return!1}else{for(n=!1,r=0,g=(v=a.actions).length;r<g;r++)(p=v[r]).includes(s[1])&&!p.includes(">")&&(n=!0);if(!1===n)return!1}break;case"Keyword":if(!this.checkKeyword(s[1]))return!1;break;case"Equipped":if(!this.doesSlotExist(s[1])||!this.hasFilledSlotLike(e,s[1]))return!1;break;case"Slot":if(!this.hasAnotherUnoccupiedSlotLike(e,s[1])&&(null==e||("function"!=typeof e.occupiesAnUpgradeSlot||!e.occupiesAnUpgradeSlot(s[1])))||"HardpointShip"===e.slot||"VersatileShip"===e.slot)return!1;break;case"AttackArc":if(null==this.data.attackb)return!1;break;case"ShieldsGreaterThan":if(!(this.data.shields>s[1]))return!1;break;case"EnergyGreatterThan":if(!(a.energy>s[1]))return!1;break;case"InitiativeGreaterThan":if(!(this.pilot.skill>s[1]))return!1;break;case"InitiativeLessThan":if(!(this.pilot.skill<s[1]))return!1;break;case"HasForce":return null!=this.pilot.force===s[1]?!0:!1;case"AgilityEquals":if(a.agility!==s[1])return!1;break;case"isUnique":return s[1]!==(null!=this.pilot.unique||null!=this.pilot.max_per_squad)?!1:!0;case"Format":switch(s[1]){case"Epic":if(d=this.data.name,!(0<=__indexOf.call(exportObj.epicExclusionsList,d)))return!1;break;case"Standard":if(d=this.data.name,0<=__indexOf.call(exportObj.epicExclusionsList,d))return!1}}return!0},t.prototype.standardized_check=function(t){var e,i,n,a,s,l,o,r,d,c;if(null!=t.standardized)for(a=0,l=(r=this.builder.ships).length;a<l;a++)if(null!=(null!=(e=r[a])?e.data:void 0)&&e.data.name===this.data.name&&null!=t.restrictions&&e.restriction_check(t.restrictions,t)&&null==(null!=(d=e.pilot)?d.upgrades:void 0)){if(null!=e.pilot.loadout&&t.points+e.upgrade_points_total>e.pilot.loadout)return!1;for(i=!1,s=0,o=(c=e.upgrades).length;s<o;s++)n=c[s],t.slot===n.slot&&null==n.data&&(i=!0);if(!1===i)return!1}return!0},t.prototype.doesSlotExist=function(t){for(var e,i=this.upgrades,n=0,a=i.length;n<a;n++)if(e=i[n],exportObj.slotsMatching(e.slot,t))return!0;return!1},t.prototype.isSlotOccupied=function(t){for(var e,i=this.upgrades,n=0,a=i.length;n<a;n++)if(e=i[n],exportObj.slotsMatching(e.slot,t)&&!e.isOccupied())return!0;return!1},t.prototype.checkKeyword=function(t){var e,i,n,a,s,l,o,c,u,r,h,p,d,f,m;if(null!=(r=this.data.name)&&r.includes(t))return!0;if(null!=this.pilot.chassis){if(this.pilot.chassis===t)return!0}else if(null!=this.data.chassis&&this.data.chassis===t)return!0;for(e=0,s=(u=null!=(r=this.data.keyword)?r:[]).length;e<s;e++)if(u[e]===t)return!0;for(i=0,l=(h=null!=(r=this.pilot.keyword)?r:[]).length;i<l;i++)if(h[i]===t)return!0;for(n=0,o=(p=this.upgrades).length;n<o;n++){if(null!=(d=p[n]).chassis&&d.chassis===t)return!0;for(a=0,c=(m=null!=(d=null!=d&&null!=(f=d.data)?f.keyword:void 0)?d:[]).length;a<c;a++)if(m[a]===t)return!0}return!1},t.prototype.checkListForUnique=function(t){var e,n,a,i=this.builder.uniques_in_use;for(e in i)if(a=i[e],"Slot"!==e&&0<=__indexOf.call(function(){for(var t=[],e=0,i=a.length;e<i;e++)n=a[e],t.push(n.canonical_name.getXWSBaseName());return t}(),t))return!0;return!1},t.prototype.toXWS=function(){var t,e,i,n,a,s={id:null!=(s=this.pilot.xws)?s:this.pilot.canonical_name,name:null!=(s=this.pilot.xws)?s:this.pilot.canonical_name,points:this.getPoints(),ship:this.data.name.canonicalize()};if(this.data.multisection&&(s.multisection=this.data.multisection.slice(0)),e={},!this.pilot.upgrades)for(i=0,n=(a=this.upgrades).length;i<n;i++)null!=(null!=(t=a[i])?t.data:void 0)&&t.toXWS(e);return 0<Object.keys(e).length&&(s.upgrades=e),s},t.prototype.getConditions=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p;if("undefined"==typeof Set||null===Set)return console.warn("Set not supported in this JS implementation, not implementing conditions"),[];if(e=new Set,null!=(null!=(d=this.pilot)?d.applies_condition:void 0))if(this.pilot.applies_condition instanceof Array)for(n=0,l=(c=this.pilot.applies_condition).length;n<l;n++)t=c[n],e.add(exportObj.conditionsByCanonicalName[t]);else e.add(exportObj.conditionsByCanonicalName[this.pilot.applies_condition]);for(a=0,o=(u=this.upgrades).length;a<o;a++)if(null!=(null!=(i=u[a])&&null!=(h=i.data)?h.applies_condition:void 0))if(i.data.applies_condition instanceof Array)for(s=0,r=(p=i.data.applies_condition).length;s<r;s++)t=p[s],e.add(exportObj.conditionsByCanonicalName[t]);else e.add(exportObj.conditionsByCanonicalName[i.data.applies_condition]);return e},t}(),GenericAddon=function(){function t(t){this.ship=t.ship,this.container=$(t.container),this.data=null,this.unadjusted_data=null,this.conferredAddons=[],this.serialization_code="X",this.occupied_by=null,this.occupying=[],this.destroyed=!1,this.type=null,this.dataByName=null,(this.dataById=null)!=t.adjustment_func&&(this.adjustment_func=t.adjustment_func),null!=t.filter_func&&(this.filter_func=t.filter_func),this.placeholderMod_func=null!=t.placeholderMod_func?t.placeholderMod_func:function(t){return t}}return t.prototype.destroy=function(){__iced_k_noop;var a,s,l,t,e,i=iced.findDeferral(arguments),o=arguments[0],r=2<=arguments.length?__slice.call(arguments,1):[];if(this.destroyed)return o(r);l=t=this;var n=function(){var t,e,i,n;if(null!=(null!=(i=l.data)?i.standardized:void 0)){for(a=!0,t=0,e=(n=l.ship.builder.ships).length;t<e;t++)null!=(s=n[t]).data&&l.ship.data.name===s.data.name&&l.ship!==s&&(a=!1);!0===a&&l.ship.removeStandardizedList(l.data)}return l.destroyed=!0,l.rescindAddons(),l.deoccupyOtherUpgrades(),l.selector.select2("destroy"),l.selectorwrap.remove(),o(r)};null!=(null!=(e=t.data)?e.unique:void 0)?(e=new iced.Deferrals(n,{parent:i,funcname:"GenericAddon.destroy"}),t.ship.builder.container.trigger("xwing:releaseUnique",[t.data,t.type,e.defer({lineno:7416})]),e._fulfill()):n()},t.prototype.setupSelector=function(t){var n,a,e,i,s,l;return this.selectorwrap=$(document.createElement("div")),this.selectorwrap.addClass("form-group d-flex upgrade-box"),this.selector=$(document.createElement("INPUT")),this.selector.attr("type","hidden"),this.selectorwrap.append(this.selector),this.selectorwrap.append($.trim('<div class="input-group-addon">\n    <button class="btn btn-secondary d-block d-md-none upgrade-query-modal"><i class="fas fa-question"></i></button>\n</div>')),this.upgrade_query_modal=$(this.selectorwrap.find("button.upgrade-query-modal")),this.container.append(this.selectorwrap),$.isMobile()&&(t.minimumResultsForSearch=-1),t.formatResultCssClass=(n=this,function(t){var e,i;return null!=n.ship.builder.collection?(e=!1,t.id===(null!=(i=n.data)?i.id:void 0)?n.ship.builder.collection.checkShelf(n.type.toLowerCase(),t.name)||n.ship.builder.collection.checkTable(n.type.toLowerCase(),t.name)||(e=!0):e=!n.ship.builder.collection.checkShelf(n.type.toLowerCase(),t.name),e?"select2-result-not-in-collection":""):""}),t.formatSelection=(a=this,function(t,e){var i=function(){return("Upgrade"!==this.type?this.type:this.slot).toLowerCase().replace(/[^0-9a-z]/gi,"")}.call(a);i=i.replace("configuration","config").replace("force","forcepower"),$(e).append('<i class="xwing-miniatures-font xwing-miniatures-font-'+i+'"></i> '+t.text)}),this.selector.select2(t),this.upgrade_query_modal.click((e=this,function(t){if(e.data)return console.log(""+e.data.name),e.ship.builder.showTooltip("Addon",e.data,null!=e.data?{addon_type:e.type}:void 0,e.ship.builder.mobile_tooltip_modal,!0),e.ship.builder.mobile_tooltip_modal.modal("show")})),this.selector.on("select2-focus",function(t){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.selector.on("change",(i=this,function(t){return i.setById(i.selector.select2("val")),i.ship.builder.current_squad.dirty=!0,i.ship.builder.container.trigger("xwing-backend:squadDirtinessChanged"),i.ship.builder.backend_status.fadeOut("slow")})),this.selector.data("select2").results.on("mousemove-filtered",(s=this,function(t){t=$(t.target).closest(".select2-result").data("select2-data");if(null!=(null!=t?t.id:void 0))return s.ship.builder.showTooltip("Addon",s.dataById[t.id],{addon_type:s.type})})),this.selector.data("select2").container.on("mouseover",(l=this,function(t){if(null!=l.data)return l.ship.builder.showTooltip("Addon",l.data,{addon_type:l.type})}))},t.prototype.setById=function(t){return this.setData(this.dataById[parseInt(t)])},t.prototype.setByName=function(t){return this.setData(this.dataByName[$.trim(t)])},t.prototype.setData=function(e){var i,n=__iced_k_noop,a=iced.findDeferral(arguments);if((null!=e?e.id:void 0)===(null!=(l=this.data)?l.id:void 0))return n();s=l=this;var t,s,l,o=function(){null==(null!=(t=s.data)?t.standardized:void 0)||s.ship.hasFixedUpgrades||s.ship.removeStandardizedList(s.data),s.rescindAddons(),s.deoccupyOtherUpgrades();var t=function(){var t;if(s.data=s.unadjusted_data=e,null!=s.data){if(s.data.superseded_by_id)return s.setById(s.data.superseded_by_id);null!=s.adjustment_func&&(s.data=s.adjustment_func(s.data)),null==(null!=(t=s.ship.pilot)?t.upgrades:void 0)&&(s.unequipOtherUpgrades(),s.occupyOtherUpgrades(),s.conferAddons()),null==s.data.standardized||s.ship.hasFixedUpgrades||s.ship.addToStandardizedList(s.data)}else s.deoccupyOtherUpgrades();return s.lastSetValid=s.ship.validate(),n(s.ship.builder.container.trigger("xwing:pointsUpdated"))};if(null!=(null!=e?e.unique:void 0)||null!=(null!=e?e.solitary:void 0))try{i=new iced.Deferrals(t,{parent:a,funcname:"GenericAddon.setData"}),s.ship.builder.container.trigger("xwing:claimUnique",[e,s.type,i.defer({lineno:7517})]),i._fulfill()}catch(t){return void(s.ship.builder.container.trigger("xwing:pointsUpdated"),s.lastSetValid=!1)}else t()};null!=(null!=(t=l.data)?t.unique:void 0)||null!=(null!=(t=l.data)?t.solitary:void 0)?(i=new iced.Deferrals(o,{parent:a,funcname:"GenericAddon.setData"}),l.ship.builder.container.trigger("xwing:releaseUnique",[l.unadjusted_data,l.type,i.defer({lineno:7510})]),i._fulfill()):o()},t.prototype.conferAddons=function(){var t,e,i,n,a,s,l,o,r,d;if(null!=this.data.confersAddons&&!this.ship.builder.isQuickbuild&&0<this.data.confersAddons.length)for(n=0,s=(o=this.data.confersAddons).length;n<s;n++){if(i=(t=o[n]).type,e={ship:this.ship,container:this.container},null!=t.slot&&(e.slot=t.slot),null!=t.adjustment_func&&(e.adjustment_func=t.adjustment_func),null!=t.filter_func&&(e.filter_func=t.filter_func),null!=t.auto_equip&&(e.auto_equip=t.auto_equip),null!=t.placeholderMod_func&&(e.placeholderMod_func=t.placeholderMod_func),!((t=new i(e))instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+t);this.ship.upgrades.push(t),this.conferredAddons.push(t)}if(null!=this.data.chassis&&!this.ship.builder.isQuickbuild&&null!=exportObj.chassis[this.data.chassis].conferredAddons){for(d=[],a=0,l=(r=exportObj.chassis[this.data.chassis].conferredAddons).length;a<l;a++){if(i=(t=r[a]).type,e={ship:this.ship,container:this.container},null!=t.slot&&(e.slot=t.slot),null!=t.adjustment_func&&(e.adjustment_func=t.adjustment_func),null!=t.filter_func&&(e.filter_func=t.filter_func),null!=t.auto_equip&&(e.auto_equip=t.auto_equip),null!=t.placeholderMod_func&&(e.placeholderMod_func=t.placeholderMod_func),!((t=new i(e))instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+t);this.ship.upgrades.push(t),d.push(this.conferredAddons.push(t))}return d}},t.prototype.rescindAddons=function(){__iced_k_noop;var n,t,e,i,a,s,l,o=iced.findDeferral(arguments),r=(s=l=this,function(){for(var t=s.conferredAddons,e=0,i=t.length;e<i;e++){if(!((n=t[e])instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+n);s.ship.upgrades.removeItem(n)}return s.conferredAddons=[]});for(t=new iced.Deferrals(r,{parent:o,funcname:"GenericAddon.rescindAddons"}),e=0,i=(a=l.conferredAddons).length;e<i;e++)(n=a[e]).destroy(t.defer({lineno:7582}));t._fulfill()},t.prototype.getPoints=function(t,e){var i;if(null==t&&(t=this.data),null==e&&(e=this.ship),null==(null!=t?t.variablepoints:void 0))return null!=(i=null!=t?t.points:void 0)?i:0;switch(t.variablepoints){case"Agility":return null!=t?t.points[e.data.agility]:void 0;case"Base":if(null==(null!=e?e.data.base:void 0))return null!=t?t.points[0]:void 0;switch(e.data.base){case"Medium":return null!=t?t.points[1]:void 0;case"Large":return null!=t?t.points[2]:void 0;case"Huge":return null!=t?t.points[3]:void 0}break;case"Initiative":return null!=t?t.points[e.pilot.skill]:void 0;case"Faction":return null!=t?t.points[t.faction.indexOf(e.builder.faction)]:void 0}},t.prototype.updateSelection=function(t){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:(this.data.display_name||this.data.name)+" ("+t+(this.data.variablepoints?"*":"")+")"}):this.selector.select2("data",null)},t.prototype.toString=function(){return null!=this.data?(this.data.display_name||this.data.name)+" ("+this.getPoints()+")":"No "+this.type},t.prototype.toHTML=function(c){var t,u,e,i,n,a,s,l,o,r,d;if(null==this.data)return"";if(d=null!=this.data.slot&&"HardpointShip"===this.data.slot?"hardpoint":(null!=(d=this.data.slot)?d:this.type).toLowerCase().replace(/[^0-9a-z]/gi,""),r=(r="function"==typeof(r=this.data).text?r.text(match(/(<span.*<\/span>)<br \/><br \/>(.*)/)):void 0)?(o='<div class="card-restriction-container">'+r[1]+"</div>",r[2]):(o="",this.data.text),t="",null!=this.data.range&&(e=null!=this.data.rangebonus?'<span class="upgrade-attack-rangebonus"><i class="xwing-miniatures-font xwing-miniatures-font-rangebonusindicator"></i></span>':"",e=$.trim('<span class="upgrade-attack-range">'+this.data.range+"</span>\n"+e),u=null!=this.data.attack?$.trim('<span class="info-data info-attack">'+this.data.attack+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-frontarc"></i>'):null!=this.data.attackf?$.trim('<span class="info-data info-attack">'+this.data.attackf+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-fullfrontarc"></i>'):null!=this.data.attackb?$.trim('<span class="info-data info-attack">'+this.data.attackb+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-backarc"></i>'):null!=this.data.attackt?$.trim('<span class="info-data info-attack">'+this.data.attackt+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc"></i>'):null!=this.data.attackdt?$.trim('<span class="info-data info-attack">'+this.data.attackdt+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-doubleturretarc"></i>'):null!=this.data.attackl?$.trim('<span class="info-data info-attack">'+this.data.attackl+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-leftarc"></i>'):null!=this.data.attackr?$.trim('<span class="info-data info-attack">'+this.data.attackr+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-rightarc"></i>'):null!=this.data.attackbull?$.trim('<span class="info-data info-attack">'+this.data.attackbull+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc"></i>'):"",t=$.trim('<div class="upgrade-attack">\n    '+e+"\n    "+u+"\n</div>")),null!=this.data.charge){if(l="",null!=this.data.recurring)if(0<this.data.recurring)for(n=0;n<this.data.recurring;)l+='<sup><i class="fas fa-caret-up"></i></sup>',++n;else for(n=this.data.recurring;n<0;)l+='<sub><i class="fas fa-caret-down"></i></sub>',++n;i=$.trim('<div class="upgrade-charge">\n    <span class="info-data info-charge">'+this.data.charge+'</span>\n    <i class="xwing-miniatures-font xwing-miniatures-font-charge"></i>'+l+"\n</div>")}else i=$.trim("");if(null!=this.data.force){for(s=1,null!=this.data.forcerecurring&&(s=this.data.forcerecurring),n=0,l="";n<s;)l+='<sup><i class="fas fa-caret-up"></i></sup>',++n;a=$.trim('<div class="upgrade-force">\n    <span class="info-data info-force">'+this.data.force+'</span>\n    <i class="xwing-miniatures-font xwing-miniatures-font-forcecharge"></i>'+l+"\n</div>")}else a=$.trim("");return $.trim('<div class="upgrade-container">\n    <div class="upgrade-stats">\n        <div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-'+d+'"></i>'+(this.data.display_name||this.data.name)+'</div>\n        <div class="mask">\n            <div class="outer-circle">\n                <div class="inner-circle upgrade-points">'+c+"</div>\n            </div>\n        </div>\n        "+o+"\n    </div>\n    "+t+"\n    "+i+"\n    "+a+'\n    <div class="upgrade-text">'+r+'</div>\n    <div style="clear: both;"></div>\n</div>')},t.prototype.toTableRow=function(t){return null!=this.data?$.trim('<tr class="simple-addon">\n    <td class="name">'+(this.data.display_name||this.data.name)+'</td>\n    <td class="points">'+t+"</td>\n</tr>"):""},t.prototype.toSimpleCopy=function(t){return null!=this.data?this.data.name+" ("+t+")    \n":null},t.prototype.toRedditText=function(t){return null!=this.data?"*&nbsp;"+this.data.name+" ("+t+")*    \n":null},t.prototype.toTTSText=function(){return null!=this.data?""+exportObj.toTTS(this.data.name):null},t.prototype.toSerialized=function(){var t;return this.serialization_code+"."+(null!=(t=null!=(t=this.data)?t.id:void 0)?t:-1)},t.prototype.unequipOtherUpgrades=function(){for(var a,s,t,e=null!=(t=null!=(t=this.data)?t.unequips_upgrades:void 0)?t:[],i=[],n=0,l=e.length;n<l;n++)a=e[n],i.push(function(){for(var t=this.ship.upgrades,e=[],i=0,n=t.length;i<n;i++)if(s=t[i],exportObj.slotsMatching(s.slot,a)&&s!==this&&s.isOccupied()){s.setData(null);break}return e}.call(this));return i},t.prototype.isOccupied=function(){return null!=this.data||null!=this.occupied_by},t.prototype.occupyOtherUpgrades=function(){for(var a,s,t,e=null!=(t=null!=(t=this.data)?t.also_occupies_upgrades:void 0)?t:[],i=[],n=0,l=e.length;n<l;n++)a=e[n],i.push(function(){for(var t=this.ship.upgrades,e=[],i=0,n=t.length;i<n;i++)if(s=t[i],exportObj.slotsMatching(s.slot,a)&&s!==this&&!s.isOccupied()){this.occupy(s);break}return e}.call(this));return i},t.prototype.deoccupyOtherUpgrades=function(){for(var t,e=this.occupying,i=[],n=0,a=e.length;n<a;n++)t=e[n],i.push(this.deoccupy(t));return i},t.prototype.occupy=function(t){return t.occupied_by=this,t.selector.select2("enable",!1),this.occupying.push(t)},t.prototype.deoccupy=function(t){return t.occupied_by=null,t.selector.select2("enable",!0)},t.prototype.occupiesAnUpgradeSlot=function(t){for(var e,i=this.ship.upgrades,n=0,a=i.length;n<a;n++)if(e=i[n],exportObj.slotsMatching(e.slot,t)&&e!==this&&null==e.data&&null!=e.occupied_by&&e.occupied_by===this)return!0;return!1},t.prototype.toXWS=function(t){var e;return(null!=t[e=null!=(e=exportObj.toXWSUpgrade[this.data.slot])?e:this.data.slot.canonicalize()]?t[e]:t[e]=[]).push(null!=(t=this.data.xws)?t:this.data.canonical_name)},t}(),exportObj.Upgrade=function(){function e(t){e.__super__.constructor.call(this,t),this.slot=t.slot,this.type="Upgrade",this.dataById=exportObj.upgradesById,this.dataByName=exportObj.upgrades,this.serialization_code="U",this.setupSelector()}return __extends(e,GenericAddon),e.prototype.setupSelector=function(){return e.__super__.setupSelector.call(this,{width:"100%",placeholder:this.placeholderMod_func(exportObj.translate("ui","upgradePlaceholder",this.slot)),allowClear:!0,query:(i=this,function(t){var e={results:[]};return e.results=i.ship.builder.getAvailableUpgradesIncluding(i.slot,i.data,i.ship,i,t.term,i.filter_func),t.callback(e)})});var i},e}(),exportObj.RestrictedUpgrade=function(t){function e(t){this.filter_func=t.filter_func,e.__super__.constructor.call(this,t),this.serialization_code="u",null!=t.auto_equip&&this.setById(t.auto_equip)}return __extends(e,t),e}(exportObj.Upgrade),exportObj.QuickbuildUpgrade=function(){function e(t){e.__super__.constructor.call(this,t),this.slot=t.slot,this.type="Upgrade",this.dataById=exportObj.upgradesById,this.dataByName=exportObj.upgrades,this.serialization_code="U",this.upgrade=t.upgrade,this.setupSelector()}return __extends(e,GenericAddon),e.prototype.setupSelector=function(){return e.__super__.setupSelector.call(this,{width:"100%",allowClear:!1,query:(i=this,function(t){var e={results:[{id:i.upgrade.id,text:i.upgrade.display_name||i.upgrade.name,points:0,name:i.upgrade.name,display_name:i.upgrade.display_name}]};return t.callback(e)})});var i},e.prototype.getPoints=function(t){return 0},e.prototype.updateSelection=function(t){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:""+(this.data.display_name||this.data.name)}):this.selector.select2("data",null)},e}(),SERIALIZATION_CODE_TO_CLASS={U:exportObj.Upgrade,u:exportObj.RestrictedUpgrade},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).fromXWSFaction={rebelalliance:"Rebel Alliance",rebels:"Rebel Alliance",rebel:"Rebel Alliance",galacticempire:"Galactic Empire",imperial:"Galactic Empire",scumandvillainy:"Scum and Villainy",firstorder:"First Order",resistance:"Resistance",galacticrepublic:"Galactic Republic",separatistalliance:"Separatist Alliance"},exportObj.toXWSFaction={"Rebel Alliance":"rebelalliance","Galactic Empire":"galacticempire","Scum and Villainy":"scumandvillainy","First Order":"firstorder",Resistance:"resistance","Galactic Republic":"galacticrepublic","Separatist Alliance":"separatistalliance"},exportObj.toXWSUpgrade={Modification:"modification",Force:"force-power","Tactical Relay":"tactical-relay"},exportObj.fromXWSUpgrade={amd:"Astromech",astromechdroid:"Astromech",ept:"Talent",elitepilottalent:"Talent",system:"Sensor",mod:"Modification","force-power":"Force","tactical-relay":"Tactical Relay"},SPEC_URL="https://github.com/elistevens/xws-spec",SQUAD_TO_XWS_URL="https://squad2xws.herokuapp.com/translate/",exportObj.loadXWSButton=function(i){var e=$(i.find(".xws-import-status")),n=(e.text(exportObj.translate("ui","Loading...")),e),e=function(e){return $(window).trigger("xwing:activateBuilder",[exportObj.fromXWSFaction[e.faction],function(t){return t.current_squad.dirty&&null!=t.backend?(i.modal("hide"),t.backend.warnUnsaved(t,function(){return t.loadFromXWS(e,function(t){if(!t.success)return i.modal("show"),n.text(t.error)})})):t.loadFromXWS(e,function(t){return t.success?i.modal("hide"):n.text(t.error)})}])},a=i.find(".xws-content").val();try{return e(JSON.parse(a))}catch(t){return a=a.split("/").pop(),a=SQUAD_TO_XWS_URL+a,$.getJSON(a,e).catch(function(t){return n.text("Invalid Input")})}};
//# sourceMappingURL=xwing.min.js.map